(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-index-index"],{"0488":function(e,t,i){"use strict";i.r(t);var r=i("2af8"),n=i.n(r);for(var s in r)"default"!==s&&function(e){i.d(t,e,(function(){return r[e]}))}(s);t["default"]=n.a},"06c5":function(e,t,i){"use strict";i("a630"),i("fb6a"),i("d3b7"),i("25f0"),i("3ca3"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=s;var r=n(i("6b75"));function n(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(e){if("string"===typeof e)return(0,r.default)(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?(0,r.default)(e,t):void 0}}},"07b6":function(e,t,i){"use strict";i.r(t);var r=i("3f10"),n=i("ce56");for(var s in n)"default"!==s&&function(e){i.d(t,e,(function(){return n[e]}))}(s);i("8bb4");var a,o=i("f0c5"),u=Object(o["a"])(n["default"],r["b"],r["c"],!1,null,"168551c6",null,!1,r["a"],a);t["default"]=u.exports},"07fb":function(e,t,i){var r=i("24fb");t=r(!1),t.push([e.i,'@charset "UTF-8";\n/**\n * 这里是uni-app内置的常用样式变量\n *\n * uni-app 官方扩展插件及插件市场（https://ext.dcloud.net.cn）上很多三方插件均使用了这些样式变量\n * 如果你是插件开发者，建议你使用scss预处理，并在插件代码中直接使用这些变量（无需 import 这个文件），方便用户通过搭积木的方式开发整体风格一致的App\n *\n */\n/**\n * 如果你是App开发者（插件使用者），你可以通过修改这些变量来定制自己的插件主题，实现自定义主题功能\n *\n * 如果你的项目同样使用了scss预处理，你也可以直接在你的 scss 代码中使用如下变量，同时无需 import 这个文件\n */\n/* 颜色变量 */\n/* 行为相关颜色 */\n/* 文字基本颜色 */\n/* 背景颜色 */\n/* 边框颜色 */\n/* 尺寸变量 */\n/* 文字尺寸 */\n/* 图片尺寸 */\n/* Border Radius */\n/* 水平间距 */\n/* 垂直间距 */\n/* 透明度 */\n/* 文章场景相关 */.uni-file-picker__container[data-v-4545a46c]{display:flex;box-sizing:border-box;flex-wrap:wrap;margin:-5px}.file-picker__box[data-v-4545a46c]{position:relative;width:33.3%;height:0;padding-top:33.33%;box-sizing:border-box}.file-picker__box-content[data-v-4545a46c]{position:absolute;top:0;right:0;bottom:0;left:0;margin:5px;border:1px #eee solid;border-radius:8px;overflow:hidden}.file-picker__progress[data-v-4545a46c]{position:absolute;bottom:0;left:0;right:0;\n  /* border: 1px red solid; */z-index:2}.file-picker__progress-item[data-v-4545a46c]{width:100%}.file-picker__mask[data-v-4545a46c]{display:flex;justify-content:center;align-items:center;position:absolute;right:0;top:0;bottom:0;left:0;color:#fff;font-size:12px;background-color:rgba(0,0,0,.4)}.file-image[data-v-4545a46c]{width:100%;height:100%}.is-add[data-v-4545a46c]{display:flex;align-items:center;justify-content:center}.icon-add[data-v-4545a46c]{width:50px;height:5px;background-color:#f1f1f1;border-radius:2px}.rotate[data-v-4545a46c]{position:absolute;-webkit-transform:rotate(90deg);transform:rotate(90deg)}.icon-del-box[data-v-4545a46c]{display:flex;align-items:center;justify-content:center;position:absolute;top:5px;right:5px;height:26px;width:26px;border-radius:50%;background-color:rgba(0,0,0,.5);z-index:2;-webkit-transform:rotate(-45deg);transform:rotate(-45deg)}.icon-del[data-v-4545a46c]{width:15px;height:2px;background-color:#fff;border-radius:2px}',""]),e.exports=t},"09f0":function(e,t,i){"use strict";function r(e,t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e)){var i=[],r=!0,n=!1,s=void 0;try{for(var a,o=e[Symbol.iterator]();!(r=(a=o.next()).done);r=!0)if(i.push(a.value),t&&i.length===t)break}catch(u){n=!0,s=u}finally{try{r||null==o["return"]||o["return"]()}finally{if(n)throw s}}return i}}i("a4d3"),i("e01a"),i("d28b"),i("d3b7"),i("3ca3"),i("ddb0"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=r},"0d21":function(e,t,i){"use strict";function r(e){if(Array.isArray(e))return e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=r},"10b0":function(e,t,i){"use strict";var r=i("4ea4");i("99af"),i("4160"),i("c975"),i("baa5"),i("d3b7"),i("ac1f"),i("5319"),i("1276"),i("159b"),Object.defineProperty(t,"__esModule",{value:!0}),t.get_file_data=t.get_file_info=t.get_files_and_is_max=t.get_extname=t.get_file_ext=void 0,i("96cf");var n=r(i("1da1")),s=function(e){var t=e.lastIndexOf("."),i=e.length;return{name:e.substring(0,t),ext:e.substring(t+1,i)}};t.get_file_ext=s;var a=function(e){if(Array.isArray(e))return e;var t=e.replace(/(\[|\])/g,"");return t.split(",")};t.get_extname=a;var o=function(e,t){var i=[],r=[];return t&&0!==t.length?(e.tempFiles.forEach((function(e){var n=s(e.name),a=n.ext.toLowerCase();-1!==t.indexOf(a)&&(r.push(e),i.push(e.path))})),r.length!==e.tempFiles.length&&uni.showToast({title:"当前选择了".concat(e.tempFiles.length,"个文件 ，").concat(e.tempFiles.length-r.length," 个文件格式不正确"),icon:"none",duration:5e3}),{filePaths:i,files:r}):{filePaths:i,files:r}};t.get_files_and_is_max=o;var u=function(e){return new Promise((function(t,i){uni.getImageInfo({src:e,success:function(e){t(e)},fail:function(e){i(e)}})}))};t.get_file_info=u;var c=function(){var e=(0,n.default)(regeneratorRuntime.mark((function e(t){var i,r,n,a,o,c=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(i=c.length>1&&void 0!==c[1]?c[1]:"image",r=s(t.name),n=r.ext.toLowerCase(),a={name:t.name,uuid:t.uuid,extname:n||"",cloudPath:t.cloudPath,fileType:t.fileType,url:t.path||t.path,size:t.size,image:{},path:t.path,video:{}},"image"!==i){e.next=14;break}return e.next=7,u(t.path);case 7:o=e.sent,delete a.video,a.image.width=o.width,a.image.height=o.height,a.image.location=o.path,e.next=15;break;case 14:delete a.image;case 15:return e.abrupt("return",a);case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();t.get_file_data=c},"143c":function(e,t,i){var r=i("74e8");r("Int32",(function(e){return function(t,i,r){return e(this,t,i,r)}}))},"1da1":function(e,t,i){"use strict";function r(e,t,i,r,n,s,a){try{var o=e[s](a),u=o.value}catch(c){return void i(c)}o.done?t(u):Promise.resolve(u).then(r,n)}function n(e){return function(){var t=this,i=arguments;return new Promise((function(n,s){var a=e.apply(t,i);function o(e){r(a,n,s,o,u,"next",e)}function u(e){r(a,n,s,o,u,"throw",e)}o(void 0)}))}}i("d3b7"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=n},"257e":function(e,t,i){"use strict";function r(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=r},"262e":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=s;var r=n(i("b380"));function n(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&(0,r.default)(e,t)}},"280a":function(e,t,i){"use strict";var r;i.d(t,"b",(function(){return n})),i.d(t,"c",(function(){return s})),i.d(t,"a",(function(){return r}));var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-uni-view",{staticClass:"uni-file-picker"},[e.title?i("v-uni-view",{staticClass:"uni-file-picker__header"},[i("v-uni-text",{staticClass:"file-title"},[e._v(e._s(e.title))]),i("v-uni-text",{staticClass:"file-count"},[e._v(e._s(e.filesList.length)+"/"+e._s(e.limitLength))])],1):e._e(),"image"===e.fileMediatype&&"grid"===e.showType?i("upload-image",{attrs:{readonly:e.readonly,"image-styles":e.imageStyles,"files-list":e.filesList,limit:e.limitLength,disablePreview:e.disablePreview,delIcon:e.delIcon},on:{uploadFiles:function(t){arguments[0]=t=e.$handleEvent(t),e.uploadFiles.apply(void 0,arguments)},choose:function(t){arguments[0]=t=e.$handleEvent(t),e.choose.apply(void 0,arguments)},delFile:function(t){arguments[0]=t=e.$handleEvent(t),e.delFile.apply(void 0,arguments)}}},[e._t("default",[i("v-uni-view",{staticClass:"is-add"},[i("v-uni-view",{staticClass:"icon-add"}),i("v-uni-view",{staticClass:"icon-add rotate"})],1)])],2):e._e(),"image"!==e.fileMediatype||"grid"!==e.showType?i("upload-file",{attrs:{readonly:e.readonly,"list-styles":e.listStyles,"files-list":e.filesList,showType:e.showType,delIcon:e.delIcon},on:{uploadFiles:function(t){arguments[0]=t=e.$handleEvent(t),e.uploadFiles.apply(void 0,arguments)},choose:function(t){arguments[0]=t=e.$handleEvent(t),e.choose.apply(void 0,arguments)},delFile:function(t){arguments[0]=t=e.$handleEvent(t),e.delFile.apply(void 0,arguments)}}},[e._t("default",[i("v-uni-button",{attrs:{type:"primary",size:"mini"}},[e._v("选择文件")])])],2):e._e()],1)},s=[]},2909:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=u;var r=o(i("6005")),n=o(i("db90")),s=o(i("06c5")),a=o(i("3427"));function o(e){return e&&e.__esModule?e:{default:e}}function u(e){return(0,r.default)(e)||(0,n.default)(e)||(0,s.default)(e)||(0,a.default)()}},"2af8":function(e,t,i){"use strict";i("99af"),i("4160"),i("c975"),i("a9e3"),i("159b"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r={name:"uploadImage",emits:["uploadFiles","choose","delFile"],props:{filesList:{type:Array,default:function(){return[]}},disabled:{type:Boolean,default:!1},disablePreview:{type:Boolean,default:!1},limit:{type:[Number,String],default:9},imageStyles:{type:Object,default:function(){return{width:"auto",height:"auto",border:{}}}},delIcon:{type:Boolean,default:!0},readonly:{type:Boolean,default:!1}},computed:{styles:function(){var e={width:"auto",height:"auto",border:{}};return Object.assign(e,this.imageStyles)},boxStyle:function(){var e=this.styles,t=e.width,i=void 0===t?"auto":t,r=e.height,n=void 0===r?"auto":r,s={};"auto"===n?"auto"!==i?(s.height=this.value2px(i),s["padding-top"]=0):s.height=0:(s.height=this.value2px(n),s["padding-top"]=0),s.width="auto"===i?"auto"!==n?this.value2px(n):"33.3%":this.value2px(i);var a="";for(var o in s)a+="".concat(o,":").concat(s[o],";");return a},borderStyle:function(){var e=this.styles.border,t={};if("boolean"===typeof e)t.border=e?"1px #eee solid":"none";else{var i=e&&e.width||1;i=this.value2px(i);var r=e&&e.radius||5;r=this.value2px(r),t={"border-width":i,"border-style":e&&e.style||"solid","border-color":e&&e.color||"#eee","border-radius":r}}var n="";for(var s in t)n+="".concat(s,":").concat(t[s],";");return n}},methods:{uploadFiles:function(e,t){this.$emit("uploadFiles",e)},choose:function(){this.$emit("choose")},delFile:function(e){this.$emit("delFile",e)},prviewImage:function(e,t){var i=[];1===Number(this.limit)&&this.disablePreview&&!this.disabled&&this.$emit("choose"),this.disablePreview||(this.filesList.forEach((function(e){i.push(e.url)})),uni.previewImage({urls:i,current:t}))},value2px:function(e){return"number"===typeof e?e+="px":-1===e.indexOf("%")&&(e=-1!==e.indexOf("px")?e:e+"px"),e}}};t.default=r},"2caf":function(e,t,i){"use strict";i("4ae1"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=o;var r=a(i("7e84")),n=a(i("d967")),s=a(i("99de"));function a(e){return e&&e.__esModule?e:{default:e}}function o(e){var t=(0,n.default)();return function(){var i,n=(0,r.default)(e);if(t){var a=(0,r.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,s.default)(this,i)}}},"32d3":function(e,t,i){var r=i("da1d");"string"===typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);var n=i("4f06").default;n("120f086b",r,!0,{sourceMap:!1,shadowMode:!1})},"334c":function(e,t,i){"use strict";var r=i("32d3"),n=i.n(r);n.a},3427:function(e,t,i){"use strict";function r(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}Object.defineProperty(t,"__esModule",{value:!0}),t.default=r},"37dc":function(e,t,i){"use strict";(function(e){var r=i("4ea4");i("99af"),i("7db0"),i("4160"),i("c975"),i("a434"),i("b64b"),i("d3b7"),i("e25e"),i("ac1f"),i("5319"),i("1276"),i("498a"),i("159b"),i("ddb0"),Object.defineProperty(t,"__esModule",{value:!0}),t.compileI18nJsonStr=L,t.hasI18nJson=F,t.initVueI18n=I,t.isI18nStr=z,t.normalizeLocale=k,t.parseI18nJson=C,t.resolveLocale=N,t.isString=t.LOCALE_ZH_HANT=t.LOCALE_ZH_HANS=t.LOCALE_FR=t.LOCALE_ES=t.LOCALE_EN=t.I18n=t.Formatter=void 0;var n=r(i("3835")),s=r(i("d4ec")),a=r(i("bee2")),o=Array.isArray,u=function(e){return null!==e&&"object"===typeof e},c=["{","}"],l=function(){function e(){(0,s.default)(this,e),this._caches=Object.create(null)}return(0,a.default)(e,[{key:"interpolate",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:c;if(!t)return[e];var r=this._caches[e];return r||(r=d(e,i),this._caches[e]=r),p(r,t)}}]),e}();t.Formatter=l;var h=/^(?:\d)+/,f=/^(?:\w)+/;function d(e,t){var i=(0,n.default)(t,2),r=i[0],s=i[1],a=[],o=0,u="";while(o<e.length){var c=e[o++];if(c===r){u&&a.push({type:"text",value:u}),u="";var l="";c=e[o++];while(void 0!==c&&c!==s)l+=c,c=e[o++];var d=c===s,p=h.test(l)?"list":d&&f.test(l)?"named":"unknown";a.push({value:l,type:p})}else u+=c}return u&&a.push({type:"text",value:u}),a}function p(e,t){var i=[],r=0,n=o(t)?"list":u(t)?"named":"unknown";if("unknown"===n)return i;while(r<e.length){var s=e[r];switch(s.type){case"text":i.push(s.value);break;case"list":i.push(t[parseInt(s.value,10)]);break;case"named":"named"===n&&i.push(t[s.value]);break;case"unknown":0;break}r++}return i}var m="zh-Hans";t.LOCALE_ZH_HANS=m;var g="zh-Hant";t.LOCALE_ZH_HANT=g;var _="en";t.LOCALE_EN=_;var y="fr";t.LOCALE_FR=y;var v="es";t.LOCALE_ES=v;var b=Object.prototype.hasOwnProperty,x=function(e,t){return b.call(e,t)},w=new l;function S(e,t){return!!t.find((function(t){return-1!==e.indexOf(t)}))}function U(e,t){return t.find((function(t){return 0===e.indexOf(t)}))}function k(e,t){if(e){if(e=e.trim().replace(/_/g,"-"),t&&t[e])return e;if(e=e.toLowerCase(),0===e.indexOf("zh"))return e.indexOf("-hans")>-1?m:e.indexOf("-hant")>-1||S(e,["-tw","-hk","-mo","-cht"])?g:m;var i=U(e,[_,y,v]);return i||void 0}}var E=function(){function e(t){var i=t.locale,r=t.fallbackLocale,n=t.messages,a=t.watcher,o=t.formater;(0,s.default)(this,e),this.locale=_,this.fallbackLocale=_,this.message={},this.messages={},this.watchers=[],r&&(this.fallbackLocale=r),this.formater=o||w,this.messages=n||{},this.setLocale(i||_),a&&this.watchLocale(a)}return(0,a.default)(e,[{key:"setLocale",value:function(e){var t=this,i=this.locale;this.locale=k(e,this.messages)||this.fallbackLocale,this.messages[this.locale]||(this.messages[this.locale]={}),this.message=this.messages[this.locale],i!==this.locale&&this.watchers.forEach((function(e){e(t.locale,i)}))}},{key:"getLocale",value:function(){return this.locale}},{key:"watchLocale",value:function(e){var t=this,i=this.watchers.push(e)-1;return function(){t.watchers.splice(i,1)}}},{key:"add",value:function(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=this.messages[e];r?i?Object.assign(r,t):Object.keys(t).forEach((function(e){x(r,e)||(r[e]=t[e])})):this.messages[e]=t}},{key:"f",value:function(e,t,i){return this.formater.interpolate(e,t,i).join("")}},{key:"t",value:function(e,t,i){var r=this.message;return"string"===typeof t?(t=k(t,this.messages),t&&(r=this.messages[t])):i=t,x(r,e)?this.formater.interpolate(r[e],i).join(""):(console.warn("Cannot translate the value of keypath ".concat(e,". Use the value of keypath as default.")),e)}}]),e}();function A(e,t){e.$watchLocale?e.$watchLocale((function(e){t.setLocale(e)})):e.$watch((function(){return e.$locale}),(function(e){t.setLocale(e)}))}function T(){return"undefined"!==typeof uni&&uni.getLocale?uni.getLocale():"undefined"!==typeof e&&e.getLocale?e.getLocale():_}function I(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if("string"!==typeof e){var n=[t,e];e=n[0],t=n[1]}"string"!==typeof e&&(e=T()),"string"!==typeof i&&(i="undefined"!==typeof __uniConfig&&__uniConfig.fallbackLocale||_);var s=new E({locale:e,fallbackLocale:i,messages:t,watcher:r}),a=function(e,t){if("function"!==typeof getApp)a=function(e,t){return s.t(e,t)};else{var i=!1;a=function(e,t){var r=getApp().$vm;return r&&(r.$locale,i||(i=!0,A(r,s))),s.t(e,t)}}return a(e,t)};return{i18n:s,f:function(e,t,i){return s.f(e,t,i)},t:function(e,t){return a(e,t)},add:function(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return s.add(e,t,i)},watch:function(e){return s.watchLocale(e)},getLocale:function(){return s.getLocale()},setLocale:function(e){return s.setLocale(e)}}}t.I18n=E;var P,B=function(e){return"string"===typeof e};function F(e,t){return P||(P=new l),M(e,(function(e,i){var r=e[i];return B(r)?!!z(r,t)||void 0:F(r,t)}))}function C(e,t,i){return P||(P=new l),M(e,(function(e,r){var n=e[r];B(n)?z(n,i)&&(e[r]=O(n,t,i)):C(n,t,i)})),e}function L(e,t){var i=t.locale,r=t.locales,n=t.delimiters;if(!z(e,n))return e;P||(P=new l);var s=[];Object.keys(r).forEach((function(e){e!==i&&s.push({locale:e,values:r[e]})})),s.unshift({locale:i,values:r[i]});try{return JSON.stringify(D(JSON.parse(e),s,n),null,2)}catch(a){}return e}function z(e,t){return e.indexOf(t[0])>-1}function O(e,t,i){return P.interpolate(e,t,i).join("")}function R(e,t,i,r){var n=e[t];if(B(n)){if(z(n,r)&&(e[t]=O(n,i[0].values,r),i.length>1)){var s=e[t+"Locales"]={};i.forEach((function(e){s[e.locale]=O(n,e.values,r)}))}}else D(n,i,r)}function D(e,t,i){return M(e,(function(e,r){R(e,r,t,i)})),e}function M(e,t){if(o(e)){for(var i=0;i<e.length;i++)if(t(e,i))return!0}else if(u(e))for(var r in e)if(t(e,r))return!0;return!1}function N(e){return function(t){return t?(t=k(t)||t,j(t).find((function(t){return e.indexOf(t)>-1}))):t}}function j(e){var t=[],i=e.split("-");while(i.length)t.push(i.join("-")),i.pop();return t}t.isString=B}).call(this,i("c8ba"))},3835:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=u;var r=o(i("0d21")),n=o(i("09f0")),s=o(i("06c5")),a=o(i("3d8c"));function o(e){return e&&e.__esModule?e:{default:e}}function u(e,t){return(0,r.default)(e)||(0,n.default)(e,t)||(0,s.default)(e,t)||(0,a.default)()}},"3ccc":function(e,t,i){"use strict";i("99af"),i("4160"),i("c975"),i("a9e3"),i("159b"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r={name:"uploadFile",emits:["uploadFiles","choose","delFile"],props:{filesList:{type:Array,default:function(){return[]}},delIcon:{type:Boolean,default:!0},limit:{type:[Number,String],default:9},showType:{type:String,default:""},listStyles:{type:Object,default:function(){return{border:!0,dividline:!0,borderStyle:{}}}},readonly:{type:Boolean,default:!1}},computed:{list:function(){var e=[];return this.filesList.forEach((function(t){e.push(t)})),e},styles:function(){var e={border:!0,dividline:!0,"border-style":{}};return Object.assign(e,this.listStyles)},borderStyle:function(){var e=this.styles,t=e.borderStyle,i=e.border,r={};if(i){var n=t&&t.width||1;n=this.value2px(n);var s=t&&t.radius||5;s=this.value2px(s),r={"border-width":n,"border-style":t&&t.style||"solid","border-color":t&&t.color||"#eee","border-radius":s}}else r.border="none";var a="";for(var o in r)a+="".concat(o,":").concat(r[o],";");return a},borderLineStyle:function(){var e={},t=this.styles.borderStyle;if(t&&t.color&&(e["border-color"]=t.color),t&&t.width){var i=t&&t.width||1,r=t&&t.style||0;"number"===typeof i?i+="px":i=i.indexOf("px")?i:i+"px",e["border-width"]=i,"number"===typeof r?r+="px":r=r.indexOf("px")?r:r+"px",e["border-top-style"]=r}var n="";for(var s in e)n+="".concat(s,":").concat(e[s],";");return n}},methods:{uploadFiles:function(e,t){this.$emit("uploadFiles",{item:e,index:t})},choose:function(){this.$emit("choose")},delFile:function(e){this.$emit("delFile",e)},value2px:function(e){return"number"===typeof e?e+="px":e=-1!==e.indexOf("px")?e:e+"px",e}}};t.default=r},"3d8c":function(e,t,i){"use strict";function r(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}Object.defineProperty(t,"__esModule",{value:!0}),t.default=r},"3f10":function(e,t,i){"use strict";i.d(t,"b",(function(){return n})),i.d(t,"c",(function(){return s})),i.d(t,"a",(function(){return r}));var r={uniFilePicker:i("e452").default},n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-uni-view",{staticClass:"content"},[i("uni-file-picker",{attrs:{"file-mediatype":"video","return-type":"object"},on:{select:function(t){arguments[0]=t=e.$handleEvent(t),e.onSelectFile.apply(void 0,arguments)}}}),i("v-uni-text",[e._v(e._s(e.mediainfo))])],1)},s=[]},4478:function(e,t,i){"use strict";i("4ae1"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=a;var r=s(i("b380")),n=s(i("d967"));function s(e){return e&&e.__esModule?e:{default:e}}function a(e,i,s){return(0,n.default)()?t.default=a=Reflect.construct:t.default=a=function(e,t,i){var n=[null];n.push.apply(n,t);var s=Function.bind.apply(e,n),a=new s;return i&&(0,r.default)(a,i.prototype),a},a.apply(null,arguments)}},"4a9b":function(e,t,i){var r=i("74e8");r("Float64",(function(e){return function(t,i,r){return e(this,t,i,r)}}))},"4c2e":function(e,t,i){var r=i("24fb");t=r(!1),t.push([e.i,'@charset "UTF-8";\n/**\n * 这里是uni-app内置的常用样式变量\n *\n * uni-app 官方扩展插件及插件市场（https://ext.dcloud.net.cn）上很多三方插件均使用了这些样式变量\n * 如果你是插件开发者，建议你使用scss预处理，并在插件代码中直接使用这些变量（无需 import 这个文件），方便用户通过搭积木的方式开发整体风格一致的App\n *\n */\n/**\n * 如果你是App开发者（插件使用者），你可以通过修改这些变量来定制自己的插件主题，实现自定义主题功能\n *\n * 如果你的项目同样使用了scss预处理，你也可以直接在你的 scss 代码中使用如下变量，同时无需 import 这个文件\n */\n/* 颜色变量 */\n/* 行为相关颜色 */\n/* 文字基本颜色 */\n/* 背景颜色 */\n/* 边框颜色 */\n/* 尺寸变量 */\n/* 文字尺寸 */\n/* 图片尺寸 */\n/* Border Radius */\n/* 水平间距 */\n/* 垂直间距 */\n/* 透明度 */\n/* 文章场景相关 */.uni-file-picker__files[data-v-5df3f378]{display:flex;flex-direction:column;justify-content:flex-start}.uni-file-picker__lists[data-v-5df3f378]{position:relative;margin-top:5px;overflow:hidden}.file-picker__mask[data-v-5df3f378]{display:flex;justify-content:center;align-items:center;position:absolute;right:0;top:0;bottom:0;left:0;color:#fff;font-size:14px;background-color:rgba(0,0,0,.4)}.uni-file-picker__lists-box[data-v-5df3f378]{position:relative}.uni-file-picker__item[data-v-5df3f378]{display:flex;align-items:center;padding:8px 10px;padding-right:5px;padding-left:10px}.files-border[data-v-5df3f378]{border-top:1px #eee solid}.files__name[data-v-5df3f378]{flex:1;font-size:14px;color:#666;margin-right:25px;word-break:break-all;word-wrap:break-word}.icon-files[data-v-5df3f378]{position:static;background-color:initial}.is-list-card[data-v-5df3f378]{border:1px #eee solid;margin-bottom:5px;border-radius:5px;box-shadow:0 0 2px 0 rgba(0,0,0,.1);padding:5px}.files__image[data-v-5df3f378]{width:40px;height:40px;margin-right:10px}.header-image[data-v-5df3f378]{width:100%;height:100%}.is-text-box[data-v-5df3f378]{border:1px #eee solid;border-radius:5px}.is-text-image[data-v-5df3f378]{width:25px;height:25px;margin-left:5px}.rotate[data-v-5df3f378]{position:absolute;-webkit-transform:rotate(90deg);transform:rotate(90deg)}.icon-del-box[data-v-5df3f378]{display:flex;margin:auto 0;align-items:center;justify-content:center;position:absolute;top:0;bottom:0;right:5px;height:26px;width:26px;z-index:2;-webkit-transform:rotate(-45deg);transform:rotate(-45deg)}.icon-del[data-v-5df3f378]{width:15px;height:1px;background-color:#333}@media (min-width:768px){.uni-file-picker__files[data-v-5df3f378]{max-width:375px}}',""]),e.exports=t},"4ec9":function(e,t,i){"use strict";var r=i("6d61"),n=i("6566");e.exports=r("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),n)},5377:function(e,t,i){var r=i("83ab"),n=i("9bf2"),s=i("ad6d"),a=i("9f7f").UNSUPPORTED_Y;r&&("g"!=/./g.flags||a)&&n.f(RegExp.prototype,"flags",{configurable:!0,get:s})},"53ca":function(e,t,i){"use strict";function r(e){return"function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?t.default=r=function(e){return typeof e}:t.default=r=function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}i("a4d3"),i("e01a"),i("d28b"),i("d3b7"),i("3ca3"),i("ddb0"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=r},"579b":function(e,t,i){"use strict";i.r(t);var r=i("b2e8"),n=i("0488");for(var s in n)"default"!==s&&function(e){i.d(t,e,(function(){return n[e]}))}(s);i("72d7");var a,o=i("f0c5"),u=Object(o["a"])(n["default"],r["b"],r["c"],!1,null,"4545a46c",null,!1,r["a"],a);t["default"]=u.exports},6005:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=s;var r=n(i("6b75"));function n(e){return e&&e.__esModule?e:{default:e}}function s(e){if(Array.isArray(e))return(0,r.default)(e)}},6566:function(e,t,i){"use strict";var r=i("9bf2").f,n=i("7c73"),s=i("e2cc"),a=i("0366"),o=i("19aa"),u=i("2266"),c=i("7dd0"),l=i("2626"),h=i("83ab"),f=i("f183").fastKey,d=i("69f3"),p=d.set,m=d.getterFor;e.exports={getConstructor:function(e,t,i,c){var l=e((function(e,r){o(e,l,t),p(e,{type:t,index:n(null),first:void 0,last:void 0,size:0}),h||(e.size=0),void 0!=r&&u(r,e[c],e,i)})),d=m(t),g=function(e,t,i){var r,n,s=d(e),a=_(e,t);return a?a.value=i:(s.last=a={index:n=f(t,!0),key:t,value:i,previous:r=s.last,next:void 0,removed:!1},s.first||(s.first=a),r&&(r.next=a),h?s.size++:e.size++,"F"!==n&&(s.index[n]=a)),e},_=function(e,t){var i,r=d(e),n=f(t);if("F"!==n)return r.index[n];for(i=r.first;i;i=i.next)if(i.key==t)return i};return s(l.prototype,{clear:function(){var e=this,t=d(e),i=t.index,r=t.first;while(r)r.removed=!0,r.previous&&(r.previous=r.previous.next=void 0),delete i[r.index],r=r.next;t.first=t.last=void 0,h?t.size=0:e.size=0},delete:function(e){var t=this,i=d(t),r=_(t,e);if(r){var n=r.next,s=r.previous;delete i.index[r.index],r.removed=!0,s&&(s.next=n),n&&(n.previous=s),i.first==r&&(i.first=n),i.last==r&&(i.last=s),h?i.size--:t.size--}return!!r},forEach:function(e){var t,i=d(this),r=a(e,arguments.length>1?arguments[1]:void 0,3);while(t=t?t.next:i.first){r(t.value,t.key,this);while(t&&t.removed)t=t.previous}},has:function(e){return!!_(this,e)}}),s(l.prototype,i?{get:function(e){var t=_(this,e);return t&&t.value},set:function(e,t){return g(this,0===e?0:e,t)}}:{add:function(e){return g(this,e=0===e?0:e,e)}}),h&&r(l.prototype,"size",{get:function(){return d(this).size}}),l},setStrong:function(e,t,i){var r=t+" Iterator",n=m(t),s=m(r);c(e,t,(function(e,t){p(this,{type:r,target:e,state:n(e),kind:t,last:void 0})}),(function(){var e=s(this),t=e.kind,i=e.last;while(i&&i.removed)i=i.previous;return e.target&&(e.last=i=i?i.next:e.state.first)?"keys"==t?{value:i.key,done:!1}:"values"==t?{value:i.value,done:!1}:{value:[i.key,i.value],done:!1}:(e.target=void 0,{value:void 0,done:!0})}),i?"entries":"values",!i,!0),l(t)}}},"6b51":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r={appid:"__UNI__C834E91"};t.default=r},"6b75":function(e,t,i){"use strict";function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}Object.defineProperty(t,"__esModule",{value:!0}),t.default=r},"6c57":function(e,t,i){var r=i("23e7"),n=i("da84");r({global:!0},{globalThis:n})},"6d61":function(e,t,i){"use strict";var r=i("23e7"),n=i("da84"),s=i("94ca"),a=i("6eeb"),o=i("f183"),u=i("2266"),c=i("19aa"),l=i("861d"),h=i("d039"),f=i("1c7e"),d=i("d44e"),p=i("7156");e.exports=function(e,t,i){var m=-1!==e.indexOf("Map"),g=-1!==e.indexOf("Weak"),_=m?"set":"add",y=n[e],v=y&&y.prototype,b=y,x={},w=function(e){var t=v[e];a(v,e,"add"==e?function(e){return t.call(this,0===e?0:e),this}:"delete"==e?function(e){return!(g&&!l(e))&&t.call(this,0===e?0:e)}:"get"==e?function(e){return g&&!l(e)?void 0:t.call(this,0===e?0:e)}:"has"==e?function(e){return!(g&&!l(e))&&t.call(this,0===e?0:e)}:function(e,i){return t.call(this,0===e?0:e,i),this})};if(s(e,"function"!=typeof y||!(g||v.forEach&&!h((function(){(new y).entries().next()})))))b=i.getConstructor(t,e,m,_),o.REQUIRED=!0;else if(s(e,!0)){var S=new b,U=S[_](g?{}:-0,1)!=S,k=h((function(){S.has(1)})),E=f((function(e){new y(e)})),A=!g&&h((function(){var e=new y,t=5;while(t--)e[_](t,t);return!e.has(-0)}));E||(b=t((function(t,i){c(t,b,e);var r=p(new y,t,b);return void 0!=i&&u(i,r[_],r,m),r})),b.prototype=v,v.constructor=b),(k||A)&&(w("delete"),w("has"),m&&w("get")),(A||U)&&w(_),g&&v.clear&&delete v.clear}return x[e]=b,r({global:!0,forced:b!=y},x),d(b,e),g||i.setStrong(b,e,m),b}},"72d7":function(e,t,i){"use strict";var r=i("a6e8"),n=i.n(r);n.a},"7e50":function(e,t,i){"use strict";i.r(t);var r=i("a06f"),n=i("dd0f");for(var s in n)"default"!==s&&function(e){i.d(t,e,(function(){return n[e]}))}(s);i("ba82");var a,o=i("f0c5"),u=Object(o["a"])(n["default"],r["b"],r["c"],!1,null,"5df3f378",null,!1,r["a"],a);t["default"]=u.exports},"7e84":function(e,t,i){"use strict";function r(e){return t.default=r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},r(e)}i("3410"),i("131a"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=r},"84c3":function(e,t,i){var r=i("74e8");r("Uint16",(function(e){return function(t,i,r){return e(this,t,i,r)}}))},"8af0":function(e,t,i){"use strict";i.r(t);var r=i("ff9e"),n=i.n(r);for(var s in r)"default"!==s&&function(e){i.d(t,e,(function(){return r[e]}))}(s);t["default"]=n.a},"8b09":function(e,t,i){var r=i("74e8");r("Int16",(function(e){return function(t,i,r){return e(this,t,i,r)}}))},"8bb4":function(e,t,i){"use strict";var r=i("957a"),n=i.n(r);n.a},9072:function(e,t,i){"use strict";i("4ec9"),i("d3b7"),i("3ca3"),i("ddb0"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=u;var r=o(i("7e84")),n=o(i("b380")),s=o(i("fa95")),a=o(i("4478"));function o(e){return e&&e.__esModule?e:{default:e}}function u(e){var i="function"===typeof Map?new Map:void 0;return t.default=u=function(e){if(null===e||!(0,s.default)(e))return e;if("function"!==typeof e)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof i){if(i.has(e))return i.get(e);i.set(e,t)}function t(){return(0,a.default)(e,arguments,(0,r.default)(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),(0,n.default)(t,e)},u(e)}},"957a":function(e,t,i){var r=i("ab4b");"string"===typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);var n=i("4f06").default;n("e826e494",r,!0,{sourceMap:!1,shadowMode:!1})},"96cf":function(e,t){!function(t){"use strict";var i,r=Object.prototype,n=r.hasOwnProperty,s="function"===typeof Symbol?Symbol:{},a=s.iterator||"@@iterator",o=s.asyncIterator||"@@asyncIterator",u=s.toStringTag||"@@toStringTag",c="object"===typeof e,l=t.regeneratorRuntime;if(l)c&&(e.exports=l);else{l=t.regeneratorRuntime=c?e.exports:{},l.wrap=b;var h="suspendedStart",f="suspendedYield",d="executing",p="completed",m={},g={};g[a]=function(){return this};var _=Object.getPrototypeOf,y=_&&_(_(F([])));y&&y!==r&&n.call(y,a)&&(g=y);var v=U.prototype=w.prototype=Object.create(g);S.prototype=v.constructor=U,U.constructor=S,U[u]=S.displayName="GeneratorFunction",l.isGeneratorFunction=function(e){var t="function"===typeof e&&e.constructor;return!!t&&(t===S||"GeneratorFunction"===(t.displayName||t.name))},l.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,U):(e.__proto__=U,u in e||(e[u]="GeneratorFunction")),e.prototype=Object.create(v),e},l.awrap=function(e){return{__await:e}},k(E.prototype),E.prototype[o]=function(){return this},l.AsyncIterator=E,l.async=function(e,t,i,r){var n=new E(b(e,t,i,r));return l.isGeneratorFunction(t)?n:n.next().then((function(e){return e.done?e.value:n.next()}))},k(v),v[u]="Generator",v[a]=function(){return this},v.toString=function(){return"[object Generator]"},l.keys=function(e){var t=[];for(var i in e)t.push(i);return t.reverse(),function i(){while(t.length){var r=t.pop();if(r in e)return i.value=r,i.done=!1,i}return i.done=!0,i}},l.values=F,B.prototype={constructor:B,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=i,this.done=!1,this.delegate=null,this.method="next",this.arg=i,this.tryEntries.forEach(P),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=i)},stop:function(){this.done=!0;var e=this.tryEntries[0],t=e.completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,n){return o.type="throw",o.arg=e,t.next=r,n&&(t.method="next",t.arg=i),!!n}for(var s=this.tryEntries.length-1;s>=0;--s){var a=this.tryEntries[s],o=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),c=n.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i];if(r.tryLoc<=this.prev&&n.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var s=r;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var a=s?s.completion:{};return a.type=e,a.arg=t,s?(this.method="next",this.next=s.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.finallyLoc===e)return this.complete(i.completion,i.afterLoc),P(i),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.tryLoc===e){var r=i.completion;if("throw"===r.type){var n=r.arg;P(i)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:F(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=i),m}}}function b(e,t,i,r){var n=t&&t.prototype instanceof w?t:w,s=Object.create(n.prototype),a=new B(r||[]);return s._invoke=A(e,i,a),s}function x(e,t,i){try{return{type:"normal",arg:e.call(t,i)}}catch(r){return{type:"throw",arg:r}}}function w(){}function S(){}function U(){}function k(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function E(e){function t(i,r,s,a){var o=x(e[i],e,r);if("throw"!==o.type){var u=o.arg,c=u.value;return c&&"object"===typeof c&&n.call(c,"__await")?Promise.resolve(c.__await).then((function(e){t("next",e,s,a)}),(function(e){t("throw",e,s,a)})):Promise.resolve(c).then((function(e){u.value=e,s(u)}),(function(e){return t("throw",e,s,a)}))}a(o.arg)}var i;function r(e,r){function n(){return new Promise((function(i,n){t(e,r,i,n)}))}return i=i?i.then(n,n):n()}this._invoke=r}function A(e,t,i){var r=h;return function(n,s){if(r===d)throw new Error("Generator is already running");if(r===p){if("throw"===n)throw s;return C()}i.method=n,i.arg=s;while(1){var a=i.delegate;if(a){var o=T(a,i);if(o){if(o===m)continue;return o}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(r===h)throw r=p,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);r=d;var u=x(e,t,i);if("normal"===u.type){if(r=i.done?p:f,u.arg===m)continue;return{value:u.arg,done:i.done}}"throw"===u.type&&(r=p,i.method="throw",i.arg=u.arg)}}}function T(e,t){var r=e.iterator[t.method];if(r===i){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=i,T(e,t),"throw"===t.method))return m;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var n=x(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,m;var s=n.arg;return s?s.done?(t[e.resultName]=s.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=i),t.delegate=null,m):s:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,m)}function I(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function B(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(I,this),this.reset(!0)}function F(e){if(e){var t=e[a];if(t)return t.call(e);if("function"===typeof e.next)return e;if(!isNaN(e.length)){var r=-1,s=function t(){while(++r<e.length)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=i,t.done=!0,t};return s.next=s}}return{next:C}}function C(){return{value:i,done:!0}}}(function(){return this||"object"===typeof self&&self}()||Function("return this")())},"99de":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=a;var r=s(i("53ca")),n=s(i("257e"));function s(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return!t||"object"!==(0,r.default)(t)&&"function"!==typeof t?(0,n.default)(e):t}},"9a3a":function(e,t,i){"use strict";var r=i("4ea4");i("d3b7"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,i("96cf");var n=r(i("1da1")),s={data:function(){return{title:"Hello",mediainfo:{}}},onLoad:function(){},methods:{onSelectFile:function(e){var t=this;return(0,n.default)(regeneratorRuntime.mark((function r(){var n,s,a,o,u,c;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=t,s=e.tempFiles[0],r.next=4,fetch(s.path);case 4:a=r.sent,o=a.body.getReader(),u=i("b915"),c=u.createFile(),c.onReady=function(e){console.log(e),n.mediainfo=e},o.read().then((function e(t){if(t.value&&(t.value.buffer.fileStart=0,c.appendBuffer(t.value.buffer)),!t.done)return o.read().then(e);c.flush()}));case 10:case"end":return r.stop()}}),r)})))()}}};t.default=s},a06f:function(e,t,i){"use strict";var r;i.d(t,"b",(function(){return n})),i.d(t,"c",(function(){return s})),i.d(t,"a",(function(){return r}));var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-uni-view",{staticClass:"uni-file-picker__files"},[e.readonly?e._e():i("v-uni-view",{staticClass:"files-button",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.choose.apply(void 0,arguments)}}},[e._t("default")],2),e.list.length>0?i("v-uni-view",{staticClass:"uni-file-picker__lists is-text-box",style:e.borderStyle},e._l(e.list,(function(t,r){return i("v-uni-view",{key:r,staticClass:"uni-file-picker__lists-box",class:{"files-border":0!==r&&e.styles.dividline},style:0!==r&&e.styles.dividline&&e.borderLineStyle},[i("v-uni-view",{staticClass:"uni-file-picker__item"},[i("v-uni-view",{staticClass:"files__name"},[e._v(e._s(t.name))]),e.delIcon&&!e.readonly?i("v-uni-view",{staticClass:"icon-del-box icon-files",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.delFile(r)}}},[i("v-uni-view",{staticClass:"icon-del icon-files"}),i("v-uni-view",{staticClass:"icon-del rotate"})],1):e._e()],1),t.progress&&100!==t.progress||0===t.progress?i("v-uni-view",{staticClass:"file-picker__progress"},[i("v-uni-progress",{staticClass:"file-picker__progress-item",attrs:{percent:-1===t.progress?0:t.progress,"stroke-width":"4",backgroundColor:t.errMsg?"#ff5a5f":"#EBEBEB"}})],1):e._e(),"error"===t.status?i("v-uni-view",{staticClass:"file-picker__mask",on:{click:function(i){i.stopPropagation(),arguments[0]=i=e.$handleEvent(i),e.uploadFiles(t,r)}}},[e._v("点击重试")]):e._e()],1)})),1):e._e()],1)},s=[]},a6e8:function(e,t,i){var r=i("07fb");"string"===typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);var n=i("4f06").default;n("3e346fca",r,!0,{sourceMap:!1,shadowMode:!1})},a9ff:function(e,t,i){"use strict";(function(e){var r=i("4ea4");i("a4d3"),i("e01a"),i("99af"),i("4de4"),i("7db0"),i("4160"),i("a630"),i("caad"),i("c975"),i("baa5"),i("d81d"),i("13d5"),i("26e9"),i("fb6a"),i("4e82"),i("a434"),i("f4b3"),i("6c57"),i("a9e3"),i("b64b"),i("d3b7"),i("e25e"),i("4d63"),i("ac1f"),i("5377"),i("25f0"),i("3ca3"),i("466d"),i("5319"),i("841c"),i("1276"),i("498a"),i("159b"),i("ddb0"),i("bf19"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,i("96cf");var n=r(i("1da1")),s=r(i("5530")),a=r(i("2909")),o=r(i("b85c")),u=r(i("bee2")),c=r(i("257e")),l=r(i("d4ec")),h=r(i("262e")),f=r(i("2caf")),d=r(i("9072")),p=i("37dc");function m(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function g(e,t,i){return e(i={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&i.path)}},i.exports),i.exports}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof e||"undefined"!=typeof self&&self;var _=g((function(e,t){var i;e.exports=(i=i||function(e,t){var i=Object.create||function(){function e(){}return function(t){var i;return e.prototype=t,i=new e,e.prototype=null,i}}(),r={},n=r.lib={},s=n.Base={extend:function(e){var t=i(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},a=n.WordArray=s.extend({init:function(e,i){e=this.words=e||[],this.sigBytes=i!=t?i:4*e.length},toString:function(e){return(e||u).stringify(this)},concat:function(e){var t=this.words,i=e.words,r=this.sigBytes,n=e.sigBytes;if(this.clamp(),r%4)for(var s=0;s<n;s++){var a=i[s>>>2]>>>24-s%4*8&255;t[r+s>>>2]|=a<<24-(r+s)%4*8}else for(s=0;s<n;s+=4)t[r+s>>>2]=i[s>>>2];return this.sigBytes+=n,this},clamp:function(){var t=this.words,i=this.sigBytes;t[i>>>2]&=4294967295<<32-i%4*8,t.length=e.ceil(i/4)},clone:function(){var e=s.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var i,r=[],n=function(t){t=t;var i=987654321,r=4294967295;return function(){var n=((i=36969*(65535&i)+(i>>16)&r)<<16)+(t=18e3*(65535&t)+(t>>16)&r)&r;return n/=4294967296,(n+=.5)*(e.random()>.5?1:-1)}},s=0;s<t;s+=4){var o=n(4294967296*(i||e.random()));i=987654071*o(),r.push(4294967296*o()|0)}return new a.init(r,t)}}),o=r.enc={},u=o.Hex={stringify:function(e){for(var t=e.words,i=e.sigBytes,r=[],n=0;n<i;n++){var s=t[n>>>2]>>>24-n%4*8&255;r.push((s>>>4).toString(16)),r.push((15&s).toString(16))}return r.join("")},parse:function(e){for(var t=e.length,i=[],r=0;r<t;r+=2)i[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new a.init(i,t/2)}},c=o.Latin1={stringify:function(e){for(var t=e.words,i=e.sigBytes,r=[],n=0;n<i;n++){var s=t[n>>>2]>>>24-n%4*8&255;r.push(String.fromCharCode(s))}return r.join("")},parse:function(e){for(var t=e.length,i=[],r=0;r<t;r++)i[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new a.init(i,t)}},l=o.Utf8={stringify:function(e){try{return decodeURIComponent(escape(c.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return c.parse(unescape(encodeURIComponent(e)))}},h=n.BufferedBlockAlgorithm=s.extend({reset:function(){this._data=new a.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=l.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var i=this._data,r=i.words,n=i.sigBytes,s=this.blockSize,o=n/(4*s),u=(o=t?e.ceil(o):e.max((0|o)-this._minBufferSize,0))*s,c=e.min(4*u,n);if(u){for(var l=0;l<u;l+=s)this._doProcessBlock(r,l);var h=r.splice(0,u);i.sigBytes-=c}return new a.init(h,c)},clone:function(){var e=s.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),f=(n.Hasher=h.extend({cfg:s.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){h.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,i){return new e.init(i).finalize(t)}},_createHmacHelper:function(e){return function(t,i){return new f.HMAC.init(e,i).finalize(t)}}}),r.algo={});return r}(Math),i)})),y=(g((function(e,t){var i;e.exports=(i=_,function(e){var t=i,r=t.lib,n=r.WordArray,s=r.Hasher,a=t.algo,o=[];!function(){for(var t=0;t<64;t++)o[t]=4294967296*e.abs(e.sin(t+1))|0}();var u=a.MD5=s.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var i=0;i<16;i++){var r=t+i,n=e[r];e[r]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8)}var s=this._hash.words,a=e[t+0],u=e[t+1],d=e[t+2],p=e[t+3],m=e[t+4],g=e[t+5],_=e[t+6],y=e[t+7],v=e[t+8],b=e[t+9],x=e[t+10],w=e[t+11],S=e[t+12],U=e[t+13],k=e[t+14],E=e[t+15],A=s[0],T=s[1],I=s[2],P=s[3];A=c(A,T,I,P,a,7,o[0]),P=c(P,A,T,I,u,12,o[1]),I=c(I,P,A,T,d,17,o[2]),T=c(T,I,P,A,p,22,o[3]),A=c(A,T,I,P,m,7,o[4]),P=c(P,A,T,I,g,12,o[5]),I=c(I,P,A,T,_,17,o[6]),T=c(T,I,P,A,y,22,o[7]),A=c(A,T,I,P,v,7,o[8]),P=c(P,A,T,I,b,12,o[9]),I=c(I,P,A,T,x,17,o[10]),T=c(T,I,P,A,w,22,o[11]),A=c(A,T,I,P,S,7,o[12]),P=c(P,A,T,I,U,12,o[13]),I=c(I,P,A,T,k,17,o[14]),A=l(A,T=c(T,I,P,A,E,22,o[15]),I,P,u,5,o[16]),P=l(P,A,T,I,_,9,o[17]),I=l(I,P,A,T,w,14,o[18]),T=l(T,I,P,A,a,20,o[19]),A=l(A,T,I,P,g,5,o[20]),P=l(P,A,T,I,x,9,o[21]),I=l(I,P,A,T,E,14,o[22]),T=l(T,I,P,A,m,20,o[23]),A=l(A,T,I,P,b,5,o[24]),P=l(P,A,T,I,k,9,o[25]),I=l(I,P,A,T,p,14,o[26]),T=l(T,I,P,A,v,20,o[27]),A=l(A,T,I,P,U,5,o[28]),P=l(P,A,T,I,d,9,o[29]),I=l(I,P,A,T,y,14,o[30]),A=h(A,T=l(T,I,P,A,S,20,o[31]),I,P,g,4,o[32]),P=h(P,A,T,I,v,11,o[33]),I=h(I,P,A,T,w,16,o[34]),T=h(T,I,P,A,k,23,o[35]),A=h(A,T,I,P,u,4,o[36]),P=h(P,A,T,I,m,11,o[37]),I=h(I,P,A,T,y,16,o[38]),T=h(T,I,P,A,x,23,o[39]),A=h(A,T,I,P,U,4,o[40]),P=h(P,A,T,I,a,11,o[41]),I=h(I,P,A,T,p,16,o[42]),T=h(T,I,P,A,_,23,o[43]),A=h(A,T,I,P,b,4,o[44]),P=h(P,A,T,I,S,11,o[45]),I=h(I,P,A,T,E,16,o[46]),A=f(A,T=h(T,I,P,A,d,23,o[47]),I,P,a,6,o[48]),P=f(P,A,T,I,y,10,o[49]),I=f(I,P,A,T,k,15,o[50]),T=f(T,I,P,A,g,21,o[51]),A=f(A,T,I,P,S,6,o[52]),P=f(P,A,T,I,p,10,o[53]),I=f(I,P,A,T,x,15,o[54]),T=f(T,I,P,A,u,21,o[55]),A=f(A,T,I,P,v,6,o[56]),P=f(P,A,T,I,E,10,o[57]),I=f(I,P,A,T,_,15,o[58]),T=f(T,I,P,A,U,21,o[59]),A=f(A,T,I,P,m,6,o[60]),P=f(P,A,T,I,w,10,o[61]),I=f(I,P,A,T,d,15,o[62]),T=f(T,I,P,A,b,21,o[63]),s[0]=s[0]+A|0,s[1]=s[1]+T|0,s[2]=s[2]+I|0,s[3]=s[3]+P|0},_doFinalize:function(){var t=this._data,i=t.words,r=8*this._nDataBytes,n=8*t.sigBytes;i[n>>>5]|=128<<24-n%32;var s=e.floor(r/4294967296),a=r;i[15+(n+64>>>9<<4)]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),i[14+(n+64>>>9<<4)]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),t.sigBytes=4*(i.length+1),this._process();for(var o=this._hash,u=o.words,c=0;c<4;c++){var l=u[c];u[c]=16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8)}return o},clone:function(){var e=s.clone.call(this);return e._hash=this._hash.clone(),e}});function c(e,t,i,r,n,s,a){var o=e+(t&i|~t&r)+n+a;return(o<<s|o>>>32-s)+t}function l(e,t,i,r,n,s,a){var o=e+(t&r|i&~r)+n+a;return(o<<s|o>>>32-s)+t}function h(e,t,i,r,n,s,a){var o=e+(t^i^r)+n+a;return(o<<s|o>>>32-s)+t}function f(e,t,i,r,n,s,a){var o=e+(i^(t|~r))+n+a;return(o<<s|o>>>32-s)+t}t.MD5=s._createHelper(u),t.HmacMD5=s._createHmacHelper(u)}(Math),i.MD5)})),g((function(e,t){var i,r,n;e.exports=(r=(i=_).lib.Base,n=i.enc.Utf8,void(i.algo.HMAC=r.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=n.parse(t));var i=e.blockSize,r=4*i;t.sigBytes>r&&(t=e.finalize(t)),t.clamp();for(var s=this._oKey=t.clone(),a=this._iKey=t.clone(),o=s.words,u=a.words,c=0;c<i;c++)o[c]^=1549556828,u[c]^=909522486;s.sigBytes=a.sigBytes=r,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,i=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(i))}})))})),g((function(e,t){e.exports=_.HmacMD5})));function v(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function b(e){return"object"===v(e)}var x=function(e){(0,h.default)(i,e);var t=(0,f.default)(i);function i(e,r){var n;return(0,l.default)(this,i),n=t.call(this,e),n.code=r,n}return i}((0,d.default)(Error));function w(e){return e&&"string"==typeof e?JSON.parse(e):e}var S=!1,U="h5",k=w(void 0),E=w([]),A=!0,T="";try{var I=i("6b51").default||i("6b51");T=I.appid}catch(Tt){}var P={};function B(e){var t,i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t=P,i=e,Object.prototype.hasOwnProperty.call(t,i)||(P[e]=r),P[e]}"app-plus"===U&&(P=uni._globalUniCloudObj?uni._globalUniCloudObj:uni._globalUniCloudObj={});var F=["invoke","success","fail","complete"],C=B("_globalUniCloudInterceptor");function L(e,t){C[e]||(C[e]={}),b(t)&&Object.keys(t).forEach((function(i){F.indexOf(i)>-1&&function(e,t,i){var r=C[e][t];r||(r=C[e][t]=[]),-1===r.indexOf(i)&&"function"==typeof i&&r.push(i)}(e,i,t[i])}))}function z(e,t){C[e]||(C[e]={}),b(t)?Object.keys(t).forEach((function(i){F.indexOf(i)>-1&&function(e,t,i){var r=C[e][t];if(r){var n=r.indexOf(i);n>-1&&r.splice(n,1)}}(e,i,t[i])})):delete C[e]}function O(e,t){return e&&0!==e.length?e.reduce((function(e,i){return e.then((function(){return i(t)}))}),Promise.resolve()):Promise.resolve()}function R(e,t){return C[e]&&C[e][t]||[]}function D(e,t){return t?function(i){var r,n=this,s="callFunction"===t&&"DCloud-clientDB"===(i&&i.name);r=this.isReady?Promise.resolve():this.initUniCloud,i=i||{};var a=r.then((function(){return s?Promise.resolve():O(R(t,"invoke"),i)})).then((function(){return e.call(n,i)})).then((function(e){return s?Promise.resolve(e):O(R(t,"success"),e).then((function(){return O(R(t,"complete"),e)})).then((function(){return Promise.resolve(e)}))}),(function(e){return s?Promise.reject(e):O(R(t,"fail"),e).then((function(){return O(R(t,"complete"),e)})).then((function(){return Promise.reject(e)}))}));if(!(i.success||i.fail||i.complete))return a;a.then((function(e){i.success&&i.success(e),i.complete&&i.complete(e)})).catch((function(e){i.fail&&i.fail(e),i.complete&&i.complete(e)}))}:function(t){if(!((t=t||{}).success||t.fail||t.complete))return e.call(this,t);e.call(this,t).then((function(e){t.success&&t.success(e),t.complete&&t.complete(e)}),(function(e){t.fail&&t.fail(e),t.complete&&t.complete(e)}))}}var M=function(e){(0,h.default)(i,e);var t=(0,f.default)(i);function i(e){var r;return(0,l.default)(this,i),r=t.call(this,e.message),r.errMsg=e.message||"",Object.defineProperties((0,c.default)(r),{code:{get:function(){return e.code}},requestId:{get:function(){return e.requestId}},message:{get:function(){return this.errMsg},set:function(e){this.errMsg=e}}}),r}return i}((0,d.default)(Error)),N=(0,p.initVueI18n)({"zh-Hans":{"uniCloud.init.paramRequired":"缺少参数：{param}","uniCloud.uploadFile.fileError":"filePath应为File对象"},"zh-Hant":{"uniCloud.init.paramRequired":"缺少参数：{param}","uniCloud.uploadFile.fileError":"filePath应为File对象"},en:{"uniCloud.init.paramRequired":"{param} required","uniCloud.uploadFile.fileError":"filePath should be instance of File"},fr:{"uniCloud.init.paramRequired":"{param} required","uniCloud.uploadFile.fileError":"filePath should be instance of File"},es:{"uniCloud.init.paramRequired":"{param} required","uniCloud.uploadFile.fileError":"filePath should be instance of File"}},"zh-Hans"),j=N.t,H=(N.setLocale,N.getLocale);function G(){var e=uni.getSystemInfoSync(),t=e.deviceId,i=e.platform;return{PLATFORM:U,OS:i,APPID:T,LOCALE:H(),DEVICEID:t,CLIENT_SDK_VERSION:"1.0.13"}}var q,Y={sign:function(e,t){var i="";return Object.keys(e).sort().forEach((function(t){e[t]&&(i=i+"&"+t+"="+e[t])})),i=i.slice(1),y(i,t).toString()},wrappedRequest:function(e,t){return new Promise((function(i,r){t(Object.assign(e,{complete:function(e){e||(e={}),S&&"h5"===U&&e.errMsg&&0===e.errMsg.indexOf("request:fail")&&console.warn("发布H5，需要在uniCloud后台操作，绑定安全域名，否则会因为跨域问题而无法访问。教程参考：https://uniapp.dcloud.io/uniCloud/quickstart?id=useinh5");var t=e.data&&e.data.header&&e.data.header["x-serverless-request-id"]||e.header&&e.header["request-id"];if(!e.statusCode||e.statusCode>=400)return r(new M({code:"SYS_ERR",message:e.errMsg||"request:fail",requestId:t}));var n=e.data;if(n.error)return r(new M({code:n.error.code,message:n.error.message,requestId:t}));n.result=n.data,n.requestId=t,delete n.data,i(n)}}))}))}},V={request:function(e){return uni.request(e)},uploadFile:function(e){return uni.uploadFile(e)},setStorageSync:function(e,t){return uni.setStorageSync(e,t)},getStorageSync:function(e){return uni.getStorageSync(e)},removeStorageSync:function(e){return uni.removeStorageSync(e)},clearStorageSync:function(){return uni.clearStorageSync()}},K=function(){function e(t){(0,l.default)(this,e),["spaceId","clientSecret"].forEach((function(e){if(!Object.prototype.hasOwnProperty.call(t,e))throw new Error(j("uniCloud.init.paramRequired",{param:e}))})),this.config=Object.assign({},{endpoint:"https://api.bspapp.com"},t),this.config.provider="aliyun",this.config.requestUrl=this.config.endpoint+"/client",this.config.envType=this.config.envType||"public",this.config.accessTokenKey="access_token_"+this.config.spaceId,this.adapter=V,this._getAccessTokenPromise=null,this._getAccessTokenPromiseStatus=null}return(0,u.default)(e,[{key:"setAccessToken",value:function(e){this.accessToken=e}},{key:"requestWrapped",value:function(e){return Y.wrappedRequest(e,this.adapter.request)}},{key:"requestAuth",value:function(e){return this.requestWrapped(e)}},{key:"request",value:function(e,t){var i=this;return Promise.resolve().then((function(){return i.hasAccessToken?t?i.requestWrapped(e):i.requestWrapped(e).catch((function(t){return new Promise((function(e,i){!t||"GATEWAY_INVALID_TOKEN"!==t.code&&"InvalidParameter.InvalidToken"!==t.code?i(t):e()})).then((function(){return i.getAccessToken()})).then((function(){var t=i.rebuildRequest(e);return i.request(t,!0)}))})):i.getAccessToken().then((function(){var t=i.rebuildRequest(e);return i.request(t,!0)}))}))}},{key:"rebuildRequest",value:function(e){var t=Object.assign({},e);return t.data.token=this.accessToken,t.header["x-basement-token"]=this.accessToken,t.header["x-serverless-sign"]=Y.sign(t.data,this.config.clientSecret),t}},{key:"setupRequest",value:function(e,t){var i=Object.assign({},e,{spaceId:this.config.spaceId,timestamp:Date.now()}),r={"Content-Type":"application/json"};return"auth"!==t&&(i.token=this.accessToken,r["x-basement-token"]=this.accessToken),r["x-serverless-sign"]=Y.sign(i,this.config.clientSecret),{url:this.config.requestUrl,method:"POST",data:i,dataType:"json",header:r}}},{key:"getAccessToken",value:function(){var e=this;return"pending"===this._getAccessTokenPromiseStatus||(this._getAccessTokenPromiseStatus="pending",this._getAccessTokenPromise=this.requestAuth(this.setupRequest({method:"serverless.auth.user.anonymousAuthorize",params:"{}"},"auth")).then((function(t){return new Promise((function(i,r){t.result&&t.result.accessToken?(e.setAccessToken(t.result.accessToken),e._getAccessTokenPromiseStatus="fulfilled",i(e.accessToken)):(e._getAccessTokenPromiseStatus="rejected",r(new M({code:"AUTH_FAILED",message:"获取accessToken失败"})))}))}),(function(t){return e._getAccessTokenPromiseStatus="rejected",Promise.reject(t)}))),this._getAccessTokenPromise}},{key:"authorize",value:function(){this.getAccessToken()}},{key:"callFunction",value:function(e){var t={method:"serverless.function.runtime.invoke",params:JSON.stringify({functionTarget:e.name,functionArgs:e.data||{}})};return this.request(this.setupRequest(t))}},{key:"getOSSUploadOptionsFromPath",value:function(e){var t={method:"serverless.file.resource.generateProximalSign",params:JSON.stringify(e)};return this.request(this.setupRequest(t))}},{key:"uploadFileToOSS",value:function(e){var t=this,i=e.url,r=e.formData,n=e.name,s=e.filePath,a=e.fileType,o=e.onUploadProgress;return new Promise((function(e,u){var c=t.adapter.uploadFile({url:i,formData:r,name:n,filePath:s,fileType:a,header:{"X-OSS-server-side-encrpytion":"AES256"},success:function(t){t&&t.statusCode<400?e(t):u(new M({code:"UPLOAD_FAILED",message:"文件上传失败"}))},fail:function(e){u(new M({code:e.code||"UPLOAD_FAILED",message:e.message||e.errMsg||"文件上传失败"}))}});"function"==typeof o&&c&&"function"==typeof c.onProgressUpdate&&c.onProgressUpdate((function(e){o({loaded:e.totalBytesSent,total:e.totalBytesExpectedToSend})}))}))}},{key:"reportOSSUpload",value:function(e){var t={method:"serverless.file.resource.report",params:JSON.stringify(e)};return this.request(this.setupRequest(t))}},{key:"uploadFile",value:function(e){var t=this,i=e.filePath,r=e.cloudPath,n=e.fileType,s=void 0===n?"image":n,a=e.onUploadProgress,o=e.config;if("string"!==v(r))throw new M({code:"INVALID_PARAM",message:"cloudPath必须为字符串类型"});if(!(r=r.trim()))throw new M({code:"CLOUDPATH_REQUIRED",message:"cloudPath不可为空"});if(/:\/\//.test(r))throw new M({code:"INVALID_PARAM",message:"cloudPath不合法"});var u,c,l=o&&o.envType||this.config.envType;return this.getOSSUploadOptionsFromPath({env:l,filename:r}).then((function(e){var r=e.result;u=r.id,c="https://"+r.cdnDomain+"/"+r.ossPath;var n={url:"https://"+r.host,formData:{"Cache-Control":"max-age=2592000","Content-Disposition":"attachment",OSSAccessKeyId:r.accessKeyId,Signature:r.signature,host:r.host,id:u,key:r.ossPath,policy:r.policy,success_action_status:200},fileName:"file",name:"file",filePath:i,fileType:s};return t.uploadFileToOSS(Object.assign({},n,{onUploadProgress:a}))})).then((function(){return t.reportOSSUpload({id:u})})).then((function(e){return new Promise((function(t,r){e.success?t({success:!0,filePath:i,fileID:c}):r(new M({code:"UPLOAD_FAILED",message:"文件上传失败"}))}))}))}},{key:"deleteFile",value:function(e){var t=e.fileList,i={method:"serverless.file.resource.delete",params:JSON.stringify({id:t[0]})};return this.request(this.setupRequest(i))}},{key:"getTempFileURL",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.fileList;return new Promise((function(e,i){Array.isArray(t)&&0!==t.length||i(new M({code:"INVALID_PARAM",message:"fileList的元素必须是非空的字符串"})),e({fileList:t.map((function(e){return{fileID:e,tempFileURL:e}}))})}))}},{key:"hasAccessToken",get:function(){return!!this.accessToken}}]),e}(),$={init:function(e){var t=new K(e),i={signInAnonymously:function(){return t.authorize()},getLoginState:function(){return Promise.resolve(!1)}};return t.auth=function(){return i},t.customAuth=t.auth,t}},W="undefined"!=typeof location&&"http:"===location.protocol?"http:":"https:";!function(e){e.local="local",e.none="none",e.session="session"}(q||(q={}));var J,X=function(){},Z=function(){var e;if(!Promise){e=function(){},e.promise={};var t=function(){throw new Error('Your Node runtime does support ES6 Promises. Set "global.Promise" to your preferred implementation of promises.')};return Object.defineProperty(e.promise,"then",{get:t}),Object.defineProperty(e.promise,"catch",{get:t}),e}var i=new Promise((function(t,i){e=function(e,r){return e?i(e):t(r)}}));return e.promise=i,e};function Q(e){return void 0===e}function ee(e){return"[object Null]"===Object.prototype.toString.call(e)}function te(e){var t,i,r=(t=e,"[object Array]"===Object.prototype.toString.call(t)?e:[e]),n=(0,o.default)(r);try{for(n.s();!(i=n.n()).done;){var s=i.value,a=s.isMatch,u=s.genAdapter,c=s.runtime;if(a())return{adapter:u(),runtime:c}}}catch(l){n.e(l)}finally{n.f()}}!function(e){e.WEB="web",e.WX_MP="wx_mp"}(J||(J={}));var ie={adapter:null,runtime:void 0},re=["anonymousUuidKey"],ne=function(e){(0,h.default)(i,e);var t=(0,f.default)(i);function i(){var e;return(0,l.default)(this,i),e=t.call(this),ie.adapter.root.tcbObject||(ie.adapter.root.tcbObject={}),e}return(0,u.default)(i,[{key:"setItem",value:function(e,t){ie.adapter.root.tcbObject[e]=t}},{key:"getItem",value:function(e){return ie.adapter.root.tcbObject[e]}},{key:"removeItem",value:function(e){delete ie.adapter.root.tcbObject[e]}},{key:"clear",value:function(){delete ie.adapter.root.tcbObject}}]),i}(X);function se(e,t){switch(e){case"local":return t.localStorage||new ne;case"none":return new ne;default:return t.sessionStorage||new ne}}var ae=function(){function e(t){if((0,l.default)(this,e),!this._storage){this._persistence=ie.adapter.primaryStorage||t.persistence,this._storage=se(this._persistence,ie.adapter);var i="access_token_".concat(t.env),r="access_token_expire_".concat(t.env),n="refresh_token_".concat(t.env),s="anonymous_uuid_".concat(t.env),a="login_type_".concat(t.env),o="user_info_".concat(t.env);this.keys={accessTokenKey:i,accessTokenExpireKey:r,refreshTokenKey:n,anonymousUuidKey:s,loginTypeKey:a,userInfoKey:o}}}return(0,u.default)(e,[{key:"updatePersistence",value:function(e){if(e!==this._persistence){var t="local"===this._persistence;this._persistence=e;var i=se(e,ie.adapter);for(var r in this.keys){var n=this.keys[r];if(!t||!re.includes(r)){var s=this._storage.getItem(n);Q(s)||ee(s)||(i.setItem(n,s),this._storage.removeItem(n))}}this._storage=i}}},{key:"setStore",value:function(e,t,i){if(this._storage){var r={version:i||"localCachev1",content:t},n=JSON.stringify(r);try{this._storage.setItem(e,n)}catch(e){throw e}}}},{key:"getStore",value:function(e,t){try{if(!this._storage)return}catch(e){return""}t=t||"localCachev1";var i=this._storage.getItem(e);return i&&i.indexOf(t)>=0?JSON.parse(i).content:""}},{key:"removeStore",value:function(e){this._storage.removeItem(e)}}]),e}(),oe={},ue={};function ce(e){return oe[e]}var le=function e(t,i){(0,l.default)(this,e),this.data=i||null,this.name=t},he=function(e){(0,h.default)(i,e);var t=(0,f.default)(i);function i(e,r){var n;return(0,l.default)(this,i),n=t.call(this,"error",{error:e,data:r}),n.error=e,n}return i}(le),fe=new(function(){function e(){(0,l.default)(this,e),this._listeners={}}return(0,u.default)(e,[{key:"on",value:function(e,t){return function(e,t,i){i[e]=i[e]||[],i[e].push(t)}(e,t,this._listeners),this}},{key:"off",value:function(e,t){return function(e,t,i){if(i&&i[e]){var r=i[e].indexOf(t);-1!==r&&i[e].splice(r,1)}}(e,t,this._listeners),this}},{key:"fire",value:function(e,t){if(e instanceof he)return console.error(e.error),this;var i="string"==typeof e?new le(e,t||{}):e,r=i.name;if(this._listens(r)){i.target=this;var n,s=this._listeners[r]?(0,a.default)(this._listeners[r]):[],u=(0,o.default)(s);try{for(u.s();!(n=u.n()).done;){var c=n.value;c.call(this,i)}}catch(l){u.e(l)}finally{u.f()}}return this}},{key:"_listens",value:function(e){return this._listeners[e]&&this._listeners[e].length>0}}]),e}());function de(e,t){fe.on(e,t)}function pe(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};fe.fire(e,t)}function me(e,t){fe.off(e,t)}var ge,_e="loginStateChanged",ye="loginStateExpire",ve="loginTypeChanged",be="anonymousConverted",xe="refreshAccessToken";!function(e){e.ANONYMOUS="ANONYMOUS",e.WECHAT="WECHAT",e.WECHAT_PUBLIC="WECHAT-PUBLIC",e.WECHAT_OPEN="WECHAT-OPEN",e.CUSTOM="CUSTOM",e.EMAIL="EMAIL",e.USERNAME="USERNAME",e.NULL="NULL"}(ge||(ge={}));var we=["auth.getJwt","auth.logout","auth.signInWithTicket","auth.signInAnonymously","auth.signIn","auth.fetchAccessTokenWithRefreshToken","auth.signUpWithEmailAndPassword","auth.activateEndUserMail","auth.sendPasswordResetEmail","auth.resetPasswordWithToken","auth.isUsernameRegistered"],Se={"X-SDK-Version":"1.3.5"};function Ue(e,t,i){var r=e[t];e[t]=function(t){var n={},a={};i.forEach((function(i){var r=i.call(e,t),s=r.data,o=r.headers;Object.assign(n,s),Object.assign(a,o)}));var o=t.data;return o&&function(){var e;if(e=o,"[object FormData]"!==Object.prototype.toString.call(e))t.data=(0,s.default)((0,s.default)({},o),n);else for(var i in n)o.append(i,n[i])}(),t.headers=(0,s.default)((0,s.default)({},t.headers||{}),a),r.call(e,t)}}function ke(){var e=Math.random().toString(16).slice(2);return{data:{seqId:e},headers:(0,s.default)((0,s.default)({},Se),{},{"x-seqid":e})}}var Ee=function(){function e(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,l.default)(this,e),this.config=i,this._reqClass=new ie.adapter.reqClass({timeout:this.config.timeout,timeoutMsg:"请求在".concat(this.config.timeout/1e3,"s内未完成，已中断"),restrictedMethods:["post"]}),this._cache=ce(this.config.env),this._localCache=(t=this.config.env,ue[t]),Ue(this._reqClass,"post",[ke]),Ue(this._reqClass,"upload",[ke]),Ue(this._reqClass,"download",[ke])}return(0,u.default)(e,[{key:"post",value:function(){var e=(0,n.default)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this._reqClass.post(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"upload",value:function(){var e=(0,n.default)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this._reqClass.upload(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"download",value:function(){var e=(0,n.default)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this._reqClass.download(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"refreshAccessToken",value:function(){var e=(0,n.default)(regeneratorRuntime.mark((function e(){var t,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this._refreshAccessTokenPromise||(this._refreshAccessTokenPromise=this._refreshAccessToken()),e.prev=1,e.next=4,this._refreshAccessTokenPromise;case 4:t=e.sent,e.next=10;break;case 7:e.prev=7,e.t0=e["catch"](1),i=e.t0;case 10:if(this._refreshAccessTokenPromise=null,this._shouldRefreshAccessTokenHook=null,!i){e.next=12;break}throw i;case 12:return e.abrupt("return",t);case 13:case"end":return e.stop()}}),e,this,[[1,7]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"_refreshAccessToken",value:function(){var e=(0,n.default)(regeneratorRuntime.mark((function e(){var t,i,r,n,s,a,o,u,c,l,h,f,d;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=this._cache.keys,i=t.accessTokenKey,r=t.accessTokenExpireKey,n=t.refreshTokenKey,s=t.loginTypeKey,a=t.anonymousUuidKey,this._cache.removeStore(i),this._cache.removeStore(r),o=this._cache.getStore(n),o){e.next=5;break}throw new Error("未登录CloudBase");case 5:return u={refresh_token:o},e.next=8,this.request("auth.fetchAccessTokenWithRefreshToken",u);case 8:if(c=e.sent,!c.data.code){e.next=21;break}if(l=c.data.code,"SIGN_PARAM_INVALID"!==l&&"REFRESH_TOKEN_EXPIRED"!==l&&"INVALID_REFRESH_TOKEN"!==l){e.next=20;break}if(this._cache.getStore(s)!==ge.ANONYMOUS||"INVALID_REFRESH_TOKEN"!==l){e.next=19;break}return h=this._cache.getStore(a),f=this._cache.getStore(n),e.next=17,this.send("auth.signInAnonymously",{anonymous_uuid:h,refresh_token:f});case 17:return d=e.sent,e.abrupt("return",(this.setRefreshToken(d.refresh_token),this._refreshAccessToken()));case 19:pe(ye),this._cache.removeStore(n);case 20:throw new Error("刷新access token失败：".concat(c.data.code));case 21:if(!c.data.access_token){e.next=23;break}return e.abrupt("return",(pe(xe),this._cache.setStore(i,c.data.access_token),this._cache.setStore(r,c.data.access_token_expire+Date.now()),{accessToken:c.data.access_token,accessTokenExpire:c.data.access_token_expire}));case 23:c.data.refresh_token&&(this._cache.removeStore(n),this._cache.setStore(n,c.data.refresh_token),this._refreshAccessToken());case 24:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getAccessToken",value:function(){var e=(0,n.default)(regeneratorRuntime.mark((function e(){var t,i,r,n,s,a,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=this._cache.keys,i=t.accessTokenKey,r=t.accessTokenExpireKey,n=t.refreshTokenKey,this._cache.getStore(n)){e.next=3;break}throw new Error("refresh token不存在，登录状态异常");case 3:if(s=this._cache.getStore(i),a=this._cache.getStore(r),o=!0,e.t0=this._shouldRefreshAccessTokenHook,!e.t0){e.next=9;break}return e.next=8,this._shouldRefreshAccessTokenHook(s,a);case 8:e.t0=!e.sent;case 9:if(e.t1=e.t0,!e.t1){e.next=12;break}o=!1;case 12:return e.abrupt("return",(!s||!a||a<Date.now())&&o?this.refreshAccessToken():{accessToken:s,accessTokenExpire:a});case 13:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"request",value:function(){var e=(0,n.default)(regeneratorRuntime.mark((function e(t,i,r){var n,a,o,u,c,l,h,f,d,p,m,g,_,y,v,b;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n="x-tcb-trace_".concat(this.config.env),a="application/x-www-form-urlencoded",o=(0,s.default)({action:t,env:this.config.env,dataVersion:"2019-08-16"},i),-1!==we.indexOf(t)){e.next=10;break}if(u=this._cache.keys.refreshTokenKey,e.t0=this._cache.getStore(u),!e.t0){e.next=10;break}return e.next=9,this.getAccessToken();case 9:o.access_token=e.sent.accessToken;case 10:if("storage.uploadFile"===t){for(l in c=new FormData,c)c.hasOwnProperty(l)&&void 0!==c[l]&&c.append(l,o[l]);a="multipart/form-data"}else for(h in a="application/json",c={},o)void 0!==o[h]&&(c[h]=o[h]);return f={headers:{"content-type":a}},r&&r.onUploadProgress&&(f.onUploadProgress=r.onUploadProgress),d=this._localCache.getStore(n),d&&(f.headers["X-TCB-Trace"]=d),p=i.parse,m=i.inQuery,g=i.search,_={env:this.config.env},p&&(_.parse=!0),m&&(_=(0,s.default)((0,s.default)({},m),_)),y=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=/\?/.test(t),n="";for(var s in i)""===n?!r&&(t+="?"):n+="&",n+="".concat(s,"=").concat(encodeURIComponent(i[s]));return/^http(s)?\:\/\//.test(t+=n)?t:"".concat(e).concat(t)}(W,"//tcb-api.tencentcloudapi.com/web",_),g&&(y+=g),e.next=22,this.post((0,s.default)({url:y,data:c},f));case 22:if(v=e.sent,b=v.header&&v.header["x-tcb-trace"],b&&this._localCache.setStore(n,b),(200===Number(v.status)||200===Number(v.statusCode))&&v.data){e.next=26;break}throw new Error("network request error");case 26:return e.abrupt("return",v);case 27:case"end":return e.stop()}}),e,this)})));function t(t,i,r){return e.apply(this,arguments)}return t}()},{key:"send",value:function(){var e=(0,n.default)(regeneratorRuntime.mark((function e(t){var i,r,n,s=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i=s.length>1&&void 0!==s[1]?s[1]:{},e.next=3,this.request(t,i,{onUploadProgress:i.onUploadProgress});case 3:if(r=e.sent,"ACCESS_TOKEN_EXPIRED"!==r.data.code||-1!==we.indexOf(t)){e.next=13;break}return e.next=7,this.refreshAccessToken();case 7:return e.next=9,this.request(t,i,{onUploadProgress:i.onUploadProgress});case 9:if(n=e.sent,!n.data.code){e.next=12;break}throw new Error("[".concat(n.data.code,"] ").concat(n.data.message));case 12:return e.abrupt("return",n.data);case 13:if(!r.data.code){e.next=15;break}throw new Error("[".concat(r.data.code,"] ").concat(r.data.message));case 15:return e.abrupt("return",r.data);case 16:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"setRefreshToken",value:function(e){var t=this._cache.keys,i=t.accessTokenKey,r=t.accessTokenExpireKey,n=t.refreshTokenKey;this._cache.removeStore(i),this._cache.removeStore(r),this._cache.setStore(n,e)}}]),e}(),Ae={};function Te(e){return Ae[e]}var Ie=function(){function e(t){(0,l.default)(this,e),this.config=t,this._cache=ce(t.env),this._request=Te(t.env)}return(0,u.default)(e,[{key:"setRefreshToken",value:function(e){var t=this._cache.keys,i=t.accessTokenKey,r=t.accessTokenExpireKey,n=t.refreshTokenKey;this._cache.removeStore(i),this._cache.removeStore(r),this._cache.setStore(n,e)}},{key:"setAccessToken",value:function(e,t){var i=this._cache.keys,r=i.accessTokenKey,n=i.accessTokenExpireKey;this._cache.setStore(r,e),this._cache.setStore(n,t)}},{key:"refreshUserInfo",value:function(){var e=(0,n.default)(regeneratorRuntime.mark((function e(){var t,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this._request.send("auth.getUserInfo",{});case 2:return t=e.sent,i=t.data,e.abrupt("return",(this.setLocalUserInfo(i),i));case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"setLocalUserInfo",value:function(e){var t=this._cache.keys.userInfoKey;this._cache.setStore(t,e)}}]),e}(),Pe=function(){function e(t){if((0,l.default)(this,e),!t)throw new Error("envId is not defined");this._envId=t,this._cache=ce(this._envId),this._request=Te(this._envId),this.setUserInfo()}return(0,u.default)(e,[{key:"linkWithTicket",value:function(e){if("string"!=typeof e)throw new Error("ticket must be string");return this._request.send("auth.linkWithTicket",{ticket:e})}},{key:"linkWithRedirect",value:function(e){e.signInWithRedirect()}},{key:"updatePassword",value:function(e,t){return this._request.send("auth.updatePassword",{oldPassword:t,newPassword:e})}},{key:"updateEmail",value:function(e){return this._request.send("auth.updateEmail",{newEmail:e})}},{key:"updateUsername",value:function(e){if("string"!=typeof e)throw new Error("username must be a string");return this._request.send("auth.updateUsername",{username:e})}},{key:"getLinkedUidList",value:function(){var e=(0,n.default)(regeneratorRuntime.mark((function e(){var t,i,r,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this._request.send("auth.getLinkedUidList",{});case 2:return t=e.sent,i=t.data,r=!1,n=i.users,e.abrupt("return",(n.forEach((function(e){e.wxOpenId&&e.wxPublicId&&(r=!0)})),{users:n,hasPrimaryUid:r}));case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"setPrimaryUid",value:function(e){return this._request.send("auth.setPrimaryUid",{uid:e})}},{key:"unlink",value:function(e){return this._request.send("auth.unlink",{platform:e})}},{key:"update",value:function(){var e=(0,n.default)(regeneratorRuntime.mark((function e(t){var i,r,n,s,a,o,u,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i=t.nickName,r=t.gender,n=t.avatarUrl,s=t.province,a=t.country,o=t.city,e.next=8,this._request.send("auth.updateUserInfo",{nickName:i,gender:r,avatarUrl:n,province:s,country:a,city:o});case 8:u=e.sent,c=u.data,this.setLocalUserInfo(c);case 11:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"refresh",value:function(){var e=(0,n.default)(regeneratorRuntime.mark((function e(){var t,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this._request.send("auth.getUserInfo",{});case 2:return t=e.sent,i=t.data,e.abrupt("return",(this.setLocalUserInfo(i),i));case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"setUserInfo",value:function(){var e=this,t=this._cache.keys.userInfoKey,i=this._cache.getStore(t);["uid","loginType","openid","wxOpenId","wxPublicId","unionId","qqMiniOpenId","email","hasPassword","customUserId","nickName","gender","avatarUrl"].forEach((function(t){e[t]=i[t]})),this.location={country:i.country,province:i.province,city:i.city}}},{key:"setLocalUserInfo",value:function(e){var t=this._cache.keys.userInfoKey;this._cache.setStore(t,e),this.setUserInfo()}}]),e}(),Be=function(){function e(t){if((0,l.default)(this,e),!t)throw new Error("envId is not defined");this._cache=ce(t);var i=this._cache.keys,r=i.refreshTokenKey,n=i.accessTokenKey,s=i.accessTokenExpireKey,a=this._cache.getStore(r),o=this._cache.getStore(n),u=this._cache.getStore(s);this.credential={refreshToken:a,accessToken:o,accessTokenExpire:u},this.user=new Pe(t)}return(0,u.default)(e,[{key:"isAnonymousAuth",get:function(){return this.loginType===ge.ANONYMOUS}},{key:"isCustomAuth",get:function(){return this.loginType===ge.CUSTOM}},{key:"isWeixinAuth",get:function(){return this.loginType===ge.WECHAT||this.loginType===ge.WECHAT_OPEN||this.loginType===ge.WECHAT_PUBLIC}},{key:"loginType",get:function(){return this._cache.getStore(this._cache.keys.loginTypeKey)}}]),e}(),Fe=function(e){(0,h.default)(i,e);var t=(0,f.default)(i);function i(){return(0,l.default)(this,i),t.apply(this,arguments)}return(0,u.default)(i,[{key:"signIn",value:function(){var e=(0,n.default)(regeneratorRuntime.mark((function e(){var t,i,r,n,s,a,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this._cache.updatePersistence("local"),t=this._cache.keys,i=t.anonymousUuidKey,r=t.refreshTokenKey,n=this._cache.getStore(i)||void 0,s=this._cache.getStore(r)||void 0,e.next=8,this._request.send("auth.signInAnonymously",{anonymous_uuid:n,refresh_token:s});case 8:if(a=e.sent,!a.uuid||!a.refresh_token){e.next=20;break}return this._setAnonymousUUID(a.uuid),this.setRefreshToken(a.refresh_token),e.next=14,this._request.refreshAccessToken();case 14:return pe(_e),pe(ve,{env:this.config.env,loginType:ge.ANONYMOUS,persistence:"local"}),o=new Be(this.config.env),e.next=19,o.user.refresh();case 19:return e.abrupt("return",o);case 20:throw new Error("匿名登录失败");case 21:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"linkAndRetrieveDataWithTicket",value:function(){var e=(0,n.default)(regeneratorRuntime.mark((function e(t){var i,r,n,s,a,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i=this._cache.keys,r=i.anonymousUuidKey,n=i.refreshTokenKey,s=this._cache.getStore(r),a=this._cache.getStore(n),e.next=7,this._request.send("auth.linkAndRetrieveDataWithTicket",{anonymous_uuid:s,refresh_token:a,ticket:t});case 7:if(o=e.sent,!o.refresh_token){e.next=16;break}return this._clearAnonymousUUID(),this.setRefreshToken(o.refresh_token),e.next=13,this._request.refreshAccessToken();case 13:return pe(be,{env:this.config.env}),pe(ve,{loginType:ge.CUSTOM,persistence:"local"}),e.abrupt("return",{credential:{refreshToken:o.refresh_token}});case 16:throw new Error("匿名转化失败");case 17:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"_setAnonymousUUID",value:function(e){var t=this._cache.keys,i=t.anonymousUuidKey,r=t.loginTypeKey;this._cache.removeStore(i),this._cache.setStore(i,e),this._cache.setStore(r,ge.ANONYMOUS)}},{key:"_clearAnonymousUUID",value:function(){this._cache.removeStore(this._cache.keys.anonymousUuidKey)}}]),i}(Ie),Ce=function(e){(0,h.default)(i,e);var t=(0,f.default)(i);function i(){return(0,l.default)(this,i),t.apply(this,arguments)}return(0,u.default)(i,[{key:"signIn",value:function(){var e=(0,n.default)(regeneratorRuntime.mark((function e(t){var i,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new Error("ticket must be a string");case 2:return i=this._cache.keys.refreshTokenKey,e.next=5,this._request.send("auth.signInWithTicket",{ticket:t,refresh_token:this._cache.getStore(i)||""});case 5:if(r=e.sent,!r.refresh_token){e.next=15;break}return this.setRefreshToken(r.refresh_token),e.next=10,this._request.refreshAccessToken();case 10:return pe(_e),pe(ve,{env:this.config.env,loginType:ge.CUSTOM,persistence:this.config.persistence}),e.next=14,this.refreshUserInfo();case 14:return e.abrupt("return",new Be(this.config.env));case 15:throw new Error("自定义登录失败");case 16:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()}]),i}(Ie),Le=function(e){(0,h.default)(i,e);var t=(0,f.default)(i);function i(){return(0,l.default)(this,i),t.apply(this,arguments)}return(0,u.default)(i,[{key:"signIn",value:function(){var e=(0,n.default)(regeneratorRuntime.mark((function e(t,i){var r,n,s,a,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new Error("email must be a string");case 2:return r=this._cache.keys.refreshTokenKey,e.next=5,this._request.send("auth.signIn",{loginType:"EMAIL",email:t,password:i,refresh_token:this._cache.getStore(r)||""});case 5:if(n=e.sent,s=n.refresh_token,a=n.access_token,o=n.access_token_expire,!s){e.next=22;break}if(this.setRefreshToken(s),!a||!o){e.next=15;break}this.setAccessToken(a,o),e.next=17;break;case 15:return e.next=17,this._request.refreshAccessToken();case 17:return e.next=19,this.refreshUserInfo();case 19:return pe(_e),pe(ve,{env:this.config.env,loginType:ge.EMAIL,persistence:this.config.persistence}),e.abrupt("return",new Be(this.config.env));case 22:throw n.code?new Error("邮箱登录失败: [".concat(n.code,"] ").concat(n.message)):new Error("邮箱登录失败");case 23:case"end":return e.stop()}}),e,this)})));function t(t,i){return e.apply(this,arguments)}return t}()},{key:"activate",value:function(){var e=(0,n.default)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this._request.send("auth.activateEndUserMail",{token:t}));case 1:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"resetPasswordWithToken",value:function(){var e=(0,n.default)(regeneratorRuntime.mark((function e(t,i){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this._request.send("auth.resetPasswordWithToken",{token:t,newPassword:i}));case 1:case"end":return e.stop()}}),e,this)})));function t(t,i){return e.apply(this,arguments)}return t}()}]),i}(Ie),ze=function(e){(0,h.default)(i,e);var t=(0,f.default)(i);function i(){return(0,l.default)(this,i),t.apply(this,arguments)}return(0,u.default)(i,[{key:"signIn",value:function(){var e=(0,n.default)(regeneratorRuntime.mark((function e(t,i){var r,n,s,a,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new Error("username must be a string");case 2:return"string"!=typeof i&&(i="",console.warn("password is empty")),r=this._cache.keys.refreshTokenKey,e.next=6,this._request.send("auth.signIn",{loginType:ge.USERNAME,username:t,password:i,refresh_token:this._cache.getStore(r)||""});case 6:if(n=e.sent,s=n.refresh_token,a=n.access_token_expire,o=n.access_token,!s){e.next=23;break}if(this.setRefreshToken(s),!o||!a){e.next=16;break}this.setAccessToken(o,a),e.next=18;break;case 16:return e.next=18,this._request.refreshAccessToken();case 18:return e.next=20,this.refreshUserInfo();case 20:return pe(_e),pe(ve,{env:this.config.env,loginType:ge.USERNAME,persistence:this.config.persistence}),e.abrupt("return",new Be(this.config.env));case 23:throw n.code?new Error("用户名密码登录失败: [".concat(n.code,"] ").concat(n.message)):new Error("用户名密码登录失败");case 24:case"end":return e.stop()}}),e,this)})));function t(t,i){return e.apply(this,arguments)}return t}()}]),i}(Ie),Oe=function(){function e(t){(0,l.default)(this,e),this.config=t,this._cache=ce(t.env),this._request=Te(t.env),this._onAnonymousConverted=this._onAnonymousConverted.bind(this),this._onLoginTypeChanged=this._onLoginTypeChanged.bind(this),de(ve,this._onLoginTypeChanged)}return(0,u.default)(e,[{key:"anonymousAuthProvider",value:function(){return new Fe(this.config)}},{key:"customAuthProvider",value:function(){return new Ce(this.config)}},{key:"emailAuthProvider",value:function(){return new Le(this.config)}},{key:"usernameAuthProvider",value:function(){return new ze(this.config)}},{key:"signInAnonymously",value:function(){var e=(0,n.default)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new Fe(this.config).signIn());case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"signInWithEmailAndPassword",value:function(){var e=(0,n.default)(regeneratorRuntime.mark((function e(t,i){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new Le(this.config).signIn(t,i));case 1:case"end":return e.stop()}}),e,this)})));function t(t,i){return e.apply(this,arguments)}return t}()},{key:"signInWithUsernameAndPassword",value:function(e,t){return new ze(this.config).signIn(e,t)}},{key:"linkAndRetrieveDataWithTicket",value:function(){var e=(0,n.default)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this._anonymousAuthProvider||(this._anonymousAuthProvider=new Fe(this.config)),de(be,this._onAnonymousConverted),e.next=3,this._anonymousAuthProvider.linkAndRetrieveDataWithTicket(t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"signOut",value:function(){var e=(0,n.default)(regeneratorRuntime.mark((function e(){var t,i,r,n,s,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.loginType!==ge.ANONYMOUS){e.next=2;break}throw new Error("匿名用户不支持登出操作");case 2:if(t=this._cache.keys,i=t.refreshTokenKey,r=t.accessTokenKey,n=t.accessTokenExpireKey,s=this._cache.getStore(i),s){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,this._request.send("auth.logout",{refresh_token:s});case 7:return a=e.sent,e.abrupt("return",(this._cache.removeStore(i),this._cache.removeStore(r),this._cache.removeStore(n),pe(_e),pe(ve,{env:this.config.env,loginType:ge.NULL,persistence:this.config.persistence}),a));case 9:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"signUpWithEmailAndPassword",value:function(){var e=(0,n.default)(regeneratorRuntime.mark((function e(t,i){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this._request.send("auth.signUpWithEmailAndPassword",{email:t,password:i}));case 1:case"end":return e.stop()}}),e,this)})));function t(t,i){return e.apply(this,arguments)}return t}()},{key:"sendPasswordResetEmail",value:function(){var e=(0,n.default)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this._request.send("auth.sendPasswordResetEmail",{email:t}));case 1:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"onLoginStateChanged",value:function(e){var t=this;de(_e,(function(){var i=t.hasLoginState();e.call(t,i)}));var i=this.hasLoginState();e.call(this,i)}},{key:"onLoginStateExpired",value:function(e){de(ye,e.bind(this))}},{key:"onAccessTokenRefreshed",value:function(e){de(xe,e.bind(this))}},{key:"onAnonymousConverted",value:function(e){de(be,e.bind(this))}},{key:"onLoginTypeChanged",value:function(e){var t=this;de(ve,(function(){var i=t.hasLoginState();e.call(t,i)}))}},{key:"getAccessToken",value:function(){var e=(0,n.default)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this._request.getAccessToken();case 2:return e.t0=e.sent.accessToken,e.t1=this.config.env,e.abrupt("return",{accessToken:e.t0,env:e.t1});case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"hasLoginState",value:function(){var e=this._cache.keys.refreshTokenKey;return this._cache.getStore(e)?new Be(this.config.env):null}},{key:"isUsernameRegistered",value:function(){var e=(0,n.default)(regeneratorRuntime.mark((function e(t){var i,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new Error("username must be a string");case 2:return e.next=4,this._request.send("auth.isUsernameRegistered",{username:t});case 4:return i=e.sent,r=i.data,e.abrupt("return",r&&r.isRegistered);case 7:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getLoginState",value:function(){return Promise.resolve(this.hasLoginState())}},{key:"signInWithTicket",value:function(){var e=(0,n.default)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new Ce(this.config).signIn(t));case 1:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"shouldRefreshAccessToken",value:function(e){this._request._shouldRefreshAccessTokenHook=e.bind(this)}},{key:"getUserInfo",value:function(){return this._request.send("auth.getUserInfo",{}).then((function(e){return e.code?e:(0,s.default)((0,s.default)({},e.data),{},{requestId:e.seqId})}))}},{key:"getAuthHeader",value:function(){var e=this._cache.keys,t=e.refreshTokenKey,i=e.accessTokenKey,r=this._cache.getStore(t);return{"x-cloudbase-credentials":this._cache.getStore(i)+"/@@/"+r}}},{key:"_onAnonymousConverted",value:function(e){var t=e.data.env;t===this.config.env&&this._cache.updatePersistence(this.config.persistence)}},{key:"_onLoginTypeChanged",value:function(e){var t=e.data,i=t.loginType,r=t.persistence,n=t.env;n===this.config.env&&(this._cache.updatePersistence(r),this._cache.setStore(this._cache.keys.loginTypeKey,i))}},{key:"currentUser",get:function(){var e=this.hasLoginState();return e&&e.user||null}},{key:"loginType",get:function(){return this._cache.getStore(this._cache.keys.loginTypeKey)}}]),e}(),Re=function(e,t){t=t||Z();var i=Te(this.config.env),r=e.cloudPath,n=e.filePath,s=e.onUploadProgress,a=e.fileType,o=void 0===a?"image":a;return i.send("storage.getUploadMetadata",{path:r}).then((function(e){var a=e.data,u=a.url,c=a.authorization,l=a.token,h=a.fileId,f=a.cosFileId,d=e.requestId,p={key:r,signature:c,"x-cos-meta-fileid":f,success_action_status:"201","x-cos-security-token":l};i.upload({url:u,data:p,file:n,name:r,fileType:o,onUploadProgress:s}).then((function(e){201===e.statusCode?t(null,{fileID:h,requestId:d}):t(new Error("STORAGE_REQUEST_FAIL: ".concat(e.data)))})).catch((function(e){t(e)}))})).catch((function(e){t(e)})),t.promise},De=function(e,t){t=t||Z();var i=Te(this.config.env),r=e.cloudPath;return i.send("storage.getUploadMetadata",{path:r}).then((function(e){t(null,e)})).catch((function(e){t(e)})),t.promise},Me=function(e,t){var i=e.fileList;if(t=t||Z(),!i||!Array.isArray(i))return{code:"INVALID_PARAM",message:"fileList必须是非空的数组"};var r,n=(0,o.default)(i);try{for(n.s();!(r=n.n()).done;){var s=r.value;if(!s||"string"!=typeof s)return{code:"INVALID_PARAM",message:"fileList的元素必须是非空的字符串"}}}catch(u){n.e(u)}finally{n.f()}var a={fileid_list:i};return Te(this.config.env).send("storage.batchDeleteFile",a).then((function(e){e.code?t(null,e):t(null,{fileList:e.data.delete_list,requestId:e.requestId})})).catch((function(e){t(e)})),t.promise},Ne=function(e,t){var i=e.fileList;t=t||Z(),i&&Array.isArray(i)||t(null,{code:"INVALID_PARAM",message:"fileList必须是非空的数组"});var r,n=[],s=(0,o.default)(i);try{for(s.s();!(r=s.n()).done;){var a=r.value;"object"==typeof a?(a.hasOwnProperty("fileID")&&a.hasOwnProperty("maxAge")||t(null,{code:"INVALID_PARAM",message:"fileList的元素必须是包含fileID和maxAge的对象"}),n.push({fileid:a.fileID,max_age:a.maxAge})):"string"==typeof a?n.push({fileid:a}):t(null,{code:"INVALID_PARAM",message:"fileList的元素必须是字符串"})}}catch(c){s.e(c)}finally{s.f()}var u={file_list:n};return Te(this.config.env).send("storage.batchGetDownloadUrl",u).then((function(e){e.code?t(null,e):t(null,{fileList:e.data.download_list,requestId:e.requestId})})).catch((function(e){t(e)})),t.promise},je=function(){var e=(0,n.default)(regeneratorRuntime.mark((function e(t,i){var r,n,s,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=t.fileID,e.next=3,Ne.call(this,{fileList:[{fileID:r,maxAge:600}]});case 3:if(n=e.sent.fileList[0],"SUCCESS"===n.code){e.next=6;break}return e.abrupt("return",i?i(n):new Promise((function(e){e(n)})));case 6:if(s=Te(this.config.env),a=n.download_url,a=encodeURI(a),i){e.next=10;break}return e.abrupt("return",s.download({url:a}));case 10:return e.t0=i,e.next=13,s.download({url:a});case 13:e.t1=e.sent,(0,e.t0)(e.t1);case 15:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}(),He=function(e,t){var i,r=e.name,n=e.data,s=e.query,a=e.parse,o=e.search,u=t||Z();try{i=n?JSON.stringify(n):""}catch(r){return Promise.reject(r)}if(!r)return Promise.reject(new Error("函数名不能为空"));var c={inQuery:s,parse:a,search:o,function_name:r,request_data:i};return Te(this.config.env).send("functions.invokeFunction",c).then((function(e){if(e.code)u(null,e);else{var t=e.data.response_data;if(a)u(null,{result:t,requestId:e.requestId});else try{t=JSON.parse(e.data.response_data),u(null,{result:t,requestId:e.requestId})}catch(e){u(new Error("response data must be json"))}}return u.promise})).catch((function(e){u(e)})),u.promise},Ge={timeout:15e3,persistence:"session"},qe={},Ye=function(){function e(t){(0,l.default)(this,e),this.config=t||this.config,this.authObj=void 0}return(0,u.default)(e,[{key:"init",value:function(t){switch(ie.adapter||(this.requestClient=new ie.adapter.reqClass({timeout:t.timeout||5e3,timeoutMsg:"请求在".concat((t.timeout||5e3)/1e3,"s内未完成，已中断")})),this.config=(0,s.default)((0,s.default)({},Ge),t),!0){case this.config.timeout>6e5:console.warn("timeout大于可配置上限[10分钟]，已重置为上限数值"),this.config.timeout=6e5;break;case this.config.timeout<100:console.warn("timeout小于可配置下限[100ms]，已重置为下限数值"),this.config.timeout=100}return new e(this.config)}},{key:"auth",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.persistence;if(this.authObj)return this.authObj;var i,r=t||ie.adapter.primaryStorage||Ge.persistence;return r!==this.config.persistence&&(this.config.persistence=r),function(e){var t=e.env;oe[t]=new ae(e),ue[t]=new ae((0,s.default)((0,s.default)({},e),{},{persistence:"local"}))}(this.config),i=this.config,Ae[i.env]=new Ee(i),this.authObj=new Oe(this.config),this.authObj}},{key:"on",value:function(e,t){return de.apply(this,[e,t])}},{key:"off",value:function(e,t){return me.apply(this,[e,t])}},{key:"callFunction",value:function(e,t){return He.apply(this,[e,t])}},{key:"deleteFile",value:function(e,t){return Me.apply(this,[e,t])}},{key:"getTempFileURL",value:function(e,t){return Ne.apply(this,[e,t])}},{key:"downloadFile",value:function(e,t){return je.apply(this,[e,t])}},{key:"uploadFile",value:function(e,t){return Re.apply(this,[e,t])}},{key:"getUploadMetadata",value:function(e,t){return De.apply(this,[e,t])}},{key:"registerExtension",value:function(e){qe[e.name]=e}},{key:"invokeExtension",value:function(){var e=(0,n.default)(regeneratorRuntime.mark((function e(t,i){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(r=qe[t],r){e.next=3;break}throw Error("扩展".concat(t," 必须先注册"));case 3:return e.next=5,r.invoke(i,this);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)})));function t(t,i){return e.apply(this,arguments)}return t}()},{key:"useAdapters",value:function(e){var t=te(e)||{},i=t.adapter,r=t.runtime;i&&(ie.adapter=i),r&&(ie.runtime=r)}}]),e}(),Ve=new Ye;function Ke(e,t,i){void 0===i&&(i={});var r=/\?/.test(t),n="";for(var s in i)""===n?!r&&(t+="?"):n+="&",n+=s+"="+encodeURIComponent(i[s]);return/^http(s)?:\/\//.test(t+=n)?t:""+e+t}var $e=function(){function e(){(0,l.default)(this,e)}return(0,u.default)(e,[{key:"post",value:function(e){var t=e.url,i=e.data,r=e.headers;return new Promise((function(e,n){V.request({url:Ke("https:",t),data:i,method:"POST",header:r,success:function(t){e(t)},fail:function(e){n(e)}})}))}},{key:"upload",value:function(e){return new Promise((function(t,i){var r=e.url,n=e.file,s=e.data,a=e.headers,o=e.fileType,u=V.uploadFile({url:Ke("https:",r),name:"file",formData:Object.assign({},s),filePath:n,fileType:o,header:a,success:function(e){var i={statusCode:e.statusCode,data:e.data||{}};200===e.statusCode&&s.success_action_status&&(i.statusCode=parseInt(s.success_action_status,10)),t(i)},fail:function(e){S&&"mp-alipay"===U&&console.warn("支付宝小程序开发工具上传腾讯云时无法准确判断是否上传成功，请使用真机测试"),i(new Error(e.errMsg||"uploadFile:fail"))}});"function"==typeof e.onUploadProgress&&u&&"function"==typeof u.onProgressUpdate&&u.onProgressUpdate((function(t){e.onUploadProgress({loaded:t.totalBytesSent,total:t.totalBytesExpectedToSend})}))}))}}]),e}(),We={setItem:function(e,t){V.setStorageSync(e,t)},getItem:function(e){return V.getStorageSync(e)},removeItem:function(e){V.removeStorageSync(e)},clear:function(){V.clearStorageSync()}},Je={genAdapter:function(){return{root:{},reqClass:$e,localStorage:We,primaryStorage:"local"}},isMatch:function(){return!0},runtime:"uni_app"};Ve.useAdapters(Je);var Xe=Ve,Ze=Xe.init;function Qe(){return{token:V.getStorageSync("uni_id_token")||V.getStorageSync("uniIdToken"),tokenExpired:V.getStorageSync("uni_id_token_expired")}}function et(){S&&"h5"===U&&uni.getStorageSync("__LAST_DCLOUD_APPID")!==T&&(uni.setStorageSync("__LAST_DCLOUD_APPID",T),console.warn("检测到当前项目与上次运行到此端口的项目不一致，自动清理uni-id保存的token信息（仅开发调试时生效）"),V.removeStorageSync("uni_id_token"),V.removeStorageSync("uniIdToken"),V.removeStorageSync("uni_id_token_expired"))}Xe.init=function(e){e.env=e.spaceId;var t=Ze.call(this,e);t.config.provider="tencent",t.config.spaceId=e.spaceId;var i=t.auth;return t.auth=function(e){var t=i.call(this,e);return["linkAndRetrieveDataWithTicket","signInAnonymously","signOut","getAccessToken","getLoginState","signInWithTicket","getUserInfo"].forEach((function(e){t[e]=D(t[e]).bind(t)})),t},t.customAuth=t.auth,t};var tt,it=function(e){(0,h.default)(i,e);var t=(0,f.default)(i);function i(){return(0,l.default)(this,i),t.apply(this,arguments)}return(0,u.default)(i,[{key:"getAccessToken",value:function(){var e=this;return new Promise((function(t,i){var r="Anonymous_Access_token";e.setAccessToken(r),t(r)}))}},{key:"setupRequest",value:function(e,t){var i=Object.assign({},e,{spaceId:this.config.spaceId,timestamp:Date.now()}),r={"Content-Type":"application/json"};"auth"!==t&&(i.token=this.accessToken,r["x-basement-token"]=this.accessToken),r["x-serverless-sign"]=Y.sign(i,this.config.clientSecret);var n=G(),s=n.APPID,a=n.PLATFORM,o=n.DEVICEID,u=n.CLIENT_SDK_VERSION;r["x-client-platform"]=a,r["x-client-appid"]=s,r["x-client-device-id"]=o,r["x-client-version"]=u;var c=Qe(),l=c.token;return r["x-client-token"]=l,{url:this.config.requestUrl,method:"POST",data:i,dataType:"json",header:JSON.parse(JSON.stringify(r))}}},{key:"uploadFileToOSS",value:function(e){var t=this,i=e.url,r=e.formData,n=e.name,s=e.filePath,a=e.fileType,o=e.onUploadProgress;return new Promise((function(e,u){var c=t.adapter.uploadFile({url:i,formData:r,name:n,filePath:s,fileType:a,success:function(t){t&&t.statusCode<400?e(t):u(new M({code:"UPLOAD_FAILED",message:"文件上传失败"}))},fail:function(e){u(new M({code:e.code||"UPLOAD_FAILED",message:e.message||e.errMsg||"文件上传失败"}))}});"function"==typeof o&&c&&"function"==typeof c.onProgressUpdate&&c.onProgressUpdate((function(e){o({loaded:e.totalBytesSent,total:e.totalBytesExpectedToSend})}))}))}},{key:"uploadFile",value:function(e){var t,i=this,r=e.filePath,n=e.cloudPath,s=e.fileType,a=void 0===s?"image":s,o=e.onUploadProgress;if(!n)throw new M({code:"CLOUDPATH_REQUIRED",message:"cloudPath不可为空"});return this.getOSSUploadOptionsFromPath({cloudPath:n}).then((function(e){var n=e.result,s=n.url,u=n.formData,c=n.name,l=n.fileUrl;t=l;var h={url:s,formData:u,name:c,filePath:r,fileType:a};return i.uploadFileToOSS(Object.assign({},h,{onUploadProgress:o}))})).then((function(){return i.reportOSSUpload({cloudPath:n})})).then((function(e){return new Promise((function(i,n){e.success?i({success:!0,filePath:r,fileID:t}):n(new M({code:"UPLOAD_FAILED",message:"文件上传失败"}))}))}))}}]),i}(K),rt={init:function(e){var t=new it(e),i={signInAnonymously:function(){return t.authorize()},getLoginState:function(){return Promise.resolve(!1)}};return t.auth=function(){return i},t.customAuth=t.auth,t}};function nt(e){var t=e.data;tt||(tt=G());var i=JSON.parse(JSON.stringify(t||{}));if(Object.assign(i,{clientInfo:tt}),!i.uniIdToken){var r=Qe(),n=r.token;n&&(i.uniIdToken=n)}return i}function st(e){var t=this,i=e.name,r=e.data,n=this.localAddress,s=this.localPort,a={aliyun:"aliyun",tencent:"tcb"}[this.config.provider],o=this.config.spaceId,u="http://".concat(n,":").concat(s,"/system/check-function"),c="http://".concat(n,":").concat(s,"/cloudfunctions/").concat(i);return new Promise((function(e,t){V.request({method:"POST",url:u,data:{name:i,platform:U,provider:a,spaceId:o},timeout:3e3,success:function(t){e(t)},fail:function(){e({data:{code:"NETWORK_ERROR",message:"连接本地调试服务失败，请检查客户端是否和主机在同一局域网下，自动切换为已部署的云函数。"}})}})})).then((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.data,i=t||{},r=i.code,n=i.message;return{code:0===r?0:r||"SYS_ERR",message:n||"SYS_ERR"}})).then((function(e){var n=e.code,s=e.message;if(0!==n){switch(n){case"MODULE_ENCRYPTED":console.error("此云函数（".concat(i,"）依赖加密公共模块不可本地调试，自动切换为云端已部署的云函数"));break;case"FUNCTION_ENCRYPTED":console.error("此云函数（".concat(i,"）已加密不可本地调试，自动切换为云端已部署的云函数"));break;case"ACTION_ENCRYPTED":console.error(s||"需要访问加密的uni-clientDB-action，自动切换为云端环境");break;case"NETWORK_ERROR":var o="连接本地调试服务失败，请检查客户端是否和主机在同一局域网下";throw console.error(o),new Error(o);case"SWITCH_TO_CLOUD":break;default:var u="检测本地调试服务出现错误：".concat(s,"，请检查网络环境或重启客户端再试");throw console.error(u),new Error(u)}return t._originCallFunction({name:i,data:r})}return new Promise((function(e,i){var n=nt.call(t,{data:r});V.request({method:"POST",url:c,data:{provider:a,platform:U,param:n},success:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.statusCode,n=t.data;return!r||r>=400?i(new M({code:n.code||"SYS_ERR",message:n.message||"request:fail"})):e({result:n})},fail:function(e){i(new M({code:e.code||e.errCode||"SYS_ERR",message:e.message||e.errMsg||"request:fail"}))}})}))}))}var at=[{rule:/fc_function_not_found|FUNCTION_NOT_FOUND/,content:"，云函数[{functionName}]在云端不存在，请检查此云函数名称是否正确以及该云函数是否已上传到服务空间",mode:"append"}],ot=/[\\^$.*+?()[\]{}|]/g,ut=RegExp(ot.source);function ct(e,t,i){return e.replace(new RegExp((r=t)&&ut.test(r)?r.replace(ot,"\\$&"):r,"g"),i);var r}function lt(e){var t=e.functionName,i=e.result,r=e.logPvd;if(this.config.useDebugFunction&&i&&i.requestId){var n=JSON.stringify({spaceId:this.config.spaceId,functionName:t,requestId:i.requestId});console.log("[".concat(r,"-request]").concat(n,"[/").concat(r,"-request]"))}}function ht(e){var t=e.callFunction,i=function(i){var r=this,n=i.name;i.data=nt.call(e,{data:i.data});var s={aliyun:"aliyun",tencent:"tcb"}[this.config.provider];return t.call(this,i).then((function(e){return lt.call(r,{functionName:n,result:e,logPvd:s}),Promise.resolve(e)}),(function(e){return lt.call(r,{functionName:n,result:e,logPvd:s}),e&&e.message&&(e.message=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.message,i=void 0===t?"":t,r=e.extraInfo,n=void 0===r?{}:r,s=e.formatter,a=void 0===s?[]:s,o=0;o<a.length;o++){var u=a[o],c=u.rule,l=u.content,h=u.mode,f=i.match(c);if(f){for(var d=l,p=1;p<f.length;p++)d=ct(d,"{$".concat(p,"}"),f[p]);for(var m in n)d=ct(d,"{".concat(m,"}"),n[m]);switch(h){case"replace":return d;case"append":default:return i+d}}}return i}({message:"[".concat(i.name,"]: ").concat(e.message),formatter:at,extraInfo:{functionName:n}})),Promise.reject(e)}))};e.callFunction=function(t){var r;return S&&e.debugInfo&&!e.debugInfo.forceRemote&&E?(e._originCallFunction||(e._originCallFunction=i),r=st.call(this,t)):r=i.call(this,t),Object.defineProperty(r,"result",{get:function(){return console.warn("当前返回结果为Promise类型，不可直接访问其result属性，详情请参考：https://uniapp.dcloud.net.cn/uniCloud/faq?id=promise"),{}}}),r}}var ft,dt=Symbol("CLIENT_DB_INTERNAL");function pt(e,t){return e.then="DoNotReturnProxyWithAFunctionNamedThen",e._internalType=dt,e.__ob__=void 0,new Proxy(e,{get:function(e,i,r){return i in e||"string"!=typeof i?e[i]:t.get(e,i,r)}})}function mt(e){switch(v(e)){case"array":return e.map((function(e){return mt(e)}));case"object":return e._internalType===dt||Object.keys(e).forEach((function(t){e[t]=mt(e[t])})),e;case"regexp":return{$regexp:{source:e.source,flags:e.flags}};case"date":return{$date:e.toISOString()};default:return e}}function gt(e){e.database=function(t){if(t&&Object.keys(t).length>0)return e.init(t).database();if(this._database)return this._database;var i={},r={};function n(t){var n=t.action,s=t.command,a=t.multiCommand;return O(R("database","invoke")).then((function(){return e.callFunction({name:"DCloud-clientDB",data:{action:n,command:s,multiCommand:a}})})).then((function(e){var t=e.result,n=t.code,s=t.message,a=t.token,o=t.tokenExpired,u=t.systemInfo,c=void 0===u?[]:u;if(c)for(var l=0;l<c.length;l++){var h=c[l],f=h.level,d=h.message,p=h.detail,m=console["app-plus"===U&&"warn"===f?"error":f]||console.log,g="[System Info]"+d;p&&(g="".concat(g,"\n详细信息：").concat(p)),m(g)}if(n){var _=new x(s,n);return r.error&&r.error.forEach((function(e){e(_)})),Promise.reject(_)}a&&o&&(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.token,i=e.tokenExpired;t&&V.setStorageSync("uni_id_token",t),i&&V.setStorageSync("uni_id_token_expired",i)}({token:a,tokenExpired:o}),i.refreshToken&&i.refreshToken.forEach((function(e){e({token:a,tokenExpired:o})})),r.refreshToken&&r.refreshToken.forEach((function(e){e({token:a,tokenExpired:o})})));var y=e.result.affectedDocs;return"number"==typeof y&&Object.defineProperty(e.result,"affectedDocs",{get:function(){return console.warn("affectedDocs不再推荐使用，请使用inserted/deleted/updated/data.length替代"),y}}),O(R("database","success"),e).then((function(){return O(R("database","complete"),e)})).then((function(){return Promise.resolve(e)}))}),(function(e){var t=new x(e.message,e.code||"SYSTEM_ERROR");return r.error&&r.error.forEach((function(e){e(t)})),/fc_function_not_found|FUNCTION_NOT_FOUND/g.test(e.message)&&console.warn("clientDB未初始化，请在web控制台保存一次schema以开启clientDB"),O(R("database","fail"),e).then((function(){return O(R("database","complete"),e)})).then((function(){return Promise.reject(e)}))}))}this.isDefault&&(r=B("_globalUniCloudDatabaseCallback"));var s=function(){function e(t,i){(0,l.default)(this,e),this.content=t,this.prevStage=i,this.udb=null}return(0,u.default)(e,[{key:"toJSON",value:function(){for(var e=this,t=[e.content];e.prevStage;)e=e.prevStage,t.push(e.content);return{$db:t.reverse().map((function(e){return{$method:e.$method,$param:mt(e.$param)}}))}}},{key:"getAction",value:function(){var e=this.toJSON().$db.find((function(e){return"action"===e.$method}));return e&&e.$param&&e.$param[0]}},{key:"getCommand",value:function(){return{$db:this.toJSON().$db.filter((function(e){return"action"!==e.$method}))}}},{key:"get",value:function(){return this._send("get",Array.from(arguments))}},{key:"add",value:function(){return this._send("add",Array.from(arguments))}},{key:"remove",value:function(){return this._send("remove",Array.from(arguments))}},{key:"update",value:function(){return this._send("update",Array.from(arguments))}},{key:"end",value:function(){return this._send("end",Array.from(arguments))}},{key:"set",value:function(){throw new Error("clientDB禁止使用set方法")}},{key:"_send",value:function(e,t){var i=this.getAction(),r=this.getCommand();return r.$db.push({$method:e,$param:mt(t)}),n({action:i,command:r})}},{key:"useAggregate",get:function(){for(var e=this,t=!1;e.prevStage;){e=e.prevStage;var i=e.content.$method;if("aggregate"===i||"pipeline"===i){t=!0;break}}return t}},{key:"count",get:function(){if(!this.useAggregate)return function(){return this._send("count",Array.from(arguments))};var e=this;return function(){return h({$method:"count",$param:mt(Array.from(arguments))},e)}}},{key:"multiSend",get:function(){}}]),e}(),o=["db.Geo","db.command","command.aggregate"];function c(e,t){return o.indexOf("".concat(e,".").concat(t))>-1}function h(e,t){return pt(new s(e,t),{get:function(e,t){var i="db";return e&&e.content&&(i=e.content.$method),c(i,t)?h({$method:t},e):function(){return h({$method:t,$param:mt(Array.from(arguments))},e)}}})}function f(e){var t=e.path,i=e.method;return function(){function e(){(0,l.default)(this,e),this.param=Array.from(arguments)}return(0,u.default)(e,[{key:"toJSON",value:function(){return{$newDb:[].concat((0,a.default)(t.map((function(e){return{$method:e}}))),[{$method:i,$param:this.param}])}}}]),e}()}var d={auth:{on:function(e,t){i[e]=i[e]||[],i[e].indexOf(t)>-1||i[e].push(t)},off:function(e,t){i[e]=i[e]||[];var r=i[e].indexOf(t);-1!==r&&i[e].splice(r,1)}},on:function(e,t){r[e]=r[e]||[],r[e].indexOf(t)>-1||r[e].push(t)},off:function(e,t){r[e]=r[e]||[];var i=r[e].indexOf(t);-1!==i&&r[e].splice(i,1)},env:pt({},{get:function(e,t){return{$env:t}}}),Geo:pt({},{get:function(e,t){return f({path:["Geo"],method:t})}}),getCloudEnv:function(e){if("string"!=typeof e||!e.trim())throw new Error("getCloudEnv参数错误");return{$env:e.replace("$cloudEnv_","")}},multiSend:function(){var e=Array.from(arguments);return n({multiCommand:e.map((function(e){var t=e.getAction(),i=e.getCommand();if("getTemp"!==i.$db[i.$db.length-1].$method)throw new Error("multiSend只支持子命令内使用getTemp");return{action:t,command:i}}))}).then((function(t){for(var i=0;i<e.length;i++){var r=e[i];r.udb&&"function"==typeof r.udb.setResult&&r.udb.setResult(t.result.dataList[i])}return Promise.resolve(t)}),(function(t){for(var i=0;i<e.length;i++){var r=e[i];r.udb&&"function"==typeof r.udb.setResult&&r.udb.setResult(t)}return Promise.reject(t)}))},get serverDate(){return f({path:[],method:"serverDate"})},get RegExp(){return f({path:[],method:"RegExp"})}},p=pt(d,{get:function(e,t){return c("db",t)?h({$method:t}):function(){return h({$method:t,$param:mt(Array.from(arguments))})}}});return this._database=p,p}}var _t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",yt=/^(?:[A-Za-z\d+/]{4})*?(?:[A-Za-z\d+/]{2}(?:==)?|[A-Za-z\d+/]{3}=?)?$/;function vt(){var e,t,i=Qe().token||"",r=i.split(".");if(!i||3!==r.length)return{uid:null,role:[],permission:[],tokenExpired:0};try{e=JSON.parse((t=r[1],decodeURIComponent(ft(t).split("").map((function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)})).join(""))))}catch(i){throw new Error("获取当前用户信息出错，详细错误信息为："+i.message)}return e.tokenExpired=1e3*e.exp,delete e.exp,delete e.iat,e}ft="function"!=typeof atob?function(e){if(e=String(e).replace(/[\t\n\f\r ]+/g,""),!yt.test(e))throw new Error("Failed to execute 'atob' on 'Window': The string to be decoded is not correctly encoded.");var t;e+="==".slice(2-(3&e.length));for(var i,r,n="",s=0;s<e.length;)t=_t.indexOf(e.charAt(s++))<<18|_t.indexOf(e.charAt(s++))<<12|(i=_t.indexOf(e.charAt(s++)))<<6|(r=_t.indexOf(e.charAt(s++))),n+=64===i?String.fromCharCode(t>>16&255):64===r?String.fromCharCode(t>>16&255,t>>8&255):String.fromCharCode(t>>16&255,t>>8&255,255&t);return n}:atob;var bt=m(g((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i="chooseAndUploadFile:ok",r="chooseAndUploadFile:fail";function n(e,t){return e.tempFiles.forEach((function(e,i){e.name||(e.name=e.path.substring(e.path.lastIndexOf("/")+1)),t&&(e.fileType=t),e.cloudPath=Date.now()+"_"+i+e.name.substring(e.name.lastIndexOf("."))})),e.tempFilePaths||(e.tempFilePaths=e.tempFiles.map((function(e){return e.path}))),e}function s(e,t,r){var n=r.onChooseFile,s=r.onUploadProgress;return t.then((function(e){if(n){var t=n(e);if(void 0!==t)return Promise.resolve(t).then((function(t){return void 0===t?e:t}))}return e})).then((function(t){return!1===t?{errMsg:i,tempFilePaths:[],tempFiles:[]}:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5,n=arguments.length>3?arguments[3]:void 0;(t=Object.assign({},t)).errMsg=i;var s=t.tempFiles,a=s.length,o=0;return new Promise((function(i){for(;o<r;)u();function u(){var r=o++;if(r>=a)!s.find((function(e){return!e.url&&!e.errMsg}))&&i(t);else{var c=s[r];e.uploadFile({filePath:c.path,cloudPath:c.cloudPath,fileType:c.fileType,onUploadProgress:function(e){e.index=r,e.tempFile=c,e.tempFilePath=c.path,n&&n(e)}}).then((function(e){c.url=e.fileID,r<a&&u()})).catch((function(e){c.errMsg=e.errMsg||e.message,r<a&&u()}))}}}))}(e,t,5,s)}))}t.initChooseAndUploadFile=function(e){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{type:"all"};return"image"===t.type?s(e,function(e){var t=e.count,i=e.sizeType,s=e.sourceType,a=void 0===s?["album","camera"]:s,o=e.extension;return new Promise((function(e,s){uni.chooseImage({count:t,sizeType:i,sourceType:a,extension:o,success:function(t){e(n(t,"image"))},fail:function(e){s({errMsg:e.errMsg.replace("chooseImage:fail",r)})}})}))}(t),t):"video"===t.type?s(e,function(e){var t=e.camera,i=e.compressed,s=e.maxDuration,a=e.sourceType,o=void 0===a?["album","camera"]:a,u=e.extension;return new Promise((function(e,a){uni.chooseVideo({camera:t,compressed:i,maxDuration:s,sourceType:o,extension:u,success:function(t){var i=t.tempFilePath,r=t.duration,s=t.size,a=t.height,o=t.width;e(n({errMsg:"chooseVideo:ok",tempFilePaths:[i],tempFiles:[{name:t.tempFile&&t.tempFile.name||"",path:i,size:s,type:t.tempFile&&t.tempFile.type||"",width:o,height:a,duration:r,fileType:"video",cloudPath:""}]},"video"))},fail:function(e){a({errMsg:e.errMsg.replace("chooseVideo:fail",r)})}})}))}(t),t):s(e,function(e){var t=e.count,i=e.extension;return new Promise((function(e,s){var a=uni.chooseFile;if("undefined"!=typeof wx&&"function"==typeof wx.chooseMessageFile&&(a=wx.chooseMessageFile),"function"!=typeof a)return s({errMsg:r+" 请指定 type 类型，该平台仅支持选择 image 或 video。"});a({type:"all",count:t,extension:i,success:function(t){e(n(t))},fail:function(e){s({errMsg:e.errMsg.replace("chooseFile:fail",r)})}})}))}(t),t)}}}))),xt="manual";function wt(e){return{props:{localdata:{type:Array,default:function(){return[]}},options:{type:[Object,Array],default:function(){return{}}},spaceInfo:{type:Object,default:function(){return{}}},collection:{type:[String,Array],default:""},action:{type:String,default:""},field:{type:String,default:""},orderby:{type:String,default:""},where:{type:[String,Object],default:""},pageData:{type:String,default:"add"},pageCurrent:{type:Number,default:1},pageSize:{type:Number,default:20},getcount:{type:[Boolean,String],default:!1},gettree:{type:[Boolean,String],default:!1},gettreepath:{type:[Boolean,String],default:!1},startwith:{type:String,default:""},limitlevel:{type:Number,default:10},groupby:{type:String,default:""},groupField:{type:String,default:""},distinct:{type:[Boolean,String],default:!1},foreignKey:{type:String,default:""},loadtime:{type:String,default:"auto"},manual:{type:Boolean,default:!1}},data:function(){return{mixinDatacomLoading:!1,mixinDatacomHasMore:!1,mixinDatacomResData:[],mixinDatacomErrorMessage:"",mixinDatacomPage:{}}},created:function(){var e=this;this.mixinDatacomPage={current:this.pageCurrent,size:this.pageSize,count:0},this.$watch((function(){var t=[];return["pageCurrent","pageSize","localdata","collection","action","field","orderby","where","getont","getcount","gettree","groupby","groupField","distinct"].forEach((function(i){t.push(e[i])})),t}),(function(t,i){if(e.loadtime!==xt){for(var r=!1,n=[],s=2;s<t.length;s++)t[s]!==i[s]&&(n.push(t[s]),r=!0);t[0]!==i[0]&&(e.mixinDatacomPage.current=e.pageCurrent),e.mixinDatacomPage.size=e.pageSize,e.onMixinDatacomPropsChange(r,n)}}))},methods:{onMixinDatacomPropsChange:function(e,t){},mixinDatacomEasyGet:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=t.getone,r=void 0!==i&&i,n=t.success,s=t.fail;this.mixinDatacomLoading||(this.mixinDatacomLoading=!0,this.mixinDatacomErrorMessage="",this.mixinDatacomGet().then((function(t){e.mixinDatacomLoading=!1;var i=t.result,s=i.data,a=i.count;e.getcount&&(e.mixinDatacomPage.count=a),e.mixinDatacomHasMore=s.length<e.pageSize;var o=r?s.length?s[0]:void 0:s;e.mixinDatacomResData=o,n&&n(o)})).catch((function(t){e.mixinDatacomLoading=!1,e.mixinDatacomErrorMessage=t,s&&s(t)})))},mixinDatacomGet:function(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.database(this.spaceInfo),n=i.action||this.action;n&&(r=r.action(n));var s=i.collection||this.collection;r=Array.isArray(s)?(t=r).collection.apply(t,(0,a.default)(s)):r.collection(s);var o=i.where||this.where;o&&Object.keys(o).length&&(r=r.where(o));var u=i.field||this.field;u&&(r=r.field(u));var c=i.foreignKey||this.foreignKey;c&&(r=r.foreignKey(c));var l=i.groupby||this.groupby;l&&(r=r.groupBy(l));var h=i.groupField||this.groupField;h&&(r=r.groupField(h)),!0===(void 0!==i.distinct?i.distinct:this.distinct)&&(r=r.distinct());var f=i.orderby||this.orderby;f&&(r=r.orderBy(f));var d=void 0!==i.pageCurrent?i.pageCurrent:this.mixinDatacomPage.current,p=void 0!==i.pageSize?i.pageSize:this.mixinDatacomPage.size,m=void 0!==i.getcount?i.getcount:this.getcount,g=void 0!==i.gettree?i.gettree:this.gettree,_=void 0!==i.gettreepath?i.gettreepath:this.gettreepath,y={getCount:m},v={limitLevel:void 0!==i.limitlevel?i.limitlevel:this.limitlevel,startWith:void 0!==i.startwith?i.startwith:this.startwith};return g&&(y.getTree=v),_&&(y.getTreePath=v),r=r.skip(p*(d-1)).limit(p).get(y),r}}}}function St(e,t){return Ut.apply(this,arguments)}function Ut(){return Ut=(0,n.default)(regeneratorRuntime.mark((function e(t,i){var r,n,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r="http://".concat(t,":").concat(i,"/system/ping"),e.prev=1,e.next=4,a={url:r,timeout:500},new Promise((function(e,t){V.request((0,s.default)((0,s.default)({},a),{},{success:function(t){e(t)},fail:function(e){t(e)}}))}));case 4:return n=e.sent,e.abrupt("return",!(!n.data||0!==n.data.code));case 8:return e.prev=8,e.t0=e["catch"](1),e.abrupt("return",!1);case 11:case"end":return e.stop()}}),e,null,[[1,8]])}))),Ut.apply(this,arguments)}var kt=new(function(){function e(){(0,l.default)(this,e)}return(0,u.default)(e,[{key:"init",value:function(e){var t={},i=!1!==e.debugFunction&&S&&("h5"===U&&navigator.userAgent.indexOf("HBuilderX")>0||"app-plus"===U);switch(e.provider){case"tencent":t=Xe.init(Object.assign(e,{useDebugFunction:i}));break;case"aliyun":t=$.init(Object.assign(e,{useDebugFunction:i}));break;case"private":t=rt.init(Object.assign(e,{useDebugFunction:i}));break;default:throw new Error("未提供正确的provider参数")}var r=k;S&&r&&!r.code&&(t.debugInfo=r);var s,a=Promise.resolve();s=1,a=new Promise((function(e,t){setTimeout((function(){e()}),s)})),t.isReady=!1,t.isDefault=!1;var o=t.auth();return t.initUniCloud=a.then((function(){return o.getLoginState()})).then((function(e){return e?Promise.resolve():o.signInAnonymously()})).then((function(){if(!S)return Promise.resolve();if(S&&t.debugInfo){var e=t.debugInfo,i=e.address,r=e.servePort;return function(){var e=(0,n.default)(regeneratorRuntime.mark((function e(t,i){var r,n,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:n=0;case 1:if(!(n<t.length)){e.next=11;break}return s=t[n],e.next=5,St(s,i);case 5:if(!e.sent){e.next=8;break}return r=s,e.abrupt("break",11);case 8:n++,e.next=1;break;case 11:return e.abrupt("return",{address:r,port:i});case 12:case"end":return e.stop()}}),e)})));return function(t,i){return e.apply(this,arguments)}}()(i,r)}})).then((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=e.address,r=e.port;if(!S)return Promise.resolve();if(i)t.localAddress=i,t.localPort=r;else if(t.debugInfo){var n=console["app-plus"===U?"error":"warn"],s="";"remote"===t.debugInfo.initialLaunchType?(t.debugInfo.forceRemote=!0,s="当前客户端和HBuilderX不在同一局域网下（或其他网络原因无法连接HBuilderX），uniCloud本地调试服务不对当前客户端生效。\n- 如果不使用uniCloud本地调试服务，请直接忽略此信息。\n- 如需使用uniCloud本地调试服务，请将客户端与主机连接到同一局域网下并重新运行到客户端。\n- 如果在HBuilderX开启的状态下切换过网络环境，请重启HBuilderX后再试\n- 检查系统防火墙是否拦截了HBuilderX自带的nodejs"):s="无法连接uniCloud本地调试服务，请检查当前客户端是否与主机在同一局域网下。\n- 如需使用uniCloud本地调试服务，请将客户端与主机连接到同一局域网下并重新运行到客户端。\n- 如果在HBuilderX开启的状态下切换过网络环境，请重启HBuilderX后再试\n- 检查系统防火墙是否拦截了HBuilderX自带的nodejs","h5"===U&&(s+="\n- 部分浏览器开启节流模式之后访问本地地址受限，请检查是否启用了节流模式"),n(s)}})).then((function(){et(),t.isReady=!0})),ht(t),function(e){var t=e.uploadFile;e.uploadFile=function(e){var i,r=this;return i=this.isReady?Promise.resolve():this.initUniCloud,i.then((function(){return t.call(r,e)}))}}(t),gt(t),function(e){e.getCurrentUserInfo=vt,e.chooseAndUploadFile=bt.initChooseAndUploadFile(e),Object.assign(e,{get mixinDatacom(){return wt(e)}})}(t),["callFunction","uploadFile","deleteFile","getTempFileURL","downloadFile","chooseAndUploadFile"].forEach((function(e){t[e]&&(t[e]=D(t[e],e))})),t.init=this.init,t}}]),e}());(function(){var e=E,t={};if(1===e.length)t=e[0],kt=kt.init(t),kt.isDefault=!0;else{var i,r=["auth","callFunction","uploadFile","deleteFile","getTempFileURL","downloadFile","database","getCurrentUSerInfo"];i=e&&e.length>0?"应用有多个服务空间，请通过uniCloud.init方法指定要使用的服务空间":A?"应用未关联服务空间，请在uniCloud目录右键关联服务空间":"uni-app cli项目内使用uniCloud需要使用HBuilderX的运行菜单运行项目，且需要在uniCloud目录关联服务空间",r.forEach((function(e){kt[e]=function(){return console.error(i),Promise.reject(new M({code:"SYS_ERR",message:i}))}}))}Object.assign(kt,{get mixinDatacom(){return wt(kt)}}),kt.addInterceptor=L,kt.removeInterceptor=z,S&&"h5"===U&&(window.uniCloud=kt)})();var Et=kt,At=Et;t.default=At}).call(this,i("c8ba"))},ab4b:function(e,t,i){var r=i("24fb");t=r(!1),t.push([e.i,".content[data-v-168551c6]{display:flex;flex-direction:column;align-items:center;justify-content:center}.logo[data-v-168551c6]{height:%?200?%;width:%?200?%;margin-top:%?200?%;margin-left:auto;margin-right:auto;margin-bottom:%?50?%}.text-area[data-v-168551c6]{display:flex;justify-content:center}.title[data-v-168551c6]{font-size:%?36?%;color:#8f8f94}",""]),e.exports=t},b2e8:function(e,t,i){"use strict";var r;i.d(t,"b",(function(){return n})),i.d(t,"c",(function(){return s})),i.d(t,"a",(function(){return r}));var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-uni-view",{staticClass:"uni-file-picker__container"},[e._l(e.filesList,(function(t,r){return i("v-uni-view",{key:r,staticClass:"file-picker__box",style:e.boxStyle},[i("v-uni-view",{staticClass:"file-picker__box-content",style:e.borderStyle},[i("v-uni-image",{staticClass:"file-image",attrs:{src:t.url,mode:"aspectFill"},on:{click:function(i){i.stopPropagation(),arguments[0]=i=e.$handleEvent(i),e.prviewImage(t,r)}}}),e.delIcon&&!e.readonly?i("v-uni-view",{staticClass:"icon-del-box",on:{click:function(t){t.stopPropagation(),arguments[0]=t=e.$handleEvent(t),e.delFile(r)}}},[i("v-uni-view",{staticClass:"icon-del"}),i("v-uni-view",{staticClass:"icon-del rotate"})],1):e._e(),t.progress&&100!==t.progress||0===t.progress?i("v-uni-view",{staticClass:"file-picker__progress"},[i("v-uni-progress",{staticClass:"file-picker__progress-item",attrs:{percent:-1===t.progress?0:t.progress,"stroke-width":"4",backgroundColor:t.errMsg?"#ff5a5f":"#EBEBEB"}})],1):e._e(),t.errMsg?i("v-uni-view",{staticClass:"file-picker__mask",on:{click:function(i){i.stopPropagation(),arguments[0]=i=e.$handleEvent(i),e.uploadFiles(t,r)}}},[e._v("点击重试")]):e._e()],1)],1)})),e.filesList.length<e.limit&&!e.readonly?i("v-uni-view",{staticClass:"file-picker__box",style:e.boxStyle},[i("v-uni-view",{staticClass:"file-picker__box-content is-add",style:e.borderStyle,on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.choose.apply(void 0,arguments)}}},[e._t("default",[i("v-uni-view",{staticClass:"icon-add"}),i("v-uni-view",{staticClass:"icon-add rotate"})])],2)],1):e._e()],2)},s=[]},b380:function(e,t,i){"use strict";function r(e,i){return t.default=r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},r(e,i)}i("131a"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=r},b85c:function(e,t,i){"use strict";i("a4d3"),i("e01a"),i("d28b"),i("d3b7"),i("3ca3"),i("ddb0"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=s;var r=n(i("06c5"));function n(e){return e&&e.__esModule?e:{default:e}}function s(e,t){var i;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(i=(0,r.default)(e))||t&&e&&"number"===typeof e.length){i&&(e=i);var n=0,s=function(){};return{s:s,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,u=!1;return{s:function(){i=e[Symbol.iterator]()},n:function(){var e=i.next();return o=e.done,e},e:function(e){u=!0,a=e},f:function(){try{o||null==i["return"]||i["return"]()}finally{if(u)throw a}}}}},b915:function(e,t,i){i("a4d3"),i("e01a"),i("99af"),i("4160"),i("c975"),i("fb6a"),i("a434"),i("c19f"),i("ace4"),i("a9e3"),i("d3b7"),i("e25e"),i("ac1f"),i("5377"),i("25f0"),i("3ca3"),i("5319"),i("1276"),i("cfc3"),i("4a9b"),i("fd87"),i("8b09"),i("143c"),i("5cc6"),i("84c3"),i("fb2c"),i("9a8c"),i("a975"),i("735e"),i("c1ac"),i("d139"),i("3a7b"),i("d5d6"),i("82f8"),i("e91f"),i("60bd"),i("5f96"),i("3280"),i("3fcc"),i("ca91"),i("25a1"),i("cd26"),i("2954"),i("649e"),i("219c"),i("b39a"),i("72f7"),i("159b"),i("ddb0"),i("2b3d");var r=function(){var e=new Date,t=4,i=3,n=2,s=1,a=t,o={setLogLevel:function(e){a=e==this.debug?s:e==this.info?n:e==this.warn?i:(this.error,t)},debug:function(t,i){void 0===console.debug&&(console.debug=console.log),s>=a&&console.debug("["+r.getDurationString(new Date-e,1e3)+"]","["+t+"]",i)},log:function(e,t){this.debug(e.msg)},info:function(t,i){n>=a&&console.info("["+r.getDurationString(new Date-e,1e3)+"]","["+t+"]",i)},warn:function(t,n){i>=a&&console.warn("["+r.getDurationString(new Date-e,1e3)+"]","["+t+"]",n)},error:function(i,n){t>=a&&console.error("["+r.getDurationString(new Date-e,1e3)+"]","["+i+"]",n)}};return o}();r.getDurationString=function(e,t){var i;function r(e,t){var i=""+e,r=i.split(".");while(r[0].length<t)r[0]="0"+r[0];return r.join(".")}e<0?(i=!0,e=-e):i=!1;var n=t||1,s=e/n,a=Math.floor(s/3600);s-=3600*a;var o=Math.floor(s/60);s-=60*o;var u=1e3*s;return s=Math.floor(s),u-=1e3*s,u=Math.floor(u),(i?"-":"")+a+":"+r(o,2)+":"+r(s,2)+"."+r(u,3)},r.printRanges=function(e){var t=e.length;if(t>0){for(var i="",n=0;n<t;n++)n>0&&(i+=","),i+="["+r.getDurationString(e.start(n))+","+r.getDurationString(e.end(n))+"]";return i}return"(empty)"},t.Log=r;var n=function(e){if(!(e instanceof ArrayBuffer))throw"Needs an array buffer";this.buffer=e,this.dataview=new DataView(e),this.position=0};n.prototype.getPosition=function(){return this.position},n.prototype.getEndPosition=function(){return this.buffer.byteLength},n.prototype.getLength=function(){return this.buffer.byteLength},n.prototype.seek=function(e){var t=Math.max(0,Math.min(this.buffer.byteLength,e));return this.position=isNaN(t)||!isFinite(t)?0:t,!0},n.prototype.isEos=function(){return this.getPosition()>=this.getEndPosition()},n.prototype.readAnyInt=function(e,t){var i=0;if(this.position+e<=this.buffer.byteLength){switch(e){case 1:i=t?this.dataview.getInt8(this.position):this.dataview.getUint8(this.position);break;case 2:i=t?this.dataview.getInt16(this.position):this.dataview.getUint16(this.position);break;case 3:if(t)throw"No method for reading signed 24 bits values";i=this.dataview.getUint8(this.position)<<16,i|=this.dataview.getUint8(this.position+1)<<8,i|=this.dataview.getUint8(this.position+2);break;case 4:i=t?this.dataview.getInt32(this.position):this.dataview.getUint32(this.position);break;case 8:if(t)throw"No method for reading signed 64 bits values";i=this.dataview.getUint32(this.position)<<32,i|=this.dataview.getUint32(this.position+4);break;default:throw"readInt method not implemented for size: "+e}return this.position+=e,i}throw"Not enough bytes in buffer"},n.prototype.readUint8=function(){return this.readAnyInt(1,!1)},n.prototype.readUint16=function(){return this.readAnyInt(2,!1)},n.prototype.readUint24=function(){return this.readAnyInt(3,!1)},n.prototype.readUint32=function(){return this.readAnyInt(4,!1)},n.prototype.readUint64=function(){return this.readAnyInt(8,!1)},n.prototype.readString=function(e){if(this.position+e<=this.buffer.byteLength){for(var t="",i=0;i<e;i++)t+=String.fromCharCode(this.readUint8());return t}throw"Not enough bytes in buffer"},n.prototype.readCString=function(){var e=[];while(1){var t=this.readUint8();if(0===t)break;e.push(t)}return String.fromCharCode.apply(null,e)},n.prototype.readInt8=function(){return this.readAnyInt(1,!0)},n.prototype.readInt16=function(){return this.readAnyInt(2,!0)},n.prototype.readInt32=function(){return this.readAnyInt(4,!0)},n.prototype.readInt64=function(){return this.readAnyInt(8,!1)},n.prototype.readUint8Array=function(e){for(var t=new Uint8Array(e),i=0;i<e;i++)t[i]=this.readUint8();return t},n.prototype.readInt16Array=function(e){for(var t=new Int16Array(e),i=0;i<e;i++)t[i]=this.readInt16();return t},n.prototype.readUint16Array=function(e){for(var t=new Int16Array(e),i=0;i<e;i++)t[i]=this.readUint16();return t},n.prototype.readUint32Array=function(e){for(var t=new Uint32Array(e),i=0;i<e;i++)t[i]=this.readUint32();return t},n.prototype.readInt32Array=function(e){for(var t=new Int32Array(e),i=0;i<e;i++)t[i]=this.readInt32();return t},t.MP4BoxStream=n;var s=function e(t,i,r){this._byteOffset=i||0,t instanceof ArrayBuffer?this.buffer=t:"object"==typeof t?(this.dataView=t,i&&(this._byteOffset+=i)):this.buffer=new ArrayBuffer(t||0),this.position=0,this.endianness=null==r?e.LITTLE_ENDIAN:r};s.prototype={},s.prototype.getPosition=function(){return this.position},s.prototype._realloc=function(e){if(this._dynamicSize){var t=this._byteOffset+this.position+e,i=this._buffer.byteLength;if(t<=i)t>this._byteLength&&(this._byteLength=t);else{i<1&&(i=1);while(t>i)i*=2;var r=new ArrayBuffer(i),n=new Uint8Array(this._buffer),s=new Uint8Array(r,0,n.length);s.set(n),this.buffer=r,this._byteLength=t}}},s.prototype._trimAlloc=function(){if(this._byteLength!=this._buffer.byteLength){var e=new ArrayBuffer(this._byteLength),t=new Uint8Array(e),i=new Uint8Array(this._buffer,0,t.length);t.set(i),this.buffer=e}},s.BIG_ENDIAN=!1,s.LITTLE_ENDIAN=!0,s.prototype._byteLength=0,Object.defineProperty(s.prototype,"byteLength",{get:function(){return this._byteLength-this._byteOffset}}),Object.defineProperty(s.prototype,"buffer",{get:function(){return this._trimAlloc(),this._buffer},set:function(e){this._buffer=e,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._buffer.byteLength}}),Object.defineProperty(s.prototype,"byteOffset",{get:function(){return this._byteOffset},set:function(e){this._byteOffset=e,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._buffer.byteLength}}),Object.defineProperty(s.prototype,"dataView",{get:function(){return this._dataView},set:function(e){this._byteOffset=e.byteOffset,this._buffer=e.buffer,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._byteOffset+e.byteLength}}),s.prototype.seek=function(e){var t=Math.max(0,Math.min(this.byteLength,e));this.position=isNaN(t)||!isFinite(t)?0:t},s.prototype.isEof=function(){return this.position>=this._byteLength},s.prototype.mapUint8Array=function(e){this._realloc(1*e);var t=new Uint8Array(this._buffer,this.byteOffset+this.position,e);return this.position+=1*e,t},s.prototype.readInt32Array=function(e,t){e=null==e?this.byteLength-this.position/4:e;var i=new Int32Array(e);return s.memcpy(i.buffer,0,this.buffer,this.byteOffset+this.position,e*i.BYTES_PER_ELEMENT),s.arrayToNative(i,null==t?this.endianness:t),this.position+=i.byteLength,i},s.prototype.readInt16Array=function(e,t){e=null==e?this.byteLength-this.position/2:e;var i=new Int16Array(e);return s.memcpy(i.buffer,0,this.buffer,this.byteOffset+this.position,e*i.BYTES_PER_ELEMENT),s.arrayToNative(i,null==t?this.endianness:t),this.position+=i.byteLength,i},s.prototype.readInt8Array=function(e){e=null==e?this.byteLength-this.position:e;var t=new Int8Array(e);return s.memcpy(t.buffer,0,this.buffer,this.byteOffset+this.position,e*t.BYTES_PER_ELEMENT),this.position+=t.byteLength,t},s.prototype.readUint32Array=function(e,t){e=null==e?this.byteLength-this.position/4:e;var i=new Uint32Array(e);return s.memcpy(i.buffer,0,this.buffer,this.byteOffset+this.position,e*i.BYTES_PER_ELEMENT),s.arrayToNative(i,null==t?this.endianness:t),this.position+=i.byteLength,i},s.prototype.readUint16Array=function(e,t){e=null==e?this.byteLength-this.position/2:e;var i=new Uint16Array(e);return s.memcpy(i.buffer,0,this.buffer,this.byteOffset+this.position,e*i.BYTES_PER_ELEMENT),s.arrayToNative(i,null==t?this.endianness:t),this.position+=i.byteLength,i},s.prototype.readUint8Array=function(e){e=null==e?this.byteLength-this.position:e;var t=new Uint8Array(e);return s.memcpy(t.buffer,0,this.buffer,this.byteOffset+this.position,e*t.BYTES_PER_ELEMENT),this.position+=t.byteLength,t},s.prototype.readFloat64Array=function(e,t){e=null==e?this.byteLength-this.position/8:e;var i=new Float64Array(e);return s.memcpy(i.buffer,0,this.buffer,this.byteOffset+this.position,e*i.BYTES_PER_ELEMENT),s.arrayToNative(i,null==t?this.endianness:t),this.position+=i.byteLength,i},s.prototype.readFloat32Array=function(e,t){e=null==e?this.byteLength-this.position/4:e;var i=new Float32Array(e);return s.memcpy(i.buffer,0,this.buffer,this.byteOffset+this.position,e*i.BYTES_PER_ELEMENT),s.arrayToNative(i,null==t?this.endianness:t),this.position+=i.byteLength,i},s.prototype.readInt32=function(e){var t=this._dataView.getInt32(this.position,null==e?this.endianness:e);return this.position+=4,t},s.prototype.readInt16=function(e){var t=this._dataView.getInt16(this.position,null==e?this.endianness:e);return this.position+=2,t},s.prototype.readInt8=function(){var e=this._dataView.getInt8(this.position);return this.position+=1,e},s.prototype.readUint32=function(e){var t=this._dataView.getUint32(this.position,null==e?this.endianness:e);return this.position+=4,t},s.prototype.readUint16=function(e){var t=this._dataView.getUint16(this.position,null==e?this.endianness:e);return this.position+=2,t},s.prototype.readUint8=function(){var e=this._dataView.getUint8(this.position);return this.position+=1,e},s.prototype.readFloat32=function(e){var t=this._dataView.getFloat32(this.position,null==e?this.endianness:e);return this.position+=4,t},s.prototype.readFloat64=function(e){var t=this._dataView.getFloat64(this.position,null==e?this.endianness:e);return this.position+=8,t},s.endianness=new Int8Array(new Int16Array([1]).buffer)[0]>0,s.memcpy=function(e,t,i,r,n){var s=new Uint8Array(e,t,n),a=new Uint8Array(i,r,n);s.set(a)},s.arrayToNative=function(e,t){return t==this.endianness?e:this.flipArrayEndianness(e)},s.nativeToEndian=function(e,t){return this.endianness==t?e:this.flipArrayEndianness(e)},s.flipArrayEndianness=function(e){for(var t=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),i=0;i<e.byteLength;i+=e.BYTES_PER_ELEMENT)for(var r=i+e.BYTES_PER_ELEMENT-1,n=i;r>n;r--,n++){var s=t[n];t[n]=t[r],t[r]=s}return e},s.prototype.failurePosition=0,String.fromCharCodeUint8=function(e){for(var t=[],i=0;i<e.length;i++)t[i]=e[i];return String.fromCharCode.apply(null,t)},s.prototype.readString=function(e,t){return null==t||"ASCII"==t?String.fromCharCodeUint8.apply(null,[this.mapUint8Array(null==e?this.byteLength-this.position:e)]):new TextDecoder(t).decode(this.mapUint8Array(e))},s.prototype.readCString=function(e){var t=this.byteLength-this.position,i=new Uint8Array(this._buffer,this._byteOffset+this.position),r=t;null!=e&&(r=Math.min(e,t));for(var n=0;n<r&&0!==i[n];n++);var s=String.fromCharCodeUint8.apply(null,[this.mapUint8Array(n)]);return null!=e?this.position+=r-n:n!=t&&(this.position+=1),s};var a=Math.pow(2,32);s.prototype.readInt64=function(){return this.readInt32()*a+this.readUint32()},s.prototype.readUint64=function(){return this.readUint32()*a+this.readUint32()},s.prototype.readInt64=function(){return this.readUint32()*a+this.readUint32()},s.prototype.readUint24=function(){return(this.readUint8()<<16)+(this.readUint8()<<8)+this.readUint8()},t.DataStream=s,s.prototype.save=function(e){var t=new Blob([this.buffer]);if(!window.URL||!URL.createObjectURL)throw"DataStream.save: Can't create object URL.";var i=window.URL.createObjectURL(t),r=document.createElement("a");document.body.appendChild(r),r.setAttribute("href",i),r.setAttribute("download",e),r.setAttribute("target","_self"),r.click(),window.URL.revokeObjectURL(i)},s.prototype._dynamicSize=!0,Object.defineProperty(s.prototype,"dynamicSize",{get:function(){return this._dynamicSize},set:function(e){e||this._trimAlloc(),this._dynamicSize=e}}),s.prototype.shift=function(e){var t=new ArrayBuffer(this._byteLength-e),i=new Uint8Array(t),r=new Uint8Array(this._buffer,e,i.length);i.set(r),this.buffer=t,this.position-=e},s.prototype.writeInt32Array=function(e,t){if(this._realloc(4*e.length),e instanceof Int32Array&&this.byteOffset+this.position%e.BYTES_PER_ELEMENT===0)s.memcpy(this._buffer,this.byteOffset+this.position,e.buffer,0,e.byteLength),this.mapInt32Array(e.length,t);else for(var i=0;i<e.length;i++)this.writeInt32(e[i],t)},s.prototype.writeInt16Array=function(e,t){if(this._realloc(2*e.length),e instanceof Int16Array&&this.byteOffset+this.position%e.BYTES_PER_ELEMENT===0)s.memcpy(this._buffer,this.byteOffset+this.position,e.buffer,0,e.byteLength),this.mapInt16Array(e.length,t);else for(var i=0;i<e.length;i++)this.writeInt16(e[i],t)},s.prototype.writeInt8Array=function(e){if(this._realloc(1*e.length),e instanceof Int8Array&&this.byteOffset+this.position%e.BYTES_PER_ELEMENT===0)s.memcpy(this._buffer,this.byteOffset+this.position,e.buffer,0,e.byteLength),this.mapInt8Array(e.length);else for(var t=0;t<e.length;t++)this.writeInt8(e[t])},s.prototype.writeUint32Array=function(e,t){if(this._realloc(4*e.length),e instanceof Uint32Array&&this.byteOffset+this.position%e.BYTES_PER_ELEMENT===0)s.memcpy(this._buffer,this.byteOffset+this.position,e.buffer,0,e.byteLength),this.mapUint32Array(e.length,t);else for(var i=0;i<e.length;i++)this.writeUint32(e[i],t)},s.prototype.writeUint16Array=function(e,t){if(this._realloc(2*e.length),e instanceof Uint16Array&&this.byteOffset+this.position%e.BYTES_PER_ELEMENT===0)s.memcpy(this._buffer,this.byteOffset+this.position,e.buffer,0,e.byteLength),this.mapUint16Array(e.length,t);else for(var i=0;i<e.length;i++)this.writeUint16(e[i],t)},s.prototype.writeUint8Array=function(e){if(this._realloc(1*e.length),e instanceof Uint8Array&&this.byteOffset+this.position%e.BYTES_PER_ELEMENT===0)s.memcpy(this._buffer,this.byteOffset+this.position,e.buffer,0,e.byteLength),this.mapUint8Array(e.length);else for(var t=0;t<e.length;t++)this.writeUint8(e[t])},s.prototype.writeFloat64Array=function(e,t){if(this._realloc(8*e.length),e instanceof Float64Array&&this.byteOffset+this.position%e.BYTES_PER_ELEMENT===0)s.memcpy(this._buffer,this.byteOffset+this.position,e.buffer,0,e.byteLength),this.mapFloat64Array(e.length,t);else for(var i=0;i<e.length;i++)this.writeFloat64(e[i],t)},s.prototype.writeFloat32Array=function(e,t){if(this._realloc(4*e.length),e instanceof Float32Array&&this.byteOffset+this.position%e.BYTES_PER_ELEMENT===0)s.memcpy(this._buffer,this.byteOffset+this.position,e.buffer,0,e.byteLength),this.mapFloat32Array(e.length,t);else for(var i=0;i<e.length;i++)this.writeFloat32(e[i],t)},s.prototype.writeInt32=function(e,t){this._realloc(4),this._dataView.setInt32(this.position,e,null==t?this.endianness:t),this.position+=4},s.prototype.writeInt16=function(e,t){this._realloc(2),this._dataView.setInt16(this.position,e,null==t?this.endianness:t),this.position+=2},s.prototype.writeInt8=function(e){this._realloc(1),this._dataView.setInt8(this.position,e),this.position+=1},s.prototype.writeUint32=function(e,t){this._realloc(4),this._dataView.setUint32(this.position,e,null==t?this.endianness:t),this.position+=4},s.prototype.writeUint16=function(e,t){this._realloc(2),this._dataView.setUint16(this.position,e,null==t?this.endianness:t),this.position+=2},s.prototype.writeUint8=function(e){this._realloc(1),this._dataView.setUint8(this.position,e),this.position+=1},s.prototype.writeFloat32=function(e,t){this._realloc(4),this._dataView.setFloat32(this.position,e,null==t?this.endianness:t),this.position+=4},s.prototype.writeFloat64=function(e,t){this._realloc(8),this._dataView.setFloat64(this.position,e,null==t?this.endianness:t),this.position+=8},s.prototype.writeUCS2String=function(e,t,i){null==i&&(i=e.length);for(var r=0;r<e.length&&r<i;r++)this.writeUint16(e.charCodeAt(r),t);for(;r<i;r++)this.writeUint16(0)},s.prototype.writeString=function(e,t,i){var r=0;if(null==t||"ASCII"==t)if(null!=i){var n=Math.min(e.length,i);for(r=0;r<n;r++)this.writeUint8(e.charCodeAt(r));for(;r<i;r++)this.writeUint8(0)}else for(r=0;r<e.length;r++)this.writeUint8(e.charCodeAt(r));else this.writeUint8Array(new TextEncoder(t).encode(e.substring(0,i)))},s.prototype.writeCString=function(e,t){var i=0;if(null!=t){var r=Math.min(e.length,t);for(i=0;i<r;i++)this.writeUint8(e.charCodeAt(i));for(;i<t;i++)this.writeUint8(0)}else{for(i=0;i<e.length;i++)this.writeUint8(e.charCodeAt(i));this.writeUint8(0)}},s.prototype.writeStruct=function(e,t){for(var i=0;i<e.length;i+=2){var r=e[i+1];this.writeType(r,t[e[i]],t)}},s.prototype.writeType=function(e,t,i){var r;if("function"==typeof e)return e(this,t);if("object"==typeof e&&!(e instanceof Array))return e.set(this,t,i);var n=null,a="ASCII",o=this.position;switch("string"==typeof e&&/:/.test(e)&&(r=e.split(":"),e=r[0],n=parseInt(r[1])),"string"==typeof e&&/,/.test(e)&&(r=e.split(","),e=r[0],a=parseInt(r[1])),e){case"uint8":this.writeUint8(t);break;case"int8":this.writeInt8(t);break;case"uint16":this.writeUint16(t,this.endianness);break;case"int16":this.writeInt16(t,this.endianness);break;case"uint32":this.writeUint32(t,this.endianness);break;case"int32":this.writeInt32(t,this.endianness);break;case"float32":this.writeFloat32(t,this.endianness);break;case"float64":this.writeFloat64(t,this.endianness);break;case"uint16be":this.writeUint16(t,s.BIG_ENDIAN);break;case"int16be":this.writeInt16(t,s.BIG_ENDIAN);break;case"uint32be":this.writeUint32(t,s.BIG_ENDIAN);break;case"int32be":this.writeInt32(t,s.BIG_ENDIAN);break;case"float32be":this.writeFloat32(t,s.BIG_ENDIAN);break;case"float64be":this.writeFloat64(t,s.BIG_ENDIAN);break;case"uint16le":this.writeUint16(t,s.LITTLE_ENDIAN);break;case"int16le":this.writeInt16(t,s.LITTLE_ENDIAN);break;case"uint32le":this.writeUint32(t,s.LITTLE_ENDIAN);break;case"int32le":this.writeInt32(t,s.LITTLE_ENDIAN);break;case"float32le":this.writeFloat32(t,s.LITTLE_ENDIAN);break;case"float64le":this.writeFloat64(t,s.LITTLE_ENDIAN);break;case"cstring":this.writeCString(t,n);break;case"string":this.writeString(t,a,n);break;case"u16string":this.writeUCS2String(t,this.endianness,n);break;case"u16stringle":this.writeUCS2String(t,s.LITTLE_ENDIAN,n);break;case"u16stringbe":this.writeUCS2String(t,s.BIG_ENDIAN,n);break;default:if(3==e.length){for(var u=e[1],c=0;c<t.length;c++)this.writeType(u,t[c]);break}this.writeStruct(e,t);break}null!=n&&(this.position=o,this._realloc(n),this.position=o+n)},s.prototype.writeUint64=function(e){var t=Math.floor(e/a);this.writeUint32(t),this.writeUint32(4294967295&e)},s.prototype.writeUint24=function(e){this.writeUint8((16711680&e)>>16),this.writeUint8((65280&e)>>8),this.writeUint8(255&e)},s.prototype.adjustUint32=function(e,t){var i=this.position;this.seek(e),this.writeUint32(t),this.seek(i)},s.prototype.mapInt32Array=function(e,t){this._realloc(4*e);var i=new Int32Array(this._buffer,this.byteOffset+this.position,e);return s.arrayToNative(i,null==t?this.endianness:t),this.position+=4*e,i},s.prototype.mapInt16Array=function(e,t){this._realloc(2*e);var i=new Int16Array(this._buffer,this.byteOffset+this.position,e);return s.arrayToNative(i,null==t?this.endianness:t),this.position+=2*e,i},s.prototype.mapInt8Array=function(e){this._realloc(1*e);var t=new Int8Array(this._buffer,this.byteOffset+this.position,e);return this.position+=1*e,t},s.prototype.mapUint32Array=function(e,t){this._realloc(4*e);var i=new Uint32Array(this._buffer,this.byteOffset+this.position,e);return s.arrayToNative(i,null==t?this.endianness:t),this.position+=4*e,i},s.prototype.mapUint16Array=function(e,t){this._realloc(2*e);var i=new Uint16Array(this._buffer,this.byteOffset+this.position,e);return s.arrayToNative(i,null==t?this.endianness:t),this.position+=2*e,i},s.prototype.mapFloat64Array=function(e,t){this._realloc(8*e);var i=new Float64Array(this._buffer,this.byteOffset+this.position,e);return s.arrayToNative(i,null==t?this.endianness:t),this.position+=8*e,i},s.prototype.mapFloat32Array=function(e,t){this._realloc(4*e);var i=new Float32Array(this._buffer,this.byteOffset+this.position,e);return s.arrayToNative(i,null==t?this.endianness:t),this.position+=4*e,i};var o=function(e){this.buffers=[],this.bufferIndex=-1,e&&(this.insertBuffer(e),this.bufferIndex=0)};o.prototype=new s(new ArrayBuffer,0,s.BIG_ENDIAN),o.prototype.initialized=function(){var e;return this.bufferIndex>-1||(this.buffers.length>0?(e=this.buffers[0],0===e.fileStart?(this.buffer=e,this.bufferIndex=0,r.debug("MultiBufferStream","Stream ready for parsing"),!0):(r.warn("MultiBufferStream","The first buffer should have a fileStart of 0"),this.logBufferLevel(),!1)):(r.warn("MultiBufferStream","No buffer to start parsing from"),this.logBufferLevel(),!1))},ArrayBuffer.concat=function(e,t){r.debug("ArrayBuffer","Trying to create a new buffer of size: "+(e.byteLength+t.byteLength));var i=new Uint8Array(e.byteLength+t.byteLength);return i.set(new Uint8Array(e),0),i.set(new Uint8Array(t),e.byteLength),i.buffer},o.prototype.reduceBuffer=function(e,t,i){var r;return r=new Uint8Array(i),r.set(new Uint8Array(e,t,i)),r.buffer.fileStart=e.fileStart+t,r.buffer.usedBytes=0,r.buffer},o.prototype.insertBuffer=function(e){for(var t=!0,i=0;i<this.buffers.length;i++){var n=this.buffers[i];if(e.fileStart<=n.fileStart){if(e.fileStart===n.fileStart){if(e.byteLength>n.byteLength){this.buffers.splice(i,1),i--;continue}r.warn("MultiBufferStream","Buffer (fileStart: "+e.fileStart+" - Length: "+e.byteLength+") already appended, ignoring")}else e.fileStart+e.byteLength<=n.fileStart||(e=this.reduceBuffer(e,0,n.fileStart-e.fileStart)),r.debug("MultiBufferStream","Appending new buffer (fileStart: "+e.fileStart+" - Length: "+e.byteLength+")"),this.buffers.splice(i,0,e),0===i&&(this.buffer=e);t=!1;break}if(e.fileStart<n.fileStart+n.byteLength){var s=n.fileStart+n.byteLength-e.fileStart,a=e.byteLength-s;if(!(a>0)){t=!1;break}e=this.reduceBuffer(e,s,a)}}t&&(r.debug("MultiBufferStream","Appending new buffer (fileStart: "+e.fileStart+" - Length: "+e.byteLength+")"),this.buffers.push(e),0===i&&(this.buffer=e))},o.prototype.logBufferLevel=function(e){var t,i,n,s,a,o=[],u="";for(n=0,s=0,t=0;t<this.buffers.length;t++)i=this.buffers[t],0===t?(a={},o.push(a),a.start=i.fileStart,a.end=i.fileStart+i.byteLength,u+="["+a.start+"-"):a.end===i.fileStart?a.end=i.fileStart+i.byteLength:(a={},a.start=i.fileStart,u+=o[o.length-1].end-1+"], ["+a.start+"-",a.end=i.fileStart+i.byteLength,o.push(a)),n+=i.usedBytes,s+=i.byteLength;o.length>0&&(u+=a.end-1+"]");var c=e?r.info:r.debug;0===this.buffers.length?c("MultiBufferStream","No more buffer in memory"):c("MultiBufferStream",this.buffers.length+" stored buffer(s) ("+n+"/"+s+" bytes), continuous ranges: "+u)},o.prototype.cleanBuffers=function(){var e,t;for(e=0;e<this.buffers.length;e++)t=this.buffers[e],t.usedBytes===t.byteLength&&(r.debug("MultiBufferStream","Removing buffer #"+e),this.buffers.splice(e,1),e--)},o.prototype.mergeNextBuffer=function(){var e;if(this.bufferIndex+1<this.buffers.length){if(e=this.buffers[this.bufferIndex+1],e.fileStart===this.buffer.fileStart+this.buffer.byteLength){var t=this.buffer.byteLength,i=this.buffer.usedBytes,n=this.buffer.fileStart;return this.buffers[this.bufferIndex]=ArrayBuffer.concat(this.buffer,e),this.buffer=this.buffers[this.bufferIndex],this.buffers.splice(this.bufferIndex+1,1),this.buffer.usedBytes=i,this.buffer.fileStart=n,r.debug("ISOFile","Concatenating buffer for box parsing (length: "+t+"->"+this.buffer.byteLength+")"),!0}return!1}return!1},o.prototype.findPosition=function(e,t,i){var n,s=null,a=-1;n=!0===e?0:this.bufferIndex;while(n<this.buffers.length){if(s=this.buffers[n],!(s.fileStart<=t))break;a=n,i&&(s.fileStart+s.byteLength<=t?s.usedBytes=s.byteLength:s.usedBytes=t-s.fileStart,this.logBufferLevel()),n++}return-1!==a?(s=this.buffers[a],s.fileStart+s.byteLength>=t?(r.debug("MultiBufferStream","Found position in existing buffer #"+a),a):-1):-1},o.prototype.findEndContiguousBuf=function(e){var t,i,r,n=void 0!==e?e:this.bufferIndex;if(i=this.buffers[n],this.buffers.length>n+1)for(t=n+1;t<this.buffers.length;t++){if(r=this.buffers[t],r.fileStart!==i.fileStart+i.byteLength)break;i=r}return i.fileStart+i.byteLength},o.prototype.getEndFilePositionAfter=function(e){var t=this.findPosition(!0,e,!1);return-1!==t?this.findEndContiguousBuf(t):e},o.prototype.addUsedBytes=function(e){this.buffer.usedBytes+=e,this.logBufferLevel()},o.prototype.setAllUsedBytes=function(){this.buffer.usedBytes=this.buffer.byteLength,this.logBufferLevel()},o.prototype.seek=function(e,t,i){var n;return n=this.findPosition(t,e,i),-1!==n?(this.buffer=this.buffers[n],this.bufferIndex=n,this.position=e-this.buffer.fileStart,r.debug("MultiBufferStream","Repositioning parser at buffer position: "+this.position),!0):(r.debug("MultiBufferStream","Position "+e+" not found in buffered data"),!1)},o.prototype.getPosition=function(){if(-1===this.bufferIndex||null===this.buffers[this.bufferIndex])throw"Error accessing position in the MultiBufferStream";return this.buffers[this.bufferIndex].fileStart+this.position},o.prototype.getLength=function(){return this.byteLength},o.prototype.getEndPosition=function(){if(-1===this.bufferIndex||null===this.buffers[this.bufferIndex])throw"Error accessing position in the MultiBufferStream";return this.buffers[this.bufferIndex].fileStart+this.byteLength},t.MultiBufferStream=o;var u=function(){var e=3,t=4,i=5,n=6,s=[];s[e]="ES_Descriptor",s[t]="DecoderConfigDescriptor",s[i]="DecoderSpecificInfo",s[n]="SLConfigDescriptor",this.getDescriptorName=function(e){return s[e]};var a=this,o={};return this.parseOneDescriptor=function(e){var t,i,n,a=0;t=e.readUint8(),n=e.readUint8();while(128&n)a=(127&n)<<7,n=e.readUint8();return a+=127&n,r.debug("MPEG4DescriptorParser","Found "+(s[t]||"Descriptor "+t)+", size "+a+" at position "+e.getPosition()),i=s[t]?new o[s[t]](a):new o.Descriptor(a),i.parse(e),i},o.Descriptor=function(e,t){this.tag=e,this.size=t,this.descs=[]},o.Descriptor.prototype.parse=function(e){this.data=e.readUint8Array(this.size)},o.Descriptor.prototype.findDescriptor=function(e){for(var t=0;t<this.descs.length;t++)if(this.descs[t].tag==e)return this.descs[t];return null},o.Descriptor.prototype.parseRemainingDescriptors=function(e){var t=e.position;while(e.position<t+this.size){var i=a.parseOneDescriptor(e);this.descs.push(i)}},o.ES_Descriptor=function(t){o.Descriptor.call(this,e,t)},o.ES_Descriptor.prototype=new o.Descriptor,o.ES_Descriptor.prototype.parse=function(e){if(this.ES_ID=e.readUint16(),this.flags=e.readUint8(),this.size-=3,128&this.flags?(this.dependsOn_ES_ID=e.readUint16(),this.size-=2):this.dependsOn_ES_ID=0,64&this.flags){var t=e.readUint8();this.URL=e.readString(t),this.size-=t+1}else this.URL="";32&this.flags?(this.OCR_ES_ID=e.readUint16(),this.size-=2):this.OCR_ES_ID=0,this.parseRemainingDescriptors(e)},o.ES_Descriptor.prototype.getOTI=function(e){var i=this.findDescriptor(t);return i?i.oti:0},o.ES_Descriptor.prototype.getAudioConfig=function(e){var r=this.findDescriptor(t);if(!r)return null;var n=r.findDescriptor(i);if(n&&n.data){var s=(248&n.data[0])>>3;return 31===s&&n.data.length>=2&&(s=32+((7&n.data[0])<<3)+((224&n.data[1])>>5)),s}return null},o.DecoderConfigDescriptor=function(e){o.Descriptor.call(this,t,e)},o.DecoderConfigDescriptor.prototype=new o.Descriptor,o.DecoderConfigDescriptor.prototype.parse=function(e){this.oti=e.readUint8(),this.streamType=e.readUint8(),this.bufferSize=e.readUint24(),this.maxBitrate=e.readUint32(),this.avgBitrate=e.readUint32(),this.size-=13,this.parseRemainingDescriptors(e)},o.DecoderSpecificInfo=function(e){o.Descriptor.call(this,i,e)},o.DecoderSpecificInfo.prototype=new o.Descriptor,o.SLConfigDescriptor=function(e){o.Descriptor.call(this,n,e)},o.SLConfigDescriptor.prototype=new o.Descriptor,this};t.MPEG4DescriptorParser=u;var c={ERR_INVALID_DATA:-1,ERR_NOT_ENOUGH_DATA:0,OK:1,BASIC_BOXES:["mdat","idat","free","skip","meco","strk"],FULL_BOXES:["hmhd","nmhd","iods","xml ","bxml","ipro","mere"],CONTAINER_BOXES:[["moov",["trak","pssh"]],["trak"],["edts"],["mdia"],["minf"],["dinf"],["stbl",["sgpd","sbgp"]],["mvex",["trex"]],["moof",["traf"]],["traf",["trun","sgpd","sbgp"]],["vttc"],["tref"],["iref"],["mfra",["tfra"]],["meco"],["hnti"],["hinf"],["strk"],["strd"],["sinf"],["rinf"],["schi"],["trgr"],["udta",["kind"]],["iprp",["ipma"]],["ipco"]],boxCodes:[],fullBoxCodes:[],containerBoxCodes:[],sampleEntryCodes:{},sampleGroupEntryCodes:[],trackGroupTypes:[],UUIDBoxes:{},UUIDs:[],initialize:function(){c.FullBox.prototype=new c.Box,c.ContainerBox.prototype=new c.Box,c.SampleEntry.prototype=new c.Box,c.TrackGroupTypeBox.prototype=new c.FullBox,c.BASIC_BOXES.forEach((function(e){c.createBoxCtor(e)})),c.FULL_BOXES.forEach((function(e){c.createFullBoxCtor(e)})),c.CONTAINER_BOXES.forEach((function(e){c.createContainerBoxCtor(e[0],null,e[1])}))},Box:function(e,t,i){this.type=e,this.size=t,this.uuid=i},FullBox:function(e,t,i){c.Box.call(this,e,t,i),this.flags=0,this.version=0},ContainerBox:function(e,t,i){c.Box.call(this,e,t,i),this.boxes=[]},SampleEntry:function(e,t,i,r){c.ContainerBox.call(this,e,t),this.hdr_size=i,this.start=r},SampleGroupEntry:function(e){this.grouping_type=e},TrackGroupTypeBox:function(e,t){c.FullBox.call(this,e,t)},createBoxCtor:function(e,t){c.boxCodes.push(e),c[e+"Box"]=function(t){c.Box.call(this,e,t)},c[e+"Box"].prototype=new c.Box,t&&(c[e+"Box"].prototype.parse=t)},createFullBoxCtor:function(e,t){c[e+"Box"]=function(t){c.FullBox.call(this,e,t)},c[e+"Box"].prototype=new c.FullBox,c[e+"Box"].prototype.parse=function(e){this.parseFullHeader(e),t&&t.call(this,e)}},addSubBoxArrays:function(e){if(e){this.subBoxNames=e;for(var t=e.length,i=0;i<t;i++)this[e[i]+"s"]=[]}},createContainerBoxCtor:function(e,t,i){c[e+"Box"]=function(t){c.ContainerBox.call(this,e,t),c.addSubBoxArrays.call(this,i)},c[e+"Box"].prototype=new c.ContainerBox,t&&(c[e+"Box"].prototype.parse=t)},createMediaSampleEntryCtor:function(e,t,i){c.sampleEntryCodes[e]=[],c[e+"SampleEntry"]=function(e,t){c.SampleEntry.call(this,e,t),c.addSubBoxArrays.call(this,i)},c[e+"SampleEntry"].prototype=new c.SampleEntry,t&&(c[e+"SampleEntry"].prototype.parse=t)},createSampleEntryCtor:function(e,t,i,r){c.sampleEntryCodes[e].push(t),c[t+"SampleEntry"]=function(i){c[e+"SampleEntry"].call(this,t,i),c.addSubBoxArrays.call(this,r)},c[t+"SampleEntry"].prototype=new c[e+"SampleEntry"],i&&(c[t+"SampleEntry"].prototype.parse=i)},createEncryptedSampleEntryCtor:function(e,t,i){c.createSampleEntryCtor.call(this,e,t,i,["sinf"])},createSampleGroupCtor:function(e,t){c[e+"SampleGroupEntry"]=function(t){c.SampleGroupEntry.call(this,e,t)},c[e+"SampleGroupEntry"].prototype=new c.SampleGroupEntry,t&&(c[e+"SampleGroupEntry"].prototype.parse=t)},createTrackGroupCtor:function(e,t){c[e+"TrackGroupTypeBox"]=function(t){c.TrackGroupTypeBox.call(this,e,t)},c[e+"TrackGroupTypeBox"].prototype=new c.TrackGroupTypeBox,t&&(c[e+"TrackGroupTypeBox"].prototype.parse=t)},createUUIDBox:function(e,t,i,r){c.UUIDs.push(e),c.UUIDBoxes[e]=function(r){t?c.FullBox.call(this,"uuid",r,e):i?c.ContainerBox.call(this,"uuid",r,e):c.Box.call(this,"uuid",r,e)},c.UUIDBoxes[e].prototype=t?new c.FullBox:i?new c.ContainerBox:new c.Box,r&&(c.UUIDBoxes[e].prototype.parse=t?function(e){this.parseFullHeader(e),r&&r.call(this,e)}:r)}};c.initialize(),c.TKHD_FLAG_ENABLED=1,c.TKHD_FLAG_IN_MOVIE=2,c.TKHD_FLAG_IN_PREVIEW=4,c.TFHD_FLAG_BASE_DATA_OFFSET=1,c.TFHD_FLAG_SAMPLE_DESC=2,c.TFHD_FLAG_SAMPLE_DUR=8,c.TFHD_FLAG_SAMPLE_SIZE=16,c.TFHD_FLAG_SAMPLE_FLAGS=32,c.TFHD_FLAG_DUR_EMPTY=65536,c.TFHD_FLAG_DEFAULT_BASE_IS_MOOF=131072,c.TRUN_FLAGS_DATA_OFFSET=1,c.TRUN_FLAGS_FIRST_FLAG=4,c.TRUN_FLAGS_DURATION=256,c.TRUN_FLAGS_SIZE=512,c.TRUN_FLAGS_FLAGS=1024,c.TRUN_FLAGS_CTS_OFFSET=2048,c.Box.prototype.add=function(e){return this.addBox(new c[e+"Box"])},c.Box.prototype.addBox=function(e){return this.boxes.push(e),this[e.type+"s"]?this[e.type+"s"].push(e):this[e.type]=e,e},c.Box.prototype.set=function(e,t){return this[e]=t,this},c.Box.prototype.addEntry=function(e,t){var i=t||"entries";return this[i]||(this[i]=[]),this[i].push(e),this},t.BoxParser=c,c.parseUUID=function(e){return c.parseHex16(e)},c.parseHex16=function(e){for(var t="",i=0;i<16;i++){var r=e.readUint8().toString(16);t+=1===r.length?"0"+r:r}return t},c.parseOneBox=function(e,t,i){var n,s,a,o=e.getPosition(),u=0;if(e.getEndPosition()-o<8)return r.debug("BoxParser","Not enough data in stream to parse the type and size of the box"),{code:c.ERR_NOT_ENOUGH_DATA};if(i&&i<8)return r.debug("BoxParser","Not enough bytes left in the parent box to parse a new box"),{code:c.ERR_NOT_ENOUGH_DATA};var l=e.readUint32(),h=e.readString(4),f=h;if(r.debug("BoxParser","Found box of type '"+h+"' and size "+l+" at position "+o),u=8,"uuid"==h){if(e.getEndPosition()-e.getPosition()<16||i-u<16)return e.seek(o),r.debug("BoxParser","Not enough bytes left in the parent box to parse a UUID box"),{code:c.ERR_NOT_ENOUGH_DATA};a=c.parseUUID(e),u+=16,f=a}if(1==l){if(e.getEndPosition()-e.getPosition()<8||i&&i-u<8)return e.seek(o),r.warn("BoxParser",'Not enough data in stream to parse the extended size of the "'+h+'" box'),{code:c.ERR_NOT_ENOUGH_DATA};l=e.readUint64(),u+=8}else if(0===l)if(i)l=i;else if("mdat"!==h)return r.error("BoxParser","Unlimited box size not supported for type: '"+h+"'"),n=new c.Box(h,l),{code:c.OK,box:n,size:n.size};return l<u?(r.error("BoxParser","Box of type "+h+" has an invalid size "+l+" (too small to be a box)"),{code:c.ERR_NOT_ENOUGH_DATA,type:h,size:l,hdr_size:u,start:o}):i&&l>i?(r.error("BoxParser","Box of type '"+h+"' has a size "+l+" greater than its container size "+i),{code:c.ERR_NOT_ENOUGH_DATA,type:h,size:l,hdr_size:u,start:o}):o+l>e.getEndPosition()?(e.seek(o),r.info("BoxParser","Not enough data in stream to parse the entire '"+h+"' box"),{code:c.ERR_NOT_ENOUGH_DATA,type:h,size:l,hdr_size:u,start:o}):t?{code:c.OK,type:h,size:l,hdr_size:u,start:o}:(c[h+"Box"]?n=new c[h+"Box"](l):"uuid"!==h?(r.warn("BoxParser","Unknown box type: '"+h+"'"),n=new c.Box(h,l),n.has_unparsed_data=!0):c.UUIDBoxes[a]?n=new c.UUIDBoxes[a](l):(r.warn("BoxParser","Unknown uuid type: '"+a+"'"),n=new c.Box(h,l),n.uuid=a,n.has_unparsed_data=!0),n.hdr_size=u,n.start=o,n.write===c.Box.prototype.write&&"mdat"!==n.type&&(r.info("BoxParser","'"+f+"' box writing not yet implemented, keeping unparsed data in memory for later write"),n.parseDataAndRewind(e)),n.parse(e),s=e.getPosition()-(n.start+n.size),s<0?(r.warn("BoxParser","Parsing of box '"+f+"' did not read the entire indicated box data size (missing "+-s+" bytes), seeking forward"),e.seek(n.start+n.size)):s>0&&(r.error("BoxParser","Parsing of box '"+f+"' read "+s+" more bytes than the indicated box data size, seeking backwards"),e.seek(n.start+n.size)),{code:c.OK,box:n,size:n.size})},c.Box.prototype.parse=function(e){"mdat"!=this.type?this.data=e.readUint8Array(this.size-this.hdr_size):0===this.size?e.seek(e.getEndPosition()):e.seek(this.start+this.size)},c.Box.prototype.parseDataAndRewind=function(e){this.data=e.readUint8Array(this.size-this.hdr_size),e.position-=this.size-this.hdr_size},c.FullBox.prototype.parseDataAndRewind=function(e){this.parseFullHeader(e),this.data=e.readUint8Array(this.size-this.hdr_size),this.hdr_size-=4,e.position-=this.size-this.hdr_size},c.FullBox.prototype.parseFullHeader=function(e){this.version=e.readUint8(),this.flags=e.readUint24(),this.hdr_size+=4},c.FullBox.prototype.parse=function(e){this.parseFullHeader(e),this.data=e.readUint8Array(this.size-this.hdr_size)},c.ContainerBox.prototype.parse=function(e){var t,i;while(e.getPosition()<this.start+this.size){if(t=c.parseOneBox(e,!1,this.size-(e.getPosition()-this.start)),t.code!==c.OK)return;if(i=t.box,this.boxes.push(i),this.subBoxNames&&-1!=this.subBoxNames.indexOf(i.type))this[this.subBoxNames[this.subBoxNames.indexOf(i.type)]+"s"].push(i);else{var n="uuid"!==i.type?i.type:i.uuid;this[n]?r.warn("Box of type "+n+" already stored in field of this type"):this[n]=i}}},c.Box.prototype.parseLanguage=function(e){this.language=e.readUint16();var t=[];t[0]=this.language>>10&31,t[1]=this.language>>5&31,t[2]=31&this.language,this.languageString=String.fromCharCode(t[0]+96,t[1]+96,t[2]+96)},c.SAMPLE_ENTRY_TYPE_VISUAL="Visual",c.SAMPLE_ENTRY_TYPE_AUDIO="Audio",c.SAMPLE_ENTRY_TYPE_HINT="Hint",c.SAMPLE_ENTRY_TYPE_METADATA="Metadata",c.SAMPLE_ENTRY_TYPE_SUBTITLE="Subtitle",c.SAMPLE_ENTRY_TYPE_SYSTEM="System",c.SAMPLE_ENTRY_TYPE_TEXT="Text",c.SampleEntry.prototype.parseHeader=function(e){e.readUint8Array(6),this.data_reference_index=e.readUint16(),this.hdr_size+=8},c.SampleEntry.prototype.parse=function(e){this.parseHeader(e),this.data=e.readUint8Array(this.size-this.hdr_size)},c.SampleEntry.prototype.parseDataAndRewind=function(e){this.parseHeader(e),this.data=e.readUint8Array(this.size-this.hdr_size),this.hdr_size-=8,e.position-=this.size-this.hdr_size},c.SampleEntry.prototype.parseFooter=function(e){c.ContainerBox.prototype.parse.call(this,e)},c.createMediaSampleEntryCtor(c.SAMPLE_ENTRY_TYPE_HINT),c.createMediaSampleEntryCtor(c.SAMPLE_ENTRY_TYPE_METADATA),c.createMediaSampleEntryCtor(c.SAMPLE_ENTRY_TYPE_SUBTITLE),c.createMediaSampleEntryCtor(c.SAMPLE_ENTRY_TYPE_SYSTEM),c.createMediaSampleEntryCtor(c.SAMPLE_ENTRY_TYPE_TEXT),c.createMediaSampleEntryCtor(c.SAMPLE_ENTRY_TYPE_VISUAL,(function(e){var t;this.parseHeader(e),e.readUint16(),e.readUint16(),e.readUint32Array(3),this.width=e.readUint16(),this.height=e.readUint16(),this.horizresolution=e.readUint32(),this.vertresolution=e.readUint32(),e.readUint32(),this.frame_count=e.readUint16(),t=Math.min(31,e.readUint8()),this.compressorname=e.readString(t),t<31&&e.readString(31-t),this.depth=e.readUint16(),e.readUint16(),this.parseFooter(e)})),c.createMediaSampleEntryCtor(c.SAMPLE_ENTRY_TYPE_AUDIO,(function(e){this.parseHeader(e),e.readUint32Array(2),this.channel_count=e.readUint16(),this.samplesize=e.readUint16(),e.readUint16(),e.readUint16(),this.samplerate=e.readUint32()/65536,this.parseFooter(e)})),c.createSampleEntryCtor(c.SAMPLE_ENTRY_TYPE_VISUAL,"avc1"),c.createSampleEntryCtor(c.SAMPLE_ENTRY_TYPE_VISUAL,"avc2"),c.createSampleEntryCtor(c.SAMPLE_ENTRY_TYPE_VISUAL,"avc3"),c.createSampleEntryCtor(c.SAMPLE_ENTRY_TYPE_VISUAL,"avc4"),c.createSampleEntryCtor(c.SAMPLE_ENTRY_TYPE_VISUAL,"av01"),c.createSampleEntryCtor(c.SAMPLE_ENTRY_TYPE_VISUAL,"hvc1"),c.createSampleEntryCtor(c.SAMPLE_ENTRY_TYPE_VISUAL,"hev1"),c.createSampleEntryCtor(c.SAMPLE_ENTRY_TYPE_AUDIO,"mp4a"),c.createSampleEntryCtor(c.SAMPLE_ENTRY_TYPE_AUDIO,"ac-3"),c.createSampleEntryCtor(c.SAMPLE_ENTRY_TYPE_AUDIO,"ec-3"),c.createEncryptedSampleEntryCtor(c.SAMPLE_ENTRY_TYPE_VISUAL,"encv"),c.createEncryptedSampleEntryCtor(c.SAMPLE_ENTRY_TYPE_AUDIO,"enca"),c.createEncryptedSampleEntryCtor(c.SAMPLE_ENTRY_TYPE_SUBTITLE,"encu"),c.createEncryptedSampleEntryCtor(c.SAMPLE_ENTRY_TYPE_SYSTEM,"encs"),c.createEncryptedSampleEntryCtor(c.SAMPLE_ENTRY_TYPE_TEXT,"enct"),c.createEncryptedSampleEntryCtor(c.SAMPLE_ENTRY_TYPE_METADATA,"encm"),c.createBoxCtor("a1lx",(function(e){var t=1&e.readUint8(),i=16*(1+(1&t));this.layer_size=[];for(var r=0;r<3;r++)this.layer_size[r]=16==i?e.readUint16():e.readUint32()})),c.createBoxCtor("a1op",(function(e){this.op_index=e.readUint8()})),c.createFullBoxCtor("auxC",(function(e){this.aux_type=e.readCString();var t=this.size-this.hdr_size-(this.aux_type.length+1);this.aux_subtype=e.readUint8Array(t)})),c.createBoxCtor("av1C",(function(e){var t=e.readUint8();if(t>>7&!1)r.error("av1C marker problem");else if(this.version=127&t,1===this.version)if(t=e.readUint8(),this.seq_profile=t>>5&7,this.seq_level_idx_0=31&t,t=e.readUint8(),this.seq_tier_0=t>>7&1,this.high_bitdepth=t>>6&1,this.twelve_bit=t>>5&1,this.monochrome=t>>4&1,this.chroma_subsampling_x=t>>3&1,this.chroma_subsampling_y=t>>2&1,this.chroma_sample_position=3&t,t=e.readUint8(),this.reserved_1=t>>5&7,0===this.reserved_1){if(this.initial_presentation_delay_present=t>>4&1,1===this.initial_presentation_delay_present)this.initial_presentation_delay_minus_one=15&t;else if(this.reserved_2=15&t,0!==this.reserved_2)return void r.error("av1C reserved_2 parsing problem");var i=this.size-this.hdr_size-4;this.configOBUs=e.readUint8Array(i)}else r.error("av1C reserved_1 parsing problem");else r.error("av1C version "+this.version+" not supported")})),c.createBoxCtor("avcC",(function(e){var t,i;for(this.configurationVersion=e.readUint8(),this.AVCProfileIndication=e.readUint8(),this.profile_compatibility=e.readUint8(),this.AVCLevelIndication=e.readUint8(),this.lengthSizeMinusOne=3&e.readUint8(),this.nb_SPS_nalus=31&e.readUint8(),i=this.size-this.hdr_size-6,this.SPS=[],t=0;t<this.nb_SPS_nalus;t++)this.SPS[t]={},this.SPS[t].length=e.readUint16(),this.SPS[t].nalu=e.readUint8Array(this.SPS[t].length),i-=2+this.SPS[t].length;for(this.nb_PPS_nalus=e.readUint8(),i--,this.PPS=[],t=0;t<this.nb_PPS_nalus;t++)this.PPS[t]={},this.PPS[t].length=e.readUint16(),this.PPS[t].nalu=e.readUint8Array(this.PPS[t].length),i-=2+this.PPS[t].length;i>0&&(this.ext=e.readUint8Array(i))})),c.createBoxCtor("btrt",(function(e){this.bufferSizeDB=e.readUint32(),this.maxBitrate=e.readUint32(),this.avgBitrate=e.readUint32()})),c.createBoxCtor("clap",(function(e){this.cleanApertureWidthN=e.readUint32(),this.cleanApertureWidthD=e.readUint32(),this.cleanApertureHeightN=e.readUint32(),this.cleanApertureHeightD=e.readUint32(),this.horizOffN=e.readUint32(),this.horizOffD=e.readUint32(),this.vertOffN=e.readUint32(),this.vertOffD=e.readUint32()})),c.createBoxCtor("clli",(function(e){this.max_content_light_level=e.readUint16(),this.max_pic_average_light_level=e.readUint16()})),c.createFullBoxCtor("co64",(function(e){var t,i;if(t=e.readUint32(),this.chunk_offsets=[],0===this.version)for(i=0;i<t;i++)this.chunk_offsets.push(e.readUint64())})),c.createFullBoxCtor("CoLL",(function(e){this.maxCLL=e.readUint16(),this.maxFALL=e.readUint16()})),c.createBoxCtor("colr",(function(e){if(this.colour_type=e.readString(4),"nclx"===this.colour_type){this.colour_primaries=e.readUint16(),this.transfer_characteristics=e.readUint16(),this.matrix_coefficients=e.readUint16();var t=e.readUint8();this.full_range_flag=t>>7}else("rICC"===this.colour_type||"prof"===this.colour_type)&&(this.ICC_profile=e.readUint8Array(this.size-4))})),c.createFullBoxCtor("cprt",(function(e){this.parseLanguage(e),this.notice=e.readCString()})),c.createFullBoxCtor("cslg",(function(e){0===this.version&&(this.compositionToDTSShift=e.readInt32(),this.leastDecodeToDisplayDelta=e.readInt32(),this.greatestDecodeToDisplayDelta=e.readInt32(),this.compositionStartTime=e.readInt32(),this.compositionEndTime=e.readInt32())})),c.createFullBoxCtor("ctts",(function(e){var t,i;if(t=e.readUint32(),this.sample_counts=[],this.sample_offsets=[],0===this.version)for(i=0;i<t;i++){this.sample_counts.push(e.readUint32());var n=e.readInt32();n<0&&r.warn("BoxParser","ctts box uses negative values without using version 1"),this.sample_offsets.push(n)}else if(1==this.version)for(i=0;i<t;i++)this.sample_counts.push(e.readUint32()),this.sample_offsets.push(e.readInt32())})),c.createBoxCtor("dac3",(function(e){var t=e.readUint8(),i=e.readUint8(),r=e.readUint8();this.fscod=t>>6,this.bsid=t>>1&31,this.bsmod=(1&t)<<2|i>>6&3,this.acmod=i>>3&7,this.lfeon=i>>2&1,this.bit_rate_code=3&i|r>>5&7})),c.createBoxCtor("dec3",(function(e){var t=e.readUint16();this.data_rate=t>>3,this.num_ind_sub=7&t,this.ind_subs=[];for(var i=0;i<this.num_ind_sub+1;i++){var r={};this.ind_subs.push(r);var n=e.readUint8(),s=e.readUint8(),a=e.readUint8();r.fscod=n>>6,r.bsid=n>>1&31,r.bsmod=(1&n)<<4|s>>4&15,r.acmod=s>>1&7,r.lfeon=1&s,r.num_dep_sub=a>>1&15,r.num_dep_sub>0&&(r.chan_loc=(1&a)<<8|e.readUint8())}})),c.createFullBoxCtor("dfLa",(function(e){var t=127,i=128,r=[],n=["STREAMINFO","PADDING","APPLICATION","SEEKTABLE","VORBIS_COMMENT","CUESHEET","PICTURE","RESERVED"];this.parseFullHeader(e);do{var s=e.readUint8(),a=Math.min(s&t,n.length-1);if(a?e.readUint8Array(e.readUint24()):(e.readUint8Array(13),this.samplerate=e.readUint32()>>12,e.readUint8Array(20)),r.push(n[a]),s&i)break}while(1);this.numMetadataBlocks=r.length+" ("+r.join(", ")+")"})),c.createBoxCtor("dimm",(function(e){this.bytessent=e.readUint64()})),c.createBoxCtor("dmax",(function(e){this.time=e.readUint32()})),c.createBoxCtor("dmed",(function(e){this.bytessent=e.readUint64()})),c.createFullBoxCtor("dref",(function(e){var t,i;this.entries=[];for(var r=e.readUint32(),n=0;n<r;n++){if(t=c.parseOneBox(e,!1,this.size-(e.getPosition()-this.start)),t.code!==c.OK)return;i=t.box,this.entries.push(i)}})),c.createBoxCtor("drep",(function(e){this.bytessent=e.readUint64()})),c.createFullBoxCtor("elng",(function(e){this.extended_language=e.readString(this.size-this.hdr_size)})),c.createFullBoxCtor("elst",(function(e){this.entries=[];for(var t=e.readUint32(),i=0;i<t;i++){var r={};this.entries.push(r),1===this.version?(r.segment_duration=e.readUint64(),r.media_time=e.readInt64()):(r.segment_duration=e.readUint32(),r.media_time=e.readInt32()),r.media_rate_integer=e.readInt16(),r.media_rate_fraction=e.readInt16()}})),c.createFullBoxCtor("emsg",(function(e){1==this.version?(this.timescale=e.readUint32(),this.presentation_time=e.readUint64(),this.event_duration=e.readUint32(),this.id=e.readUint32(),this.scheme_id_uri=e.readCString(),this.value=e.readCString()):(this.scheme_id_uri=e.readCString(),this.value=e.readCString(),this.timescale=e.readUint32(),this.presentation_time_delta=e.readUint32(),this.event_duration=e.readUint32(),this.id=e.readUint32());var t=this.size-this.hdr_size-(16+(this.scheme_id_uri.length+1)+(this.value.length+1));1==this.version&&(t-=4),this.message_data=e.readUint8Array(t)})),c.createFullBoxCtor("esds",(function(e){var t=e.readUint8Array(this.size-this.hdr_size);if("undefined"!==typeof u){var i=new u;this.esd=i.parseOneDescriptor(new s(t.buffer,0,s.BIG_ENDIAN))}})),c.createBoxCtor("fiel",(function(e){this.fieldCount=e.readUint8(),this.fieldOrdering=e.readUint8()})),c.createBoxCtor("frma",(function(e){this.data_format=e.readString(4)})),c.createBoxCtor("ftyp",(function(e){var t=this.size-this.hdr_size;this.major_brand=e.readString(4),this.minor_version=e.readUint32(),t-=8,this.compatible_brands=[];var i=0;while(t>=4)this.compatible_brands[i]=e.readString(4),t-=4,i++})),c.createFullBoxCtor("hdlr",(function(e){0===this.version&&(e.readUint32(),this.handler=e.readString(4),e.readUint32Array(3),this.name=e.readString(this.size-this.hdr_size-20),"\0"===this.name[this.name.length-1]&&(this.name=this.name.slice(0,-1)))})),c.createBoxCtor("hvcC",(function(e){var t,i,r,n;this.configurationVersion=e.readUint8(),n=e.readUint8(),this.general_profile_space=n>>6,this.general_tier_flag=(32&n)>>5,this.general_profile_idc=31&n,this.general_profile_compatibility=e.readUint32(),this.general_constraint_indicator=e.readUint8Array(6),this.general_level_idc=e.readUint8(),this.min_spatial_segmentation_idc=4095&e.readUint16(),this.parallelismType=3&e.readUint8(),this.chroma_format_idc=3&e.readUint8(),this.bit_depth_luma_minus8=7&e.readUint8(),this.bit_depth_chroma_minus8=7&e.readUint8(),this.avgFrameRate=e.readUint16(),n=e.readUint8(),this.constantFrameRate=n>>6,this.numTemporalLayers=(13&n)>>3,this.temporalIdNested=(4&n)>>2,this.lengthSizeMinusOne=3&n,this.nalu_arrays=[];var s=e.readUint8();for(t=0;t<s;t++){var a=[];this.nalu_arrays.push(a),n=e.readUint8(),a.completeness=(128&n)>>7,a.nalu_type=63&n;var o=e.readUint16();for(i=0;i<o;i++){var u={};a.push(u),r=e.readUint16(),u.data=e.readUint8Array(r)}}})),c.createFullBoxCtor("iinf",(function(e){var t;0===this.version?this.entry_count=e.readUint16():this.entry_count=e.readUint32(),this.item_infos=[];for(var i=0;i<this.entry_count;i++){if(t=c.parseOneBox(e,!1,this.size-(e.getPosition()-this.start)),t.code!==c.OK)return;"infe"!==t.box.type&&r.error("BoxParser","Expected 'infe' box, got "+t.box.type),this.item_infos[i]=t.box}})),c.createFullBoxCtor("iloc",(function(e){var t;t=e.readUint8(),this.offset_size=t>>4&15,this.length_size=15&t,t=e.readUint8(),this.base_offset_size=t>>4&15,1===this.version||2===this.version?this.index_size=15&t:this.index_size=0,this.items=[];var i=0;if(this.version<2)i=e.readUint16();else{if(2!==this.version)throw"version of iloc box not supported";i=e.readUint32()}for(var r=0;r<i;r++){var n={};if(this.items.push(n),this.version<2)n.item_ID=e.readUint16();else{if(2!==this.version)throw"version of iloc box not supported";n.item_ID=e.readUint16()}switch(1===this.version||2===this.version?n.construction_method=15&e.readUint16():n.construction_method=0,n.data_reference_index=e.readUint16(),this.base_offset_size){case 0:n.base_offset=0;break;case 4:n.base_offset=e.readUint32();break;case 8:n.base_offset=e.readUint64();break;default:throw"Error reading base offset size"}var s=e.readUint16();n.extents=[];for(var a=0;a<s;a++){var o={};if(n.extents.push(o),1===this.version||2===this.version)switch(this.index_size){case 0:o.extent_index=0;break;case 4:o.extent_index=e.readUint32();break;case 8:o.extent_index=e.readUint64();break;default:throw"Error reading extent index"}switch(this.offset_size){case 0:o.extent_offset=0;break;case 4:o.extent_offset=e.readUint32();break;case 8:o.extent_offset=e.readUint64();break;default:throw"Error reading extent index"}switch(this.length_size){case 0:o.extent_length=0;break;case 4:o.extent_length=e.readUint32();break;case 8:o.extent_length=e.readUint64();break;default:throw"Error reading extent index"}}}})),c.createBoxCtor("imir",(function(e){var t=e.readUint8();this.reserved=t>>7,this.axis=1&t})),c.createFullBoxCtor("infe",(function(e){if(0!==this.version&&1!==this.version||(this.item_ID=e.readUint16(),this.item_protection_index=e.readUint16(),this.item_name=e.readCString(),this.content_type=e.readCString(),this.content_encoding=e.readCString()),1===this.version)return this.extension_type=e.readString(4),r.warn("BoxParser","Cannot parse extension type"),void e.seek(this.start+this.size);this.version>=2&&(2===this.version?this.item_ID=e.readUint16():3===this.version&&(this.item_ID=e.readUint32()),this.item_protection_index=e.readUint16(),this.item_type=e.readString(4),this.item_name=e.readCString(),"mime"===this.item_type?(this.content_type=e.readCString(),this.content_encoding=e.readCString()):"uri "===this.item_type&&(this.item_uri_type=e.readCString()))})),c.createFullBoxCtor("ipma",(function(e){var t,i;for(entry_count=e.readUint32(),this.associations=[],t=0;t<entry_count;t++){var r={};this.associations.push(r),this.version<1?r.id=e.readUint16():r.id=e.readUint32();var n=e.readUint8();for(r.props=[],i=0;i<n;i++){var s=e.readUint8(),a={};r.props.push(a),a.essential=(128&s)>>7===1,1&this.flags?a.property_index=(127&s)<<8|e.readUint8():a.property_index=127&s}}})),c.createFullBoxCtor("iref",(function(e){var t,i;this.references=[];while(e.getPosition()<this.start+this.size){if(t=c.parseOneBox(e,!0,this.size-(e.getPosition()-this.start)),t.code!==c.OK)return;i=0===this.version?new c.SingleItemTypeReferenceBox(t.type,t.size,t.hdr_size,t.start):new c.SingleItemTypeReferenceBoxLarge(t.type,t.size,t.hdr_size,t.start),i.write===c.Box.prototype.write&&"mdat"!==i.type&&(r.warn("BoxParser",i.type+" box writing not yet implemented, keeping unparsed data in memory for later write"),i.parseDataAndRewind(e)),i.parse(e),this.references.push(i)}})),c.createBoxCtor("irot",(function(e){this.angle=3&e.readUint8()})),c.createFullBoxCtor("ispe",(function(e){this.image_width=e.readUint32(),this.image_height=e.readUint32()})),c.createFullBoxCtor("kind",(function(e){this.schemeURI=e.readCString(),this.value=e.readCString()})),c.createFullBoxCtor("leva",(function(e){var t=e.readUint8();this.levels=[];for(var i=0;i<t;i++){var n={};this.levels[i]=n,n.track_ID=e.readUint32();var s=e.readUint8();switch(n.padding_flag=s>>7,n.assignment_type=127&s,n.assignment_type){case 0:n.grouping_type=e.readString(4);break;case 1:n.grouping_type=e.readString(4),n.grouping_type_parameter=e.readUint32();break;case 2:break;case 3:break;case 4:n.sub_track_id=e.readUint32();break;default:r.warn("BoxParser","Unknown leva assignement type")}}})),c.createBoxCtor("lsel",(function(e){this.layer_id=e.readUint16()})),c.createBoxCtor("maxr",(function(e){this.period=e.readUint32(),this.bytes=e.readUint32()})),c.createBoxCtor("mdcv",(function(e){this.display_primaries=[],this.display_primaries[0]={},this.display_primaries[0].x=e.readUint16(),this.display_primaries[0].y=e.readUint16(),this.display_primaries[1]={},this.display_primaries[1].x=e.readUint16(),this.display_primaries[1].y=e.readUint16(),this.display_primaries[2]={},this.display_primaries[2].x=e.readUint16(),this.display_primaries[2].y=e.readUint16(),this.white_point={},this.white_point.x=e.readUint16(),this.white_point.y=e.readUint16(),this.max_display_mastering_luminance=e.readUint32(),this.min_display_mastering_luminance=e.readUint32()})),c.createFullBoxCtor("mdhd",(function(e){1==this.version?(this.creation_time=e.readUint64(),this.modification_time=e.readUint64(),this.timescale=e.readUint32(),this.duration=e.readUint64()):(this.creation_time=e.readUint32(),this.modification_time=e.readUint32(),this.timescale=e.readUint32(),this.duration=e.readUint32()),this.parseLanguage(e),e.readUint16()})),c.createFullBoxCtor("mehd",(function(e){1&this.flags&&(r.warn("BoxParser","mehd box incorrectly uses flags set to 1, converting version to 1"),this.version=1),1==this.version?this.fragment_duration=e.readUint64():this.fragment_duration=e.readUint32()})),c.createFullBoxCtor("meta",(function(e){this.boxes=[],c.ContainerBox.prototype.parse.call(this,e)})),c.createFullBoxCtor("mfhd",(function(e){this.sequence_number=e.readUint32()})),c.createFullBoxCtor("mfro",(function(e){this._size=e.readUint32()})),c.createFullBoxCtor("mvhd",(function(e){1==this.version?(this.creation_time=e.readUint64(),this.modification_time=e.readUint64(),this.timescale=e.readUint32(),this.duration=e.readUint64()):(this.creation_time=e.readUint32(),this.modification_time=e.readUint32(),this.timescale=e.readUint32(),this.duration=e.readUint32()),this.rate=e.readUint32(),this.volume=e.readUint16()>>8,e.readUint16(),e.readUint32Array(2),this.matrix=e.readUint32Array(9),e.readUint32Array(6),this.next_track_id=e.readUint32()})),c.createBoxCtor("npck",(function(e){this.packetssent=e.readUint32()})),c.createBoxCtor("nump",(function(e){this.packetssent=e.readUint64()})),c.createFullBoxCtor("padb",(function(e){var t=e.readUint32();this.padbits=[];for(var i=0;i<Math.floor((t+1)/2);i++)this.padbits=e.readUint8()})),c.createBoxCtor("pasp",(function(e){this.hSpacing=e.readUint32(),this.vSpacing=e.readUint32()})),c.createBoxCtor("payl",(function(e){this.text=e.readString(this.size-this.hdr_size)})),c.createBoxCtor("payt",(function(e){this.payloadID=e.readUint32();var t=e.readUint8();this.rtpmap_string=e.readString(t)})),c.createFullBoxCtor("pdin",(function(e){var t=(this.size-this.hdr_size)/8;this.rate=[],this.initial_delay=[];for(var i=0;i<t;i++)this.rate[i]=e.readUint32(),this.initial_delay[i]=e.readUint32()})),c.createFullBoxCtor("pitm",(function(e){0===this.version?this.item_id=e.readUint16():this.item_id=e.readUint32()})),c.createFullBoxCtor("pixi",(function(e){var t;for(this.num_channels=e.readUint8(),this.bits_per_channels=[],t=0;t<this.num_channels;t++)this.bits_per_channels[t]=e.readUint8()})),c.createBoxCtor("pmax",(function(e){this.bytes=e.readUint32()})),c.createFullBoxCtor("prft",(function(e){this.ref_track_id=e.readUint32(),this.ntp_timestamp=e.readUint64(),0===this.version?this.media_time=e.readUint32():this.media_time=e.readUint64()})),c.createFullBoxCtor("pssh",(function(e){if(this.system_id=c.parseHex16(e),this.version>0){var t=e.readUint32();this.kid=[];for(var i=0;i<t;i++)this.kid[i]=c.parseHex16(e)}var r=e.readUint32();r>0&&(this.data=e.readUint8Array(r))})),c.createFullBoxCtor("clef",(function(e){this.width=e.readUint32(),this.height=e.readUint32()})),c.createFullBoxCtor("enof",(function(e){this.width=e.readUint32(),this.height=e.readUint32()})),c.createFullBoxCtor("prof",(function(e){this.width=e.readUint32(),this.height=e.readUint32()})),c.createContainerBoxCtor("tapt",null,["clef","prof","enof"]),c.createBoxCtor("rtp ",(function(e){this.descriptionformat=e.readString(4),this.sdptext=e.readString(this.size-this.hdr_size-4)})),c.createFullBoxCtor("saio",(function(e){1&this.flags&&(this.aux_info_type=e.readUint32(),this.aux_info_type_parameter=e.readUint32());var t=e.readUint32();this.offset=[];for(var i=0;i<t;i++)0===this.version?this.offset[i]=e.readUint32():this.offset[i]=e.readUint64()})),c.createFullBoxCtor("saiz",(function(e){1&this.flags&&(this.aux_info_type=e.readUint32(),this.aux_info_type_parameter=e.readUint32()),this.default_sample_info_size=e.readUint8();var t=e.readUint32();if(this.sample_info_size=[],0===this.default_sample_info_size)for(var i=0;i<t;i++)this.sample_info_size[i]=e.readUint8()})),c.createSampleEntryCtor(c.SAMPLE_ENTRY_TYPE_METADATA,"mett",(function(e){this.parseHeader(e),this.content_encoding=e.readCString(),this.mime_format=e.readCString(),this.parseFooter(e)})),c.createSampleEntryCtor(c.SAMPLE_ENTRY_TYPE_METADATA,"metx",(function(e){this.parseHeader(e),this.content_encoding=e.readCString(),this.namespace=e.readCString(),this.schema_location=e.readCString(),this.parseFooter(e)})),c.createSampleEntryCtor(c.SAMPLE_ENTRY_TYPE_SUBTITLE,"sbtt",(function(e){this.parseHeader(e),this.content_encoding=e.readCString(),this.mime_format=e.readCString(),this.parseFooter(e)})),c.createSampleEntryCtor(c.SAMPLE_ENTRY_TYPE_SUBTITLE,"stpp",(function(e){this.parseHeader(e),this.namespace=e.readCString(),this.schema_location=e.readCString(),this.auxiliary_mime_types=e.readCString(),this.parseFooter(e)})),c.createSampleEntryCtor(c.SAMPLE_ENTRY_TYPE_SUBTITLE,"stxt",(function(e){this.parseHeader(e),this.content_encoding=e.readCString(),this.mime_format=e.readCString(),this.parseFooter(e)})),c.createSampleEntryCtor(c.SAMPLE_ENTRY_TYPE_SUBTITLE,"tx3g",(function(e){this.parseHeader(e),this.displayFlags=e.readUint32(),this.horizontal_justification=e.readInt8(),this.vertical_justification=e.readInt8(),this.bg_color_rgba=e.readUint8Array(4),this.box_record=e.readInt16Array(4),this.style_record=e.readUint8Array(12),this.parseFooter(e)})),c.createSampleEntryCtor(c.SAMPLE_ENTRY_TYPE_METADATA,"wvtt",(function(e){this.parseHeader(e),this.parseFooter(e)})),c.createSampleGroupCtor("alst",(function(e){var t,i=e.readUint16();for(this.first_output_sample=e.readUint16(),this.sample_offset=[],t=0;t<i;t++)this.sample_offset[t]=e.readUint32();var r=this.description_length-4-4*i;for(this.num_output_samples=[],this.num_total_samples=[],t=0;t<r/4;t++)this.num_output_samples[t]=e.readUint16(),this.num_total_samples[t]=e.readUint16()})),c.createSampleGroupCtor("avll",(function(e){this.layerNumber=e.readUint8(),this.accurateStatisticsFlag=e.readUint8(),this.avgBitRate=e.readUint16(),this.avgFrameRate=e.readUint16()})),c.createSampleGroupCtor("avss",(function(e){this.subSequenceIdentifier=e.readUint16(),this.layerNumber=e.readUint8();var t=e.readUint8();this.durationFlag=t>>7,this.avgRateFlag=t>>6&1,this.durationFlag&&(this.duration=e.readUint32()),this.avgRateFlag&&(this.accurateStatisticsFlag=e.readUint8(),this.avgBitRate=e.readUint16(),this.avgFrameRate=e.readUint16()),this.dependency=[];for(var i=e.readUint8(),r=0;r<i;r++){var n={};this.dependency.push(n),n.subSeqDirectionFlag=e.readUint8(),n.layerNumber=e.readUint8(),n.subSequenceIdentifier=e.readUint16()}})),c.createSampleGroupCtor("dtrt",(function(e){r.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")})),c.createSampleGroupCtor("mvif",(function(e){r.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")})),c.createSampleGroupCtor("prol",(function(e){this.roll_distance=e.readInt16()})),c.createSampleGroupCtor("rap ",(function(e){var t=e.readUint8();this.num_leading_samples_known=t>>7,this.num_leading_samples=127&t})),c.createSampleGroupCtor("rash",(function(e){if(this.operation_point_count=e.readUint16(),this.description_length!==2+(1===this.operation_point_count?2:6*this.operation_point_count)+9)r.warn("BoxParser","Mismatch in "+this.grouping_type+" sample group length"),this.data=e.readUint8Array(this.description_length-2);else{if(1===this.operation_point_count)this.target_rate_share=e.readUint16();else{this.target_rate_share=[],this.available_bitrate=[];for(var t=0;t<this.operation_point_count;t++)this.available_bitrate[t]=e.readUint32(),this.target_rate_share[t]=e.readUint16()}this.maximum_bitrate=e.readUint32(),this.minimum_bitrate=e.readUint32(),this.discard_priority=e.readUint8()}})),c.createSampleGroupCtor("roll",(function(e){this.roll_distance=e.readInt16()})),c.SampleGroupEntry.prototype.parse=function(e){r.warn("BoxParser","Unknown Sample Group type: "+this.grouping_type),this.data=e.readUint8Array(this.description_length)},c.createSampleGroupCtor("scif",(function(e){r.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")})),c.createSampleGroupCtor("scnm",(function(e){r.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")})),c.createSampleGroupCtor("seig",(function(e){this.reserved=e.readUint8();var t=e.readUint8();this.crypt_byte_block=t>>4,this.skip_byte_block=15&t,this.isProtected=e.readUint8(),this.Per_Sample_IV_Size=e.readUint8(),this.KID=c.parseHex16(e),this.constant_IV_size=0,this.constant_IV=0,1===this.isProtected&&0===this.Per_Sample_IV_Size&&(this.constant_IV_size=e.readUint8(),this.constant_IV=e.readUint8Array(this.constant_IV_size))})),c.createSampleGroupCtor("stsa",(function(e){r.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")})),c.createSampleGroupCtor("sync",(function(e){var t=e.readUint8();this.NAL_unit_type=63&t})),c.createSampleGroupCtor("tele",(function(e){var t=e.readUint8();this.level_independently_decodable=t>>7})),c.createSampleGroupCtor("tsas",(function(e){r.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")})),c.createSampleGroupCtor("tscl",(function(e){r.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")})),c.createSampleGroupCtor("vipr",(function(e){r.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")})),c.createFullBoxCtor("sbgp",(function(e){this.grouping_type=e.readString(4),1===this.version?this.grouping_type_parameter=e.readUint32():this.grouping_type_parameter=0,this.entries=[];for(var t=e.readUint32(),i=0;i<t;i++){var r={};this.entries.push(r),r.sample_count=e.readInt32(),r.group_description_index=e.readInt32()}})),c.createFullBoxCtor("schm",(function(e){this.scheme_type=e.readString(4),this.scheme_version=e.readUint32(),1&this.flags&&(this.scheme_uri=e.readString(this.size-this.hdr_size-8))})),c.createBoxCtor("sdp ",(function(e){this.sdptext=e.readString(this.size-this.hdr_size)})),c.createFullBoxCtor("sdtp",(function(e){var t,i=this.size-this.hdr_size;this.is_leading=[],this.sample_depends_on=[],this.sample_is_depended_on=[],this.sample_has_redundancy=[];for(var r=0;r<i;r++)t=e.readUint8(),this.is_leading[r]=t>>6,this.sample_depends_on[r]=t>>4&3,this.sample_is_depended_on[r]=t>>2&3,this.sample_has_redundancy[r]=3&t})),c.createFullBoxCtor("senc"),c.createFullBoxCtor("sgpd",(function(e){this.grouping_type=e.readString(4),r.debug("BoxParser","Found Sample Groups of type "+this.grouping_type),1===this.version?this.default_length=e.readUint32():this.default_length=0,this.version>=2&&(this.default_group_description_index=e.readUint32()),this.entries=[];for(var t=e.readUint32(),i=0;i<t;i++){var n;n=c[this.grouping_type+"SampleGroupEntry"]?new c[this.grouping_type+"SampleGroupEntry"](this.grouping_type):new c.SampleGroupEntry(this.grouping_type),this.entries.push(n),1===this.version&&0===this.default_length?n.description_length=e.readUint32():n.description_length=this.default_length,n.write===c.SampleGroupEntry.prototype.write&&(r.info("BoxParser","SampleGroup for type "+this.grouping_type+" writing not yet implemented, keeping unparsed data in memory for later write"),n.data=e.readUint8Array(n.description_length),e.position-=n.description_length),n.parse(e)}})),c.createFullBoxCtor("sidx",(function(e){this.reference_ID=e.readUint32(),this.timescale=e.readUint32(),0===this.version?(this.earliest_presentation_time=e.readUint32(),this.first_offset=e.readUint32()):(this.earliest_presentation_time=e.readUint64(),this.first_offset=e.readUint64()),e.readUint16(),this.references=[];for(var t=e.readUint16(),i=0;i<t;i++){var r={};this.references.push(r);var n=e.readUint32();r.reference_type=n>>31&1,r.referenced_size=2147483647&n,r.subsegment_duration=e.readUint32(),n=e.readUint32(),r.starts_with_SAP=n>>31&1,r.SAP_type=n>>28&7,r.SAP_delta_time=268435455&n}})),c.SingleItemTypeReferenceBox=function(e,t,i,r){c.Box.call(this,e,t),this.hdr_size=i,this.start=r},c.SingleItemTypeReferenceBox.prototype=new c.Box,c.SingleItemTypeReferenceBox.prototype.parse=function(e){this.from_item_ID=e.readUint16();var t=e.readUint16();this.references=[];for(var i=0;i<t;i++)this.references[i]=e.readUint16()},c.SingleItemTypeReferenceBoxLarge=function(e,t,i,r){c.Box.call(this,e,t),this.hdr_size=i,this.start=r},c.SingleItemTypeReferenceBoxLarge.prototype=new c.Box,c.SingleItemTypeReferenceBoxLarge.prototype.parse=function(e){this.from_item_ID=e.readUint32();var t=e.readUint16();this.references=[];for(var i=0;i<t;i++)this.references[i]=e.readUint32()},c.createFullBoxCtor("SmDm",(function(e){this.primaryRChromaticity_x=e.readUint16(),this.primaryRChromaticity_y=e.readUint16(),this.primaryGChromaticity_x=e.readUint16(),this.primaryGChromaticity_y=e.readUint16(),this.primaryBChromaticity_x=e.readUint16(),this.primaryBChromaticity_y=e.readUint16(),this.whitePointChromaticity_x=e.readUint16(),this.whitePointChromaticity_y=e.readUint16(),this.luminanceMax=e.readUint32(),this.luminanceMin=e.readUint32()})),c.createFullBoxCtor("smhd",(function(e){this.balance=e.readUint16(),e.readUint16()})),c.createFullBoxCtor("ssix",(function(e){this.subsegments=[];for(var t=e.readUint32(),i=0;i<t;i++){var r={};this.subsegments.push(r),r.ranges=[];for(var n=e.readUint32(),s=0;s<n;s++){var a={};r.ranges.push(a),a.level=e.readUint8(),a.range_size=e.readUint24()}}})),c.createFullBoxCtor("stco",(function(e){var t;if(t=e.readUint32(),this.chunk_offsets=[],0===this.version)for(var i=0;i<t;i++)this.chunk_offsets.push(e.readUint32())})),c.createFullBoxCtor("stdp",(function(e){var t=(this.size-this.hdr_size)/2;this.priority=[];for(var i=0;i<t;i++)this.priority[i]=e.readUint16()})),c.createFullBoxCtor("sthd"),c.createFullBoxCtor("stri",(function(e){this.switch_group=e.readUint16(),this.alternate_group=e.readUint16(),this.sub_track_id=e.readUint32();var t=(this.size-this.hdr_size-8)/4;this.attribute_list=[];for(var i=0;i<t;i++)this.attribute_list[i]=e.readUint32()})),c.createFullBoxCtor("stsc",(function(e){var t,i;if(t=e.readUint32(),this.first_chunk=[],this.samples_per_chunk=[],this.sample_description_index=[],0===this.version)for(i=0;i<t;i++)this.first_chunk.push(e.readUint32()),this.samples_per_chunk.push(e.readUint32()),this.sample_description_index.push(e.readUint32())})),c.createFullBoxCtor("stsd",(function(e){var t,i,n,s;for(this.entries=[],n=e.readUint32(),t=1;t<=n;t++){if(i=c.parseOneBox(e,!0,this.size-(e.getPosition()-this.start)),i.code!==c.OK)return;c[i.type+"SampleEntry"]?(s=new c[i.type+"SampleEntry"](i.size),s.hdr_size=i.hdr_size,s.start=i.start):(r.warn("BoxParser","Unknown sample entry type: "+i.type),s=new c.SampleEntry(i.type,i.size,i.hdr_size,i.start)),s.write===c.SampleEntry.prototype.write&&(r.info("BoxParser","SampleEntry "+s.type+" box writing not yet implemented, keeping unparsed data in memory for later write"),s.parseDataAndRewind(e)),s.parse(e),this.entries.push(s)}})),c.createFullBoxCtor("stsg",(function(e){this.grouping_type=e.readUint32();var t=e.readUint16();this.group_description_index=[];for(var i=0;i<t;i++)this.group_description_index[i]=e.readUint32()})),c.createFullBoxCtor("stsh",(function(e){var t,i;if(t=e.readUint32(),this.shadowed_sample_numbers=[],this.sync_sample_numbers=[],0===this.version)for(i=0;i<t;i++)this.shadowed_sample_numbers.push(e.readUint32()),this.sync_sample_numbers.push(e.readUint32())})),c.createFullBoxCtor("stss",(function(e){var t,i;if(i=e.readUint32(),0===this.version)for(this.sample_numbers=[],t=0;t<i;t++)this.sample_numbers.push(e.readUint32())})),c.createFullBoxCtor("stsz",(function(e){var t;if(this.sample_sizes=[],0===this.version)for(this.sample_size=e.readUint32(),this.sample_count=e.readUint32(),t=0;t<this.sample_count;t++)0===this.sample_size?this.sample_sizes.push(e.readUint32()):this.sample_sizes[t]=this.sample_size})),c.createFullBoxCtor("stts",(function(e){var t,i,n;if(t=e.readUint32(),this.sample_counts=[],this.sample_deltas=[],0===this.version)for(i=0;i<t;i++)this.sample_counts.push(e.readUint32()),n=e.readInt32(),n<0&&(r.warn("BoxParser","File uses negative stts sample delta, using value 1 instead, sync may be lost!"),n=1),this.sample_deltas.push(n)})),c.createFullBoxCtor("stvi",(function(e){var t=e.readUint32();this.single_view_allowed=3&t,this.stereo_scheme=e.readUint32();var i,r,n=e.readUint32();this.stereo_indication_type=e.readString(n),this.boxes=[];while(e.getPosition()<this.start+this.size){if(i=c.parseOneBox(e,!1,this.size-(e.getPosition()-this.start)),i.code!==c.OK)return;r=i.box,this.boxes.push(r),this[r.type]=r}})),c.createBoxCtor("styp",(function(e){c.ftypBox.prototype.parse.call(this,e)})),c.createFullBoxCtor("stz2",(function(e){var t,i;if(this.sample_sizes=[],0===this.version)if(this.reserved=e.readUint24(),this.field_size=e.readUint8(),i=e.readUint32(),4===this.field_size)for(t=0;t<i;t+=2){var n=e.readUint8();this.sample_sizes[t]=n>>4&15,this.sample_sizes[t+1]=15&n}else if(8===this.field_size)for(t=0;t<i;t++)this.sample_sizes[t]=e.readUint8();else if(16===this.field_size)for(t=0;t<i;t++)this.sample_sizes[t]=e.readUint16();else r.error("BoxParser","Error in length field in stz2 box")})),c.createFullBoxCtor("subs",(function(e){var t,i,r,n;for(r=e.readUint32(),this.entries=[],t=0;t<r;t++){var s={};if(this.entries[t]=s,s.sample_delta=e.readUint32(),s.subsamples=[],n=e.readUint16(),n>0)for(i=0;i<n;i++){var a={};s.subsamples.push(a),1==this.version?a.size=e.readUint32():a.size=e.readUint16(),a.priority=e.readUint8(),a.discardable=e.readUint8(),a.codec_specific_parameters=e.readUint32()}}})),c.createFullBoxCtor("tenc",(function(e){if(e.readUint8(),0===this.version)e.readUint8();else{var t=e.readUint8();this.default_crypt_byte_block=t>>4&15,this.default_skip_byte_block=15&t}this.default_isProtected=e.readUint8(),this.default_Per_Sample_IV_Size=e.readUint8(),this.default_KID=c.parseHex16(e),1===this.default_isProtected&&0===this.default_Per_Sample_IV_Size&&(this.default_constant_IV_size=e.readUint8(),this.default_constant_IV=e.readUint8Array(this.default_constant_IV_size))})),c.createFullBoxCtor("tfdt",(function(e){1==this.version?this.baseMediaDecodeTime=e.readUint64():this.baseMediaDecodeTime=e.readUint32()})),c.createFullBoxCtor("tfhd",(function(e){var t=0;this.track_id=e.readUint32(),this.size-this.hdr_size>t&&this.flags&c.TFHD_FLAG_BASE_DATA_OFFSET?(this.base_data_offset=e.readUint64(),t+=8):this.base_data_offset=0,this.size-this.hdr_size>t&&this.flags&c.TFHD_FLAG_SAMPLE_DESC?(this.default_sample_description_index=e.readUint32(),t+=4):this.default_sample_description_index=0,this.size-this.hdr_size>t&&this.flags&c.TFHD_FLAG_SAMPLE_DUR?(this.default_sample_duration=e.readUint32(),t+=4):this.default_sample_duration=0,this.size-this.hdr_size>t&&this.flags&c.TFHD_FLAG_SAMPLE_SIZE?(this.default_sample_size=e.readUint32(),t+=4):this.default_sample_size=0,this.size-this.hdr_size>t&&this.flags&c.TFHD_FLAG_SAMPLE_FLAGS?(this.default_sample_flags=e.readUint32(),t+=4):this.default_sample_flags=0})),c.createFullBoxCtor("tfra",(function(e){this.track_ID=e.readUint32(),e.readUint24();var t=e.readUint8();this.length_size_of_traf_num=t>>4&3,this.length_size_of_trun_num=t>>2&3,this.length_size_of_sample_num=3&t,this.entries=[];for(var i=e.readUint32(),r=0;r<i;r++)1===this.version?(this.time=e.readUint64(),this.moof_offset=e.readUint64()):(this.time=e.readUint32(),this.moof_offset=e.readUint32()),this.traf_number=e["readUint"+8*(this.length_size_of_traf_num+1)](),this.trun_number=e["readUint"+8*(this.length_size_of_trun_num+1)](),this.sample_number=e["readUint"+8*(this.length_size_of_sample_num+1)]()})),c.createFullBoxCtor("tkhd",(function(e){1==this.version?(this.creation_time=e.readUint64(),this.modification_time=e.readUint64(),this.track_id=e.readUint32(),e.readUint32(),this.duration=e.readUint64()):(this.creation_time=e.readUint32(),this.modification_time=e.readUint32(),this.track_id=e.readUint32(),e.readUint32(),this.duration=e.readUint32()),e.readUint32Array(2),this.layer=e.readInt16(),this.alternate_group=e.readInt16(),this.volume=e.readInt16()>>8,e.readUint16(),this.matrix=e.readInt32Array(9),this.width=e.readUint32(),this.height=e.readUint32()})),c.createBoxCtor("tmax",(function(e){this.time=e.readUint32()})),c.createBoxCtor("tmin",(function(e){this.time=e.readUint32()})),c.createBoxCtor("totl",(function(e){this.bytessent=e.readUint32()})),c.createBoxCtor("tpay",(function(e){this.bytessent=e.readUint32()})),c.createBoxCtor("tpyl",(function(e){this.bytessent=e.readUint64()})),c.TrackGroupTypeBox.prototype.parse=function(e){this.parseFullHeader(e),this.track_group_id=e.readUint32()},c.createTrackGroupCtor("msrc"),c.TrackReferenceTypeBox=function(e,t,i,r){c.Box.call(this,e,t),this.hdr_size=i,this.start=r},c.TrackReferenceTypeBox.prototype=new c.Box,c.TrackReferenceTypeBox.prototype.parse=function(e){this.track_ids=e.readUint32Array((this.size-this.hdr_size)/4)},c.trefBox.prototype.parse=function(e){var t,i;while(e.getPosition()<this.start+this.size){if(t=c.parseOneBox(e,!0,this.size-(e.getPosition()-this.start)),t.code!==c.OK)return;i=new c.TrackReferenceTypeBox(t.type,t.size,t.hdr_size,t.start),i.write===c.Box.prototype.write&&"mdat"!==i.type&&(r.info("BoxParser","TrackReference "+i.type+" box writing not yet implemented, keeping unparsed data in memory for later write"),i.parseDataAndRewind(e)),i.parse(e),this.boxes.push(i)}},c.createFullBoxCtor("trep",(function(e){this.track_ID=e.readUint32(),this.boxes=[];while(e.getPosition()<this.start+this.size){if(ret=c.parseOneBox(e,!1,this.size-(e.getPosition()-this.start)),ret.code!==c.OK)return;box=ret.box,this.boxes.push(box)}})),c.createFullBoxCtor("trex",(function(e){this.track_id=e.readUint32(),this.default_sample_description_index=e.readUint32(),this.default_sample_duration=e.readUint32(),this.default_sample_size=e.readUint32(),this.default_sample_flags=e.readUint32()})),c.createBoxCtor("trpy",(function(e){this.bytessent=e.readUint64()})),c.createFullBoxCtor("trun",(function(e){var t=0;if(this.sample_count=e.readUint32(),t+=4,this.size-this.hdr_size>t&&this.flags&c.TRUN_FLAGS_DATA_OFFSET?(this.data_offset=e.readInt32(),t+=4):this.data_offset=0,this.size-this.hdr_size>t&&this.flags&c.TRUN_FLAGS_FIRST_FLAG?(this.first_sample_flags=e.readUint32(),t+=4):this.first_sample_flags=0,this.sample_duration=[],this.sample_size=[],this.sample_flags=[],this.sample_composition_time_offset=[],this.size-this.hdr_size>t)for(var i=0;i<this.sample_count;i++)this.flags&c.TRUN_FLAGS_DURATION&&(this.sample_duration[i]=e.readUint32()),this.flags&c.TRUN_FLAGS_SIZE&&(this.sample_size[i]=e.readUint32()),this.flags&c.TRUN_FLAGS_FLAGS&&(this.sample_flags[i]=e.readUint32()),this.flags&c.TRUN_FLAGS_CTS_OFFSET&&(0===this.version?this.sample_composition_time_offset[i]=e.readUint32():this.sample_composition_time_offset[i]=e.readInt32())})),c.createFullBoxCtor("tsel",(function(e){this.switch_group=e.readUint32();var t=(this.size-this.hdr_size-4)/4;this.attribute_list=[];for(var i=0;i<t;i++)this.attribute_list[i]=e.readUint32()})),c.createFullBoxCtor("txtC",(function(e){this.config=e.readCString()})),c.createFullBoxCtor("url ",(function(e){1!==this.flags&&(this.location=e.readCString())})),c.createFullBoxCtor("urn ",(function(e){this.name=e.readCString(),this.size-this.hdr_size-this.name.length-1>0&&(this.location=e.readCString())})),c.createUUIDBox("a5d40b30e81411ddba2f0800200c9a66",!0,!1,(function(e){this.LiveServerManifest=e.readString(this.size-this.hdr_size).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")})),c.createUUIDBox("d08a4f1810f34a82b6c832d8aba183d3",!0,!1,(function(e){this.system_id=c.parseHex16(e);var t=e.readUint32();t>0&&(this.data=e.readUint8Array(t))})),c.createUUIDBox("a2394f525a9b4f14a2446c427c648df4",!0,!1),c.createUUIDBox("8974dbce7be74c5184f97148f9882554",!0,!1,(function(e){this.default_AlgorithmID=e.readUint24(),this.default_IV_size=e.readUint8(),this.default_KID=c.parseHex16(e)})),c.createUUIDBox("d4807ef2ca3946958e5426cb9e46a79f",!0,!1,(function(e){this.fragment_count=e.readUint8(),this.entries=[];for(var t=0;t<this.fragment_count;t++){var i={},r=0,n=0;1===this.version?(r=e.readUint64(),n=e.readUint64()):(r=e.readUint32(),n=e.readUint32()),i.absolute_time=r,i.absolute_duration=n,this.entries.push(i)}})),c.createUUIDBox("6d1d9b0542d544e680e2141daff757b2",!0,!1,(function(e){1===this.version?(this.absolute_time=e.readUint64(),this.duration=e.readUint64()):(this.absolute_time=e.readUint32(),this.duration=e.readUint32())})),c.createFullBoxCtor("vmhd",(function(e){this.graphicsmode=e.readUint16(),this.opcolor=e.readUint16Array(3)})),c.createFullBoxCtor("vpcC",(function(e){var t;1===this.version?(this.profile=e.readUint8(),this.level=e.readUint8(),t=e.readUint8(),this.bitDepth=t>>4,this.chromaSubsampling=t>>1&7,this.videoFullRangeFlag=1&t,this.colourPrimaries=e.readUint8(),this.transferCharacteristics=e.readUint8(),this.matrixCoefficients=e.readUint8(),this.codecIntializationDataSize=e.readUint16(),this.codecIntializationData=e.readUint8Array(this.codecIntializationDataSize)):(this.profile=e.readUint8(),this.level=e.readUint8(),t=e.readUint8(),this.bitDepth=t>>4&15,this.colorSpace=15&t,t=e.readUint8(),this.chromaSubsampling=t>>4&15,this.transferFunction=t>>1&7,this.videoFullRangeFlag=1&t,this.codecIntializationDataSize=e.readUint16(),this.codecIntializationData=e.readUint8Array(this.codecIntializationDataSize))})),c.createBoxCtor("vttC",(function(e){this.text=e.readString(this.size-this.hdr_size)})),c.SampleEntry.prototype.isVideo=function(){return!1},c.SampleEntry.prototype.isAudio=function(){return!1},c.SampleEntry.prototype.isSubtitle=function(){return!1},c.SampleEntry.prototype.isMetadata=function(){return!1},c.SampleEntry.prototype.isHint=function(){return!1},c.SampleEntry.prototype.getCodec=function(){return this.type.replace(".","")},c.SampleEntry.prototype.getWidth=function(){return""},c.SampleEntry.prototype.getHeight=function(){return""},c.SampleEntry.prototype.getChannelCount=function(){return""},c.SampleEntry.prototype.getSampleRate=function(){return""},c.SampleEntry.prototype.getSampleSize=function(){return""},c.VisualSampleEntry.prototype.isVideo=function(){return!0},c.VisualSampleEntry.prototype.getWidth=function(){return this.width},c.VisualSampleEntry.prototype.getHeight=function(){return this.height},c.AudioSampleEntry.prototype.isAudio=function(){return!0},c.AudioSampleEntry.prototype.getChannelCount=function(){return this.channel_count},c.AudioSampleEntry.prototype.getSampleRate=function(){return this.samplerate},c.AudioSampleEntry.prototype.getSampleSize=function(){return this.samplesize},c.SubtitleSampleEntry.prototype.isSubtitle=function(){return!0},c.MetadataSampleEntry.prototype.isMetadata=function(){return!0},c.decimalToHex=function(e,t){var i=Number(e).toString(16);t="undefined"===typeof t||null===t?t=2:t;while(i.length<t)i="0"+i;return i},c.avc1SampleEntry.prototype.getCodec=c.avc2SampleEntry.prototype.getCodec=c.avc3SampleEntry.prototype.getCodec=c.avc4SampleEntry.prototype.getCodec=function(){var e=c.SampleEntry.prototype.getCodec.call(this);return this.avcC?e+"."+c.decimalToHex(this.avcC.AVCProfileIndication)+c.decimalToHex(this.avcC.profile_compatibility)+c.decimalToHex(this.avcC.AVCLevelIndication):e},c.hev1SampleEntry.prototype.getCodec=c.hvc1SampleEntry.prototype.getCodec=function(){var e,t=c.SampleEntry.prototype.getCodec.call(this);if(this.hvcC){switch(t+=".",this.hvcC.general_profile_space){case 0:t+="";break;case 1:t+="A";break;case 2:t+="B";break;case 3:t+="C";break}t+=this.hvcC.general_profile_idc,t+=".";var i=this.hvcC.general_profile_compatibility,r=0;for(e=0;e<32;e++){if(r|=1&i,31==e)break;r<<=1,i>>=1}t+=c.decimalToHex(r,0),t+=".",0===this.hvcC.general_tier_flag?t+="L":t+="H",t+=this.hvcC.general_level_idc;var n=!1,s="";for(e=5;e>=0;e--)(this.hvcC.general_constraint_indicator[e]||n)&&(s="."+c.decimalToHex(this.hvcC.general_constraint_indicator[e],0)+s,n=!0);t+=s}return t},c.mp4aSampleEntry.prototype.getCodec=function(){var e=c.SampleEntry.prototype.getCodec.call(this);if(this.esds&&this.esds.esd){var t=this.esds.esd.getOTI(),i=this.esds.esd.getAudioConfig();return e+"."+c.decimalToHex(t)+(i?"."+i:"")}return e},c.stxtSampleEntry.prototype.getCodec=function(){var e=c.SampleEntry.prototype.getCodec.call(this);return this.mime_format?e+"."+this.mime_format:e},c.av01SampleEntry.prototype.getCodec=function(){var e,t=c.SampleEntry.prototype.getCodec.call(this);return 2===this.av1C.seq_profile&&1===this.av1C.high_bitdepth?e=1===this.av1C.twelve_bit?"12":"10":this.av1C.seq_profile<=2&&(e=1===this.av1C.high_bitdepth?"10":"08"),t+"."+this.av1C.seq_profile+"."+this.av1C.seq_level_idx_0+(this.av1C.seq_tier_0?"H":"M")+"."+e},c.Box.prototype.writeHeader=function(e,t){this.size+=8,this.size>a&&(this.size+=8),"uuid"===this.type&&(this.size+=16),r.debug("BoxWriter","Writing box "+this.type+" of size: "+this.size+" at position "+e.getPosition()+(t||"")),this.size>a?e.writeUint32(1):(this.sizePosition=e.getPosition(),e.writeUint32(this.size)),e.writeString(this.type,null,4),"uuid"===this.type&&e.writeUint8Array(this.uuid),this.size>a&&e.writeUint64(this.size)},c.FullBox.prototype.writeHeader=function(e){this.size+=4,c.Box.prototype.writeHeader.call(this,e," v="+this.version+" f="+this.flags),e.writeUint8(this.version),e.writeUint24(this.flags)},c.Box.prototype.write=function(e){"mdat"===this.type?this.data&&(this.size=this.data.length,this.writeHeader(e),e.writeUint8Array(this.data)):(this.size=this.data?this.data.length:0,this.writeHeader(e),this.data&&e.writeUint8Array(this.data))},c.ContainerBox.prototype.write=function(e){this.size=0,this.writeHeader(e);for(var t=0;t<this.boxes.length;t++)this.boxes[t]&&(this.boxes[t].write(e),this.size+=this.boxes[t].size);r.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),e.adjustUint32(this.sizePosition,this.size)},c.TrackReferenceTypeBox.prototype.write=function(e){this.size=4*this.track_ids.length,this.writeHeader(e),e.writeUint32Array(this.track_ids)},c.avcCBox.prototype.write=function(e){var t;for(this.size=7,t=0;t<this.SPS.length;t++)this.size+=2+this.SPS[t].length;for(t=0;t<this.PPS.length;t++)this.size+=2+this.PPS[t].length;for(this.ext&&(this.size+=this.ext.length),this.writeHeader(e),e.writeUint8(this.configurationVersion),e.writeUint8(this.AVCProfileIndication),e.writeUint8(this.profile_compatibility),e.writeUint8(this.AVCLevelIndication),e.writeUint8(this.lengthSizeMinusOne+252),e.writeUint8(this.SPS.length+224),t=0;t<this.SPS.length;t++)e.writeUint16(this.SPS[t].length),e.writeUint8Array(this.SPS[t].nalu);for(e.writeUint8(this.PPS.length),t=0;t<this.PPS.length;t++)e.writeUint16(this.PPS[t].length),e.writeUint8Array(this.PPS[t].nalu);this.ext&&e.writeUint8Array(this.ext)},c.co64Box.prototype.write=function(e){var t;for(this.version=0,this.flags=0,this.size=4+8*this.chunk_offsets.length,this.writeHeader(e),e.writeUint32(this.chunk_offsets.length),t=0;t<this.chunk_offsets.length;t++)e.writeUint64(this.chunk_offsets[t])},c.cslgBox.prototype.write=function(e){this.version=0,this.flags=0,this.size=20,this.writeHeader(e),e.writeInt32(this.compositionToDTSShift),e.writeInt32(this.leastDecodeToDisplayDelta),e.writeInt32(this.greatestDecodeToDisplayDelta),e.writeInt32(this.compositionStartTime),e.writeInt32(this.compositionEndTime)},c.cttsBox.prototype.write=function(e){var t;for(this.version=0,this.flags=0,this.size=4+8*this.sample_counts.length,this.writeHeader(e),e.writeUint32(this.sample_counts.length),t=0;t<this.sample_counts.length;t++)e.writeUint32(this.sample_counts[t]),1===this.version?e.writeInt32(this.sample_offsets[t]):e.writeUint32(this.sample_offsets[t])},c.drefBox.prototype.write=function(e){this.version=0,this.flags=0,this.size=4,this.writeHeader(e),e.writeUint32(this.entries.length);for(var t=0;t<this.entries.length;t++)this.entries[t].write(e),this.size+=this.entries[t].size;r.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),e.adjustUint32(this.sizePosition,this.size)},c.elngBox.prototype.write=function(e){this.version=0,this.flags=0,this.size=this.extended_language.length,this.writeHeader(e),e.writeString(this.extended_language)},c.elstBox.prototype.write=function(e){this.version=0,this.flags=0,this.size=4+12*this.entries.length,this.writeHeader(e),e.writeUint32(this.entries.length);for(var t=0;t<this.entries.length;t++){var i=this.entries[t];e.writeUint32(i.segment_duration),e.writeInt32(i.media_time),e.writeInt16(i.media_rate_integer),e.writeInt16(i.media_rate_fraction)}},c.emsgBox.prototype.write=function(e){this.version=0,this.flags=0,this.size=16+this.message_data.length+(this.scheme_id_uri.length+1)+(this.value.length+1),this.writeHeader(e),e.writeCString(this.scheme_id_uri),e.writeCString(this.value),e.writeUint32(this.timescale),e.writeUint32(this.presentation_time_delta),e.writeUint32(this.event_duration),e.writeUint32(this.id),e.writeUint8Array(this.message_data)},c.ftypBox.prototype.write=function(e){this.size=8+4*this.compatible_brands.length,this.writeHeader(e),e.writeString(this.major_brand,null,4),e.writeUint32(this.minor_version);for(var t=0;t<this.compatible_brands.length;t++)e.writeString(this.compatible_brands[t],null,4)},c.hdlrBox.prototype.write=function(e){this.size=20+this.name.length+1,this.version=0,this.flags=0,this.writeHeader(e),e.writeUint32(0),e.writeString(this.handler,null,4),e.writeUint32(0),e.writeUint32(0),e.writeUint32(0),e.writeCString(this.name)},c.kindBox.prototype.write=function(e){this.version=0,this.flags=0,this.size=this.schemeURI.length+1+(this.value.length+1),this.writeHeader(e),e.writeCString(this.schemeURI),e.writeCString(this.value)},c.mdhdBox.prototype.write=function(e){this.size=20,this.flags=0,this.version=0,this.writeHeader(e),e.writeUint32(this.creation_time),e.writeUint32(this.modification_time),e.writeUint32(this.timescale),e.writeUint32(this.duration),e.writeUint16(this.language),e.writeUint16(0)},c.mehdBox.prototype.write=function(e){this.version=0,this.flags=0,this.size=4,this.writeHeader(e),e.writeUint32(this.fragment_duration)},c.mfhdBox.prototype.write=function(e){this.version=0,this.flags=0,this.size=4,this.writeHeader(e),e.writeUint32(this.sequence_number)},c.mvhdBox.prototype.write=function(e){this.version=0,this.flags=0,this.size=96,this.writeHeader(e),e.writeUint32(this.creation_time),e.writeUint32(this.modification_time),e.writeUint32(this.timescale),e.writeUint32(this.duration),e.writeUint32(this.rate),e.writeUint16(this.volume<<8),e.writeUint16(0),e.writeUint32(0),e.writeUint32(0),e.writeUint32Array(this.matrix),e.writeUint32(0),e.writeUint32(0),e.writeUint32(0),e.writeUint32(0),e.writeUint32(0),e.writeUint32(0),e.writeUint32(this.next_track_id)},c.SampleEntry.prototype.writeHeader=function(e){this.size=8,c.Box.prototype.writeHeader.call(this,e),e.writeUint8(0),e.writeUint8(0),e.writeUint8(0),e.writeUint8(0),e.writeUint8(0),e.writeUint8(0),e.writeUint16(this.data_reference_index)},c.SampleEntry.prototype.writeFooter=function(e){for(var t=0;t<this.boxes.length;t++)this.boxes[t].write(e),this.size+=this.boxes[t].size;r.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),e.adjustUint32(this.sizePosition,this.size)},c.SampleEntry.prototype.write=function(e){this.writeHeader(e),e.writeUint8Array(this.data),this.size+=this.data.length,r.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),e.adjustUint32(this.sizePosition,this.size)},c.VisualSampleEntry.prototype.write=function(e){this.writeHeader(e),this.size+=70,e.writeUint16(0),e.writeUint16(0),e.writeUint32(0),e.writeUint32(0),e.writeUint32(0),e.writeUint16(this.width),e.writeUint16(this.height),e.writeUint32(this.horizresolution),e.writeUint32(this.vertresolution),e.writeUint32(0),e.writeUint16(this.frame_count),e.writeUint8(Math.min(31,this.compressorname.length)),e.writeString(this.compressorname,null,31),e.writeUint16(this.depth),e.writeInt16(-1),this.writeFooter(e)},c.AudioSampleEntry.prototype.write=function(e){this.writeHeader(e),this.size+=20,e.writeUint32(0),e.writeUint32(0),e.writeUint16(this.channel_count),e.writeUint16(this.samplesize),e.writeUint16(0),e.writeUint16(0),e.writeUint32(this.samplerate<<16),this.writeFooter(e)},c.stppSampleEntry.prototype.write=function(e){this.writeHeader(e),this.size+=this.namespace.length+1+this.schema_location.length+1+this.auxiliary_mime_types.length+1,e.writeCString(this.namespace),e.writeCString(this.schema_location),e.writeCString(this.auxiliary_mime_types),this.writeFooter(e)},c.SampleGroupEntry.prototype.write=function(e){e.writeUint8Array(this.data)},c.sbgpBox.prototype.write=function(e){this.version=1,this.flags=0,this.size=12+8*this.entries.length,this.writeHeader(e),e.writeString(this.grouping_type,null,4),e.writeUint32(this.grouping_type_parameter),e.writeUint32(this.entries.length);for(var t=0;t<this.entries.length;t++){var i=this.entries[t];e.writeInt32(i.sample_count),e.writeInt32(i.group_description_index)}},c.sgpdBox.prototype.write=function(e){var t,i;for(this.flags=0,this.size=12,t=0;t<this.entries.length;t++)i=this.entries[t],1===this.version&&(0===this.default_length&&(this.size+=4),this.size+=i.data.length);for(this.writeHeader(e),e.writeString(this.grouping_type,null,4),1===this.version&&e.writeUint32(this.default_length),this.version>=2&&e.writeUint32(this.default_sample_description_index),e.writeUint32(this.entries.length),t=0;t<this.entries.length;t++)i=this.entries[t],1===this.version&&0===this.default_length&&e.writeUint32(i.description_length),i.write(e)},c.sidxBox.prototype.write=function(e){this.version=0,this.flags=0,this.size=20+12*this.references.length,this.writeHeader(e),e.writeUint32(this.reference_ID),e.writeUint32(this.timescale),e.writeUint32(this.earliest_presentation_time),e.writeUint32(this.first_offset),e.writeUint16(0),e.writeUint16(this.references.length);for(var t=0;t<this.references.length;t++){var i=this.references[t];e.writeUint32(i.reference_type<<31|i.referenced_size),e.writeUint32(i.subsegment_duration),e.writeUint32(i.starts_with_SAP<<31|i.SAP_type<<28|i.SAP_delta_time)}},c.stcoBox.prototype.write=function(e){this.version=0,this.flags=0,this.size=4+4*this.chunk_offsets.length,this.writeHeader(e),e.writeUint32(this.chunk_offsets.length),e.writeUint32Array(this.chunk_offsets)},c.stscBox.prototype.write=function(e){var t;for(this.version=0,this.flags=0,this.size=4+12*this.first_chunk.length,this.writeHeader(e),e.writeUint32(this.first_chunk.length),t=0;t<this.first_chunk.length;t++)e.writeUint32(this.first_chunk[t]),e.writeUint32(this.samples_per_chunk[t]),e.writeUint32(this.sample_description_index[t])},c.stsdBox.prototype.write=function(e){var t;for(this.version=0,this.flags=0,this.size=0,this.writeHeader(e),e.writeUint32(this.entries.length),this.size+=4,t=0;t<this.entries.length;t++)this.entries[t].write(e),this.size+=this.entries[t].size;r.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),e.adjustUint32(this.sizePosition,this.size)},c.stshBox.prototype.write=function(e){var t;for(this.version=0,this.flags=0,this.size=4+8*this.shadowed_sample_numbers.length,this.writeHeader(e),e.writeUint32(this.shadowed_sample_numbers.length),t=0;t<this.shadowed_sample_numbers.length;t++)e.writeUint32(this.shadowed_sample_numbers[t]),e.writeUint32(this.sync_sample_numbers[t])},c.stssBox.prototype.write=function(e){this.version=0,this.flags=0,this.size=4+4*this.sample_numbers.length,this.writeHeader(e),e.writeUint32(this.sample_numbers.length),e.writeUint32Array(this.sample_numbers)},c.stszBox.prototype.write=function(e){var t,i=!0;if(this.version=0,this.flags=0,this.sample_sizes.length>0){t=0;while(t+1<this.sample_sizes.length){if(this.sample_sizes[t+1]!==this.sample_sizes[0]){i=!1;break}t++}}else i=!1;this.size=8,i||(this.size+=4*this.sample_sizes.length),this.writeHeader(e),i?e.writeUint32(this.sample_sizes[0]):e.writeUint32(0),e.writeUint32(this.sample_sizes.length),i||e.writeUint32Array(this.sample_sizes)},c.sttsBox.prototype.write=function(e){var t;for(this.version=0,this.flags=0,this.size=4+8*this.sample_counts.length,this.writeHeader(e),e.writeUint32(this.sample_counts.length),t=0;t<this.sample_counts.length;t++)e.writeUint32(this.sample_counts[t]),e.writeUint32(this.sample_deltas[t])},c.tfdtBox.prototype.write=function(e){var t=Math.pow(2,32)-1;this.version=this.baseMediaDecodeTime>t?1:0,this.flags=0,this.size=4,1===this.version&&(this.size+=4),this.writeHeader(e),1===this.version?e.writeUint64(this.baseMediaDecodeTime):e.writeUint32(this.baseMediaDecodeTime)},c.tfhdBox.prototype.write=function(e){this.version=0,this.size=4,this.flags&c.TFHD_FLAG_BASE_DATA_OFFSET&&(this.size+=8),this.flags&c.TFHD_FLAG_SAMPLE_DESC&&(this.size+=4),this.flags&c.TFHD_FLAG_SAMPLE_DUR&&(this.size+=4),this.flags&c.TFHD_FLAG_SAMPLE_SIZE&&(this.size+=4),this.flags&c.TFHD_FLAG_SAMPLE_FLAGS&&(this.size+=4),this.writeHeader(e),e.writeUint32(this.track_id),this.flags&c.TFHD_FLAG_BASE_DATA_OFFSET&&e.writeUint64(this.base_data_offset),this.flags&c.TFHD_FLAG_SAMPLE_DESC&&e.writeUint32(this.default_sample_description_index),this.flags&c.TFHD_FLAG_SAMPLE_DUR&&e.writeUint32(this.default_sample_duration),this.flags&c.TFHD_FLAG_SAMPLE_SIZE&&e.writeUint32(this.default_sample_size),this.flags&c.TFHD_FLAG_SAMPLE_FLAGS&&e.writeUint32(this.default_sample_flags)},c.tkhdBox.prototype.write=function(e){this.version=0,this.size=80,this.writeHeader(e),e.writeUint32(this.creation_time),e.writeUint32(this.modification_time),e.writeUint32(this.track_id),e.writeUint32(0),e.writeUint32(this.duration),e.writeUint32(0),e.writeUint32(0),e.writeInt16(this.layer),e.writeInt16(this.alternate_group),e.writeInt16(this.volume<<8),e.writeUint16(0),e.writeInt32Array(this.matrix),e.writeUint32(this.width),e.writeUint32(this.height)},c.trexBox.prototype.write=function(e){this.version=0,this.flags=0,this.size=20,this.writeHeader(e),e.writeUint32(this.track_id),e.writeUint32(this.default_sample_description_index),e.writeUint32(this.default_sample_duration),e.writeUint32(this.default_sample_size),e.writeUint32(this.default_sample_flags)},c.trunBox.prototype.write=function(e){this.version=0,this.size=4,this.flags&c.TRUN_FLAGS_DATA_OFFSET&&(this.size+=4),this.flags&c.TRUN_FLAGS_FIRST_FLAG&&(this.size+=4),this.flags&c.TRUN_FLAGS_DURATION&&(this.size+=4*this.sample_duration.length),this.flags&c.TRUN_FLAGS_SIZE&&(this.size+=4*this.sample_size.length),this.flags&c.TRUN_FLAGS_FLAGS&&(this.size+=4*this.sample_flags.length),this.flags&c.TRUN_FLAGS_CTS_OFFSET&&(this.size+=4*this.sample_composition_time_offset.length),this.writeHeader(e),e.writeUint32(this.sample_count),this.flags&c.TRUN_FLAGS_DATA_OFFSET&&(this.data_offset_position=e.getPosition(),e.writeInt32(this.data_offset)),this.flags&c.TRUN_FLAGS_FIRST_FLAG&&e.writeUint32(this.first_sample_flags);for(var t=0;t<this.sample_count;t++)this.flags&c.TRUN_FLAGS_DURATION&&e.writeUint32(this.sample_duration[t]),this.flags&c.TRUN_FLAGS_SIZE&&e.writeUint32(this.sample_size[t]),this.flags&c.TRUN_FLAGS_FLAGS&&e.writeUint32(this.sample_flags[t]),this.flags&c.TRUN_FLAGS_CTS_OFFSET&&(0===this.version?e.writeUint32(this.sample_composition_time_offset[t]):e.writeInt32(this.sample_composition_time_offset[t]))},c["url Box"].prototype.write=function(e){this.version=0,this.location?(this.flags=0,this.size=this.location.length+1):(this.flags=1,this.size=0),this.writeHeader(e),this.location&&e.writeCString(this.location)},c["urn Box"].prototype.write=function(e){this.version=0,this.flags=0,this.size=this.name.length+1+(this.location?this.location.length+1:0),this.writeHeader(e),e.writeCString(this.name),this.location&&e.writeCString(this.location)},c.vmhdBox.prototype.write=function(e){this.version=0,this.flags=1,this.size=8,this.writeHeader(e),e.writeUint16(this.graphicsmode),e.writeUint16Array(this.opcolor)},c.cttsBox.prototype.unpack=function(e){var t,i,r;for(r=0,t=0;t<this.sample_counts.length;t++)for(i=0;i<this.sample_counts[t];i++)e[r].pts=e[r].dts+this.sample_offsets[t],r++},c.sttsBox.prototype.unpack=function(e){var t,i,r;for(r=0,t=0;t<this.sample_counts.length;t++)for(i=0;i<this.sample_counts[t];i++)e[r].dts=0===r?0:e[r-1].dts+this.sample_deltas[t],r++},c.stcoBox.prototype.unpack=function(e){var t;for(t=0;t<this.chunk_offsets.length;t++)e[t].offset=this.chunk_offsets[t]},c.stscBox.prototype.unpack=function(e){var t,i,r,n,s;for(n=0,s=0,t=0;t<this.first_chunk.length;t++)for(i=0;i<(t+1<this.first_chunk.length?this.first_chunk[t+1]:1/0);i++)for(s++,r=0;r<this.samples_per_chunk[t];r++){if(!e[n])return;e[n].description_index=this.sample_description_index[t],e[n].chunk_index=s,n++}},c.stszBox.prototype.unpack=function(e){var t;for(t=0;t<this.sample_sizes.length;t++)e[t].size=this.sample_sizes[t]},c.DIFF_BOXES_PROP_NAMES=["boxes","entries","references","subsamples","items","item_infos","extents","associations","subsegments","ranges","seekLists","seekPoints","esd","levels"],c.DIFF_PRIMITIVE_ARRAY_PROP_NAMES=["compatible_brands","matrix","opcolor","sample_counts","sample_counts","sample_deltas","first_chunk","samples_per_chunk","sample_sizes","chunk_offsets","sample_offsets","sample_description_index","sample_duration"],c.boxEqualFields=function(e,t){if(e&&!t)return!1;var i;for(i in e)if(!(c.DIFF_BOXES_PROP_NAMES.indexOf(i)>-1)&&!(e[i]instanceof c.Box||t[i]instanceof c.Box)&&"undefined"!==typeof e[i]&&"undefined"!==typeof t[i]&&"function"!==typeof e[i]&&"function"!==typeof t[i]&&!(e.subBoxNames&&e.subBoxNames.indexOf(i.slice(0,4))>-1||t.subBoxNames&&t.subBoxNames.indexOf(i.slice(0,4))>-1)&&"data"!==i&&"start"!==i&&"size"!==i&&"creation_time"!==i&&"modification_time"!==i&&!(c.DIFF_PRIMITIVE_ARRAY_PROP_NAMES.indexOf(i)>-1)&&e[i]!==t[i])return!1;return!0},c.boxEqual=function(e,t){if(!c.boxEqualFields(e,t))return!1;for(var i=0;i<c.DIFF_BOXES_PROP_NAMES.length;i++){var r=c.DIFF_BOXES_PROP_NAMES[i];if(e[r]&&t[r]&&!c.boxEqual(e[r],t[r]))return!1}return!0};var l=function(){};l.prototype.parseSample=function(e){var t,i,r=new n(e.buffer);t=[];while(!r.isEos())i=c.parseOneBox(r,!1),i.code===c.OK&&"vttc"===i.box.type&&t.push(i.box);return t},l.prototype.getText=function(e,t,i){function r(e,t,i){return i=i||"0",e+="",e.length>=t?e:new Array(t-e.length+1).join(i)+e}function n(e){var t=Math.floor(e/3600),i=Math.floor((e-3600*t)/60),n=Math.floor(e-3600*t-60*i),s=Math.floor(1e3*(e-3600*t-60*i-n));return r(t,2)+":"+r(i,2)+":"+r(n,2)+"."+r(s,3)}for(var s=this.parseSample(i),a="",o=0;o<s.length;o++){var u=s[o];a+=n(e)+" --\x3e "+n(t)+"\r\n",a+=u.payl.text}return a};var h=function(){};h.prototype.parseSample=function(e){var t,i={};i.resources=[];var r=new n(e.data.buffer);if(e.subsamples&&0!==e.subsamples.length){if(i.documentString=r.readString(e.subsamples[0].size),e.subsamples.length>1)for(t=1;t<e.subsamples.length;t++)i.resources[t]=r.readUint8Array(e.subsamples[t].size)}else i.documentString=r.readString(e.data.length);return"undefined"!==typeof DOMParser&&(i.document=(new DOMParser).parseFromString(i.documentString,"application/xml")),i};var f=function(){};f.prototype.parseSample=function(e){var t,i=new n(e.data.buffer);return t=i.readString(e.data.length),t},f.prototype.parseConfig=function(e){var t,i=new n(e.buffer);return i.readUint32(),t=i.readCString(),t},t.XMLSubtitlein4Parser=h,t.Textin4Parser=f;var d=function(e){this.stream=e||new o,this.boxes=[],this.mdats=[],this.moofs=[],this.isProgressive=!1,this.moovStartFound=!1,this.onMoovStart=null,this.moovStartSent=!1,this.onReady=null,this.readySent=!1,this.onSegment=null,this.onSamples=null,this.onError=null,this.sampleListBuilt=!1,this.fragmentedTracks=[],this.extractedTracks=[],this.isFragmentationInitialized=!1,this.sampleProcessingStarted=!1,this.nextMoofNumber=0,this.itemListBuilt=!1,this.onSidx=null,this.sidxSent=!1};d.prototype.setSegmentOptions=function(e,t,i){var r=this.getTrackById(e);if(r){var n={};this.fragmentedTracks.push(n),n.id=e,n.user=t,n.trak=r,r.nextSample=0,n.segmentStream=null,n.nb_samples=1e3,n.rapAlignement=!0,i&&(i.nbSamples&&(n.nb_samples=i.nbSamples),i.rapAlignement&&(n.rapAlignement=i.rapAlignement))}},d.prototype.unsetSegmentOptions=function(e){for(var t=-1,i=0;i<this.fragmentedTracks.length;i++){var r=this.fragmentedTracks[i];r.id==e&&(t=i)}t>-1&&this.fragmentedTracks.splice(t,1)},d.prototype.setExtractionOptions=function(e,t,i){var r=this.getTrackById(e);if(r){var n={};this.extractedTracks.push(n),n.id=e,n.user=t,n.trak=r,r.nextSample=0,n.nb_samples=1e3,n.samples=[],i&&i.nbSamples&&(n.nb_samples=i.nbSamples)}},d.prototype.unsetExtractionOptions=function(e){for(var t=-1,i=0;i<this.extractedTracks.length;i++){var r=this.extractedTracks[i];r.id==e&&(t=i)}t>-1&&this.extractedTracks.splice(t,1)},d.prototype.parse=function(){var e,t,i=!1;if(!this.restoreParsePosition||this.restoreParsePosition())while(1){if(this.hasIncompleteMdat&&this.hasIncompleteMdat()){if(this.processIncompleteMdat())continue;return}if(this.saveParsePosition&&this.saveParsePosition(),e=c.parseOneBox(this.stream,i),e.code===c.ERR_NOT_ENOUGH_DATA){if(this.processIncompleteBox){if(this.processIncompleteBox(e))continue;return}return}var n;switch(t=e.box,n="uuid"!==t.type?t.type:t.uuid,this.boxes.push(t),n){case"mdat":this.mdats.push(t);break;case"moof":this.moofs.push(t);break;case"moov":this.moovStartFound=!0,0===this.mdats.length&&(this.isProgressive=!0);default:void 0!==this[n]&&r.warn("ISOFile","Duplicate Box of type: "+n+", overriding previous occurrence"),this[n]=t;break}this.updateUsedBytes&&this.updateUsedBytes(t,e)}},d.prototype.checkBuffer=function(e){if(null===e||void 0===e)throw"Buffer must be defined and non empty";if(void 0===e.fileStart)throw"Buffer must have a fileStart property";return 0===e.byteLength?(r.warn("ISOFile","Ignoring empty buffer (fileStart: "+e.fileStart+")"),this.stream.logBufferLevel(),!1):(r.info("ISOFile","Processing buffer (fileStart: "+e.fileStart+")"),e.usedBytes=0,this.stream.insertBuffer(e),this.stream.logBufferLevel(),!!this.stream.initialized()||(r.warn("ISOFile","Not ready to start parsing"),!1))},d.prototype.appendBuffer=function(e,t){var i;if(this.checkBuffer(e))return this.parse(),this.moovStartFound&&!this.moovStartSent&&(this.moovStartSent=!0,this.onMoovStart&&this.onMoovStart()),this.moov?(this.sampleListBuilt||(this.buildSampleLists(),this.sampleListBuilt=!0),this.updateSampleLists(),this.onReady&&!this.readySent&&(this.readySent=!0,this.onReady(this.getInfo())),this.processSamples(t),this.nextSeekPosition?(i=this.nextSeekPosition,this.nextSeekPosition=void 0):i=this.nextParsePosition,this.stream.getEndFilePositionAfter&&(i=this.stream.getEndFilePositionAfter(i))):i=this.nextParsePosition?this.nextParsePosition:0,this.sidx&&this.onSidx&&!this.sidxSent&&(this.onSidx(this.sidx),this.sidxSent=!0),this.meta&&(this.flattenItemInfo&&!this.itemListBuilt&&(this.flattenItemInfo(),this.itemListBuilt=!0),this.processItems&&this.processItems(this.onItem)),this.stream.cleanBuffers&&(r.info("ISOFile","Done processing buffer (fileStart: "+e.fileStart+") - next buffer to fetch should have a fileStart position of "+i),this.stream.logBufferLevel(),this.stream.cleanBuffers(),this.stream.logBufferLevel(!0),r.info("ISOFile","Sample data size in memory: "+this.getAllocatedSampleDataSize())),i},d.prototype.getInfo=function(){var e,t,i,r,n,s={},a=new Date("1904-01-01T00:00:00Z").getTime();if(this.moov)for(s.hasMoov=!0,s.duration=this.moov.mvhd.duration,s.timescale=this.moov.mvhd.timescale,s.isFragmented=null!=this.moov.mvex,s.isFragmented&&this.moov.mvex.mehd&&(s.fragment_duration=this.moov.mvex.mehd.fragment_duration),s.isProgressive=this.isProgressive,s.hasIOD=null!=this.moov.iods,s.brands=[],s.brands.push(this.ftyp.major_brand),s.brands=s.brands.concat(this.ftyp.compatible_brands),s.created=new Date(a+1e3*this.moov.mvhd.creation_time),s.modified=new Date(a+1e3*this.moov.mvhd.modification_time),s.tracks=[],s.audioTracks=[],s.videoTracks=[],s.subtitleTracks=[],s.metadataTracks=[],s.hintTracks=[],s.otherTracks=[],e=0;e<this.moov.traks.length;e++){if(i=this.moov.traks[e],n=i.mdia.minf.stbl.stsd.entries[0],r={},s.tracks.push(r),r.id=i.tkhd.track_id,r.name=i.mdia.hdlr.name,r.references=[],i.tref)for(t=0;t<i.tref.boxes.length;t++)ref={},r.references.push(ref),ref.type=i.tref.boxes[t].type,ref.track_ids=i.tref.boxes[t].track_ids;i.edts&&(r.edits=i.edts.elst.entries),r.created=new Date(a+1e3*i.tkhd.creation_time),r.modified=new Date(a+1e3*i.tkhd.modification_time),r.movie_duration=i.tkhd.duration,r.movie_timescale=s.timescale,r.layer=i.tkhd.layer,r.alternate_group=i.tkhd.alternate_group,r.volume=i.tkhd.volume,r.matrix=i.tkhd.matrix,r.track_width=i.tkhd.width/65536,r.track_height=i.tkhd.height/65536,r.timescale=i.mdia.mdhd.timescale,r.cts_shift=i.mdia.minf.stbl.cslg,r.duration=i.mdia.mdhd.duration,r.samples_duration=i.samples_duration,r.codec=n.getCodec(),r.kind=i.udta&&i.udta.kinds.length?i.udta.kinds[0]:{schemeURI:"",value:""},r.language=i.mdia.elng?i.mdia.elng.extended_language:i.mdia.mdhd.languageString,r.nb_samples=i.samples.length,r.size=i.samples_size,r.bitrate=8*r.size*r.timescale/r.samples_duration,n.isAudio()?(r.type="audio",s.audioTracks.push(r),r.audio={},r.audio.sample_rate=n.getSampleRate(),r.audio.channel_count=n.getChannelCount(),r.audio.sample_size=n.getSampleSize()):n.isVideo()?(r.type="video",s.videoTracks.push(r),r.video={},r.video.width=n.getWidth(),r.video.height=n.getHeight()):n.isSubtitle()?(r.type="subtitles",s.subtitleTracks.push(r)):n.isHint()?(r.type="metadata",s.hintTracks.push(r)):n.isMetadata()?(r.type="metadata",s.metadataTracks.push(r)):(r.type="metadata",s.otherTracks.push(r))}else s.hasMoov=!1;if(s.mime="",s.hasMoov&&s.tracks){for(s.videoTracks&&s.videoTracks.length>0?s.mime+='video/mp4; codecs="':s.audioTracks&&s.audioTracks.length>0?s.mime+='audio/mp4; codecs="':s.mime+='application/mp4; codecs="',e=0;e<s.tracks.length;e++)0!==e&&(s.mime+=","),s.mime+=s.tracks[e].codec;s.mime+='"; profiles="',s.mime+=this.ftyp.compatible_brands.join(),s.mime+='"'}return s},d.prototype.processSamples=function(e){var t,i;if(this.sampleProcessingStarted){if(this.isFragmentationInitialized&&null!==this.onSegment)for(t=0;t<this.fragmentedTracks.length;t++){var n=this.fragmentedTracks[t];i=n.trak;while(i.nextSample<i.samples.length&&this.sampleProcessingStarted){r.debug("ISOFile","Creating media fragment on track #"+n.id+" for sample "+i.nextSample);var s=this.createFragment(n.id,i.nextSample,n.segmentStream);if(!s)break;if(n.segmentStream=s,i.nextSample++,(i.nextSample%n.nb_samples===0||e||i.nextSample>=i.samples.length)&&(r.info("ISOFile","Sending fragmented data on track #"+n.id+" for samples ["+Math.max(0,i.nextSample-n.nb_samples)+","+(i.nextSample-1)+"]"),r.info("ISOFile","Sample data size in memory: "+this.getAllocatedSampleDataSize()),this.onSegment&&this.onSegment(n.id,n.user,n.segmentStream.buffer,i.nextSample,e||i.nextSample>=i.samples.length),n.segmentStream=null,n!==this.fragmentedTracks[t]))break}}if(null!==this.onSamples)for(t=0;t<this.extractedTracks.length;t++){var a=this.extractedTracks[t];i=a.trak;while(i.nextSample<i.samples.length&&this.sampleProcessingStarted){r.debug("ISOFile","Exporting on track #"+a.id+" sample #"+i.nextSample);var o=this.getSample(i,i.nextSample);if(!o)break;if(i.nextSample++,a.samples.push(o),(i.nextSample%a.nb_samples===0||i.nextSample>=i.samples.length)&&(r.debug("ISOFile","Sending samples on track #"+a.id+" for sample "+i.nextSample),this.onSamples&&this.onSamples(a.id,a.user,a.samples),a.samples=[],a!==this.extractedTracks[t]))break}}}},d.prototype.getBox=function(e){var t=this.getBoxes(e,!0);return t.length?t[0]:null},d.prototype.getBoxes=function(e,t){var i=[];return d._sweep.call(this,e,i,t),i},d._sweep=function(e,t,i){for(var r in this.type&&this.type==e&&t.push(this),this.boxes){if(t.length&&i)return;d._sweep.call(this.boxes[r],e,t,i)}},d.prototype.getTrackSamplesInfo=function(e){var t=this.getTrackById(e);return t?t.samples:void 0},d.prototype.getTrackSample=function(e,t){var i=this.getTrackById(e),r=this.getSample(i,t);return r},d.prototype.releaseUsedSamples=function(e,t){var i=0,n=this.getTrackById(e);n.lastValidSample||(n.lastValidSample=0);for(var s=n.lastValidSample;s<t;s++)i+=this.releaseSample(n,s);r.info("ISOFile","Track #"+e+" released samples up to "+t+" (released size: "+i+", remaining: "+this.samplesDataSize+")"),n.lastValidSample=t},d.prototype.start=function(){this.sampleProcessingStarted=!0,this.processSamples(!1)},d.prototype.stop=function(){this.sampleProcessingStarted=!1},d.prototype.flush=function(){r.info("ISOFile","Flushing remaining samples"),this.updateSampleLists(),this.processSamples(!0),this.stream.cleanBuffers(),this.stream.logBufferLevel(!0)},d.prototype.seekTrack=function(e,t,i){var n,s,a,o=1/0,u=0,c=0;if(0===i.samples.length)return r.info("ISOFile","No sample in track, cannot seek! Using time "+r.getDurationString(0,1)+" and offset: 0"),{offset:0,time:0};for(n=0;n<i.samples.length;n++){if(s=i.samples[n],0===n)c=0,a=s.timescale;else if(s.cts>e*s.timescale){c=n-1;break}t&&s.is_sync&&(u=n)}t&&(c=u),e=i.samples[c].cts,i.nextSample=c;while(i.samples[c].alreadyRead===i.samples[c].size){if(!i.samples[c+1])break;c++}return o=i.samples[c].offset+i.samples[c].alreadyRead,r.info("ISOFile","Seeking to "+(t?"RAP":"")+" sample #"+i.nextSample+" on track "+i.tkhd.track_id+", time "+r.getDurationString(e,a)+" and offset: "+o),{offset:o,time:e/a}},d.prototype.seek=function(e,t){var i,n,s,a=this.moov,o={offset:1/0,time:1/0};if(this.moov){for(s=0;s<a.traks.length;s++)i=a.traks[s],n=this.seekTrack(e,t,i),n.offset<o.offset&&(o.offset=n.offset),n.time<o.time&&(o.time=n.time);return r.info("ISOFile","Seeking at time "+r.getDurationString(o.time,1)+" needs a buffer with a fileStart position of "+o.offset),o.offset===1/0?o={offset:this.nextParsePosition,time:0}:o.offset=this.stream.getEndFilePositionAfter(o.offset),r.info("ISOFile","Adjusted seek position (after checking data already in buffer): "+o.offset),o}throw"Cannot seek: moov not received!"},d.prototype.equal=function(e){var t=0;while(t<this.boxes.length&&t<e.boxes.length){var i=this.boxes[t],r=e.boxes[t];if(!c.boxEqual(i,r))return!1;t++}return!0},t.ISOFile=d,d.prototype.lastBoxStartPosition=0,d.prototype.parsingMdat=null,d.prototype.nextParsePosition=0,d.prototype.discardMdatData=!1,d.prototype.processIncompleteBox=function(e){var t,i,r;return"mdat"===e.type?(t=new c[e.type+"Box"](e.size),this.parsingMdat=t,this.boxes.push(t),this.mdats.push(t),t.start=e.start,t.hdr_size=e.hdr_size,this.stream.addUsedBytes(t.hdr_size),this.lastBoxStartPosition=t.start+t.size,r=this.stream.seek(t.start+t.size,!1,this.discardMdatData),r?(this.parsingMdat=null,!0):(this.moovStartFound?this.nextParsePosition=this.stream.findEndContiguousBuf():this.nextParsePosition=t.start+t.size,!1)):("moov"===e.type&&(this.moovStartFound=!0,0===this.mdats.length&&(this.isProgressive=!0)),i=!!this.stream.mergeNextBuffer&&this.stream.mergeNextBuffer(),i?(this.nextParsePosition=this.stream.getEndPosition(),!0):(e.type?this.moovStartFound?this.nextParsePosition=this.stream.getEndPosition():this.nextParsePosition=this.stream.getPosition()+e.size:this.nextParsePosition=this.stream.getEndPosition(),!1))},d.prototype.hasIncompleteMdat=function(){return null!==this.parsingMdat},d.prototype.processIncompleteMdat=function(){var e,t;return e=this.parsingMdat,t=this.stream.seek(e.start+e.size,!1,this.discardMdatData),t?(r.debug("ISOFile","Found 'mdat' end in buffered data"),this.parsingMdat=null,!0):(this.nextParsePosition=this.stream.findEndContiguousBuf(),!1)},d.prototype.restoreParsePosition=function(){return this.stream.seek(this.lastBoxStartPosition,!0,this.discardMdatData)},d.prototype.saveParsePosition=function(){this.lastBoxStartPosition=this.stream.getPosition()},d.prototype.updateUsedBytes=function(e,t){this.stream.addUsedBytes&&("mdat"===e.type?(this.stream.addUsedBytes(e.hdr_size),this.discardMdatData&&this.stream.addUsedBytes(e.size-e.hdr_size)):this.stream.addUsedBytes(e.size))},d.prototype.add=c.Box.prototype.add,d.prototype.addBox=c.Box.prototype.addBox,d.prototype.init=function(e){var t=e||{},i=(this.add("ftyp").set("major_brand",t.brands&&t.brands[0]||"iso4").set("minor_version",0).set("compatible_brands",t.brands||["iso4"]),this.add("moov"));return i.add("mvhd").set("timescale",t.timescale||600).set("rate",t.rate||65536).set("creation_time",0).set("modification_time",0).set("duration",t.duration||0).set("volume",t.width?0:256).set("matrix",[65536,0,0,0,65536,0,0,0,1073741824]).set("next_track_id",1),i.add("mvex"),this},d.prototype.addTrack=function(e){this.moov||this.init(e);var t=e||{};t.width=t.width||320,t.height=t.height||320,t.id=t.id||this.moov.mvhd.next_track_id,t.type=t.type||"avc1";var i=this.moov.add("trak");this.moov.mvhd.next_track_id=t.id+1,i.add("tkhd").set("flags",c.TKHD_FLAG_ENABLED|c.TKHD_FLAG_IN_MOVIE|c.TKHD_FLAG_IN_PREVIEW).set("creation_time",0).set("modification_time",0).set("track_id",t.id).set("duration",t.duration||0).set("layer",t.layer||0).set("alternate_group",0).set("volume",1).set("matrix",[0,0,0,0,0,0,0,0,0]).set("width",t.width).set("height",t.height);var r=i.add("mdia");r.add("mdhd").set("creation_time",0).set("modification_time",0).set("timescale",t.timescale||1).set("duration",t.media_duration||0).set("language",t.language||"und"),r.add("hdlr").set("handler",t.hdlr||"vide").set("name",t.name||"Track created with MP4Box.js"),r.add("elng").set("extended_language",t.language||"fr-FR");var s=r.add("minf");if(void 0!==c[t.type+"SampleEntry"]){var a=new c[t.type+"SampleEntry"];a.data_reference_index=1;var o="";for(var u in c.sampleEntryCodes)for(var l=c.sampleEntryCodes[u],h=0;h<l.length;h++)if(l.indexOf(t.type)>-1){o=u;break}switch(o){case"Visual":if(s.add("vmhd").set("graphicsmode",0).set("opcolor",[0,0,0]),a.set("width",t.width).set("height",t.height).set("horizresolution",72<<16).set("vertresolution",72<<16).set("frame_count",1).set("compressorname",t.type+" Compressor").set("depth",24),t.avcDecoderConfigRecord){var f=new c.avcCBox,d=new n(t.avcDecoderConfigRecord);f.parse(d),a.addBox(f)}break;case"Audio":s.add("smhd").set("balance",t.balance||0),a.set("channel_count",t.channel_count||2).set("samplesize",t.samplesize||16).set("samplerate",t.samplerate||65536);break;case"Hint":s.add("hmhd");break;case"Subtitle":switch(s.add("sthd"),t.type){case"stpp":a.set("namespace",t.namespace||"nonamespace").set("schema_location",t.schema_location||"").set("auxiliary_mime_types",t.auxiliary_mime_types||"");break}break;case"Metadata":s.add("nmhd");break;case"System":s.add("nmhd");break;default:s.add("nmhd");break}t.description&&a.addBox(t.description),t.description_boxes&&t.description_boxes.forEach((function(e){a.addBox(e)})),s.add("dinf").add("dref").addEntry((new c["url Box"]).set("flags",1));var p=s.add("stbl");return p.add("stsd").addEntry(a),p.add("stts").set("sample_counts",[]).set("sample_deltas",[]),p.add("stsc").set("first_chunk",[]).set("samples_per_chunk",[]).set("sample_description_index",[]),p.add("stco").set("chunk_offsets",[]),p.add("stsz").set("sample_sizes",[]),this.moov.mvex.add("trex").set("track_id",t.id).set("default_sample_description_index",t.default_sample_description_index||1).set("default_sample_duration",t.default_sample_duration||0).set("default_sample_size",t.default_sample_size||0).set("default_sample_flags",t.default_sample_flags||0),this.buildTrakSampleLists(i),t.id}},c.Box.prototype.computeSize=function(e){var t=e||new s;t.endianness=s.BIG_ENDIAN,this.write(t)},d.prototype.addSample=function(e,t,i){var r=i||{},n={},s=this.getTrackById(e);if(null!==s){n.number=s.samples.length,n.track_id=s.tkhd.track_id,n.timescale=s.mdia.mdhd.timescale,n.description_index=r.sample_description_index?r.sample_description_index-1:0,n.description=s.mdia.minf.stbl.stsd.entries[n.description_index],n.data=t,n.size=t.byteLength,n.alreadyRead=n.size,n.duration=r.duration||1,n.cts=r.cts||0,n.dts=r.dts||0,n.is_sync=r.is_sync||!1,n.is_leading=r.is_leading||0,n.depends_on=r.depends_on||0,n.is_depended_on=r.is_depended_on||0,n.has_redundancy=r.has_redundancy||0,n.degradation_priority=r.degradation_priority||0,n.offset=0,n.subsamples=r.subsamples,s.samples.push(n),s.samples_size+=n.size,s.samples_duration+=n.duration,s.first_dts||(s.first_dts=r.dts),this.processSamples();var a=this.createSingleSampleMoof(n);return this.addBox(a),a.computeSize(),a.trafs[0].truns[0].data_offset=a.size+8,this.add("mdat").data=new Uint8Array(t),n}},d.prototype.createSingleSampleMoof=function(e){var t=0;t=e.is_sync?1<<25:65536;var i=new c.moofBox;i.add("mfhd").set("sequence_number",this.nextMoofNumber),this.nextMoofNumber++;var r=i.add("traf"),n=this.getTrackById(e.track_id);return r.add("tfhd").set("track_id",e.track_id).set("flags",c.TFHD_FLAG_DEFAULT_BASE_IS_MOOF),r.add("tfdt").set("baseMediaDecodeTime",e.dts-n.first_dts),r.add("trun").set("flags",c.TRUN_FLAGS_DATA_OFFSET|c.TRUN_FLAGS_DURATION|c.TRUN_FLAGS_SIZE|c.TRUN_FLAGS_FLAGS|c.TRUN_FLAGS_CTS_OFFSET).set("data_offset",0).set("first_sample_flags",0).set("sample_count",1).set("sample_duration",[e.duration]).set("sample_size",[e.size]).set("sample_flags",[t]).set("sample_composition_time_offset",[e.cts-e.dts]),i},d.prototype.lastMoofIndex=0,d.prototype.samplesDataSize=0,d.prototype.resetTables=function(){var e,t,i,r,n,s,a,o;for(this.initial_duration=this.moov.mvhd.duration,this.moov.mvhd.duration=0,e=0;e<this.moov.traks.length;e++){t=this.moov.traks[e],t.tkhd.duration=0,t.mdia.mdhd.duration=0,i=t.mdia.minf.stbl.stco||t.mdia.minf.stbl.co64,i.chunk_offsets=[],r=t.mdia.minf.stbl.stsc,r.first_chunk=[],r.samples_per_chunk=[],r.sample_description_index=[],n=t.mdia.minf.stbl.stsz||t.mdia.minf.stbl.stz2,n.sample_sizes=[],s=t.mdia.minf.stbl.stts,s.sample_counts=[],s.sample_deltas=[],a=t.mdia.minf.stbl.ctts,a&&(a.sample_counts=[],a.sample_offsets=[]),o=t.mdia.minf.stbl.stss;var u=t.mdia.minf.stbl.boxes.indexOf(o);-1!=u&&(t.mdia.minf.stbl.boxes[u]=null)}},d.initSampleGroups=function(e,t,i,r,n){var s,a,o,u;function c(e,t,i){this.grouping_type=e,this.grouping_type_parameter=t,this.sbgp=i,this.last_sample_in_run=-1,this.entry_index=-1}for(t&&(t.sample_groups_info=[]),e.sample_groups_info||(e.sample_groups_info=[]),a=0;a<i.length;a++){for(u=i[a].grouping_type+"/"+i[a].grouping_type_parameter,o=new c(i[a].grouping_type,i[a].grouping_type_parameter,i[a]),t&&(t.sample_groups_info[u]=o),e.sample_groups_info[u]||(e.sample_groups_info[u]=o),s=0;s<r.length;s++)r[s].grouping_type===i[a].grouping_type&&(o.description=r[s],o.description.used=!0);if(n)for(s=0;s<n.length;s++)n[s].grouping_type===i[a].grouping_type&&(o.fragment_description=n[s],o.fragment_description.used=!0,o.is_fragment=!0)}if(t){if(n)for(a=0;a<n.length;a++)!n[a].used&&n[a].version>=2&&(u=n[a].grouping_type+"/0",o=new c(n[a].grouping_type,0),o.is_fragment=!0,t.sample_groups_info[u]||(t.sample_groups_info[u]=o))}else for(a=0;a<r.length;a++)!r[a].used&&r[a].version>=2&&(u=r[a].grouping_type+"/0",o=new c(r[a].grouping_type,0),e.sample_groups_info[u]||(e.sample_groups_info[u]=o))},d.setSampleGroupProperties=function(e,t,i,r){var n,s;for(n in t.sample_groups=[],r){var a;if(t.sample_groups[n]={},t.sample_groups[n].grouping_type=r[n].grouping_type,t.sample_groups[n].grouping_type_parameter=r[n].grouping_type_parameter,i>=r[n].last_sample_in_run&&(r[n].last_sample_in_run<0&&(r[n].last_sample_in_run=0),r[n].entry_index++,r[n].entry_index<=r[n].sbgp.entries.length-1&&(r[n].last_sample_in_run+=r[n].sbgp.entries[r[n].entry_index].sample_count)),r[n].entry_index<=r[n].sbgp.entries.length-1?t.sample_groups[n].group_description_index=r[n].sbgp.entries[r[n].entry_index].group_description_index:t.sample_groups[n].group_description_index=-1,0!==t.sample_groups[n].group_description_index)a=r[n].fragment_description?r[n].fragment_description:r[n].description,t.sample_groups[n].group_description_index>0?(s=t.sample_groups[n].group_description_index>65535?(t.sample_groups[n].group_description_index>>16)-1:t.sample_groups[n].group_description_index-1,a&&s>=0&&(t.sample_groups[n].description=a.entries[s])):a&&a.version>=2&&a.default_group_description_index>0&&(t.sample_groups[n].description=a.entries[a.default_group_description_index-1])}},d.process_sdtp=function(e,t,i){t&&(e?(t.is_leading=e.is_leading[i],t.depends_on=e.sample_depends_on[i],t.is_depended_on=e.sample_is_depended_on[i],t.has_redundancy=e.sample_has_redundancy[i]):(t.is_leading=0,t.depends_on=0,t.is_depended_on=0,t.has_redundancy=0))},d.prototype.buildSampleLists=function(){var e,t;for(e=0;e<this.moov.traks.length;e++)t=this.moov.traks[e],this.buildTrakSampleLists(t)},d.prototype.buildTrakSampleLists=function(e){var t,i,r,n,s,a,o,u,c,l,h,f,p,m,g,_,y,v,b,x,w,S,U,k;if(e.samples=[],e.samples_duration=0,e.samples_size=0,i=e.mdia.minf.stbl.stco||e.mdia.minf.stbl.co64,r=e.mdia.minf.stbl.stsc,n=e.mdia.minf.stbl.stsz||e.mdia.minf.stbl.stz2,s=e.mdia.minf.stbl.stts,a=e.mdia.minf.stbl.ctts,o=e.mdia.minf.stbl.stss,u=e.mdia.minf.stbl.stsd,c=e.mdia.minf.stbl.subs,f=e.mdia.minf.stbl.stdp,l=e.mdia.minf.stbl.sbgps,h=e.mdia.minf.stbl.sgpds,v=-1,b=-1,x=-1,w=-1,S=0,U=0,k=0,d.initSampleGroups(e,null,l,h),"undefined"!==typeof n){for(t=0;t<n.sample_sizes.length;t++){var E={};E.number=t,E.track_id=e.tkhd.track_id,E.timescale=e.mdia.mdhd.timescale,E.alreadyRead=0,e.samples[t]=E,E.size=n.sample_sizes[t],e.samples_size+=E.size,0===t?(m=1,p=0,E.chunk_index=m,E.chunk_run_index=p,y=r.samples_per_chunk[p],_=0,g=p+1<r.first_chunk.length?r.first_chunk[p+1]-1:1/0):t<y?(E.chunk_index=m,E.chunk_run_index=p):(m++,E.chunk_index=m,_=0,m<=g||(p++,g=p+1<r.first_chunk.length?r.first_chunk[p+1]-1:1/0),E.chunk_run_index=p,y+=r.samples_per_chunk[p]),E.description_index=r.sample_description_index[E.chunk_run_index]-1,E.description=u.entries[E.description_index],E.offset=i.chunk_offsets[E.chunk_index-1]+_,_+=E.size,t>v&&(b++,v<0&&(v=0),v+=s.sample_counts[b]),t>0?(e.samples[t-1].duration=s.sample_deltas[b],e.samples_duration+=e.samples[t-1].duration,E.dts=e.samples[t-1].dts+e.samples[t-1].duration):E.dts=0,a?(t>=x&&(w++,x<0&&(x=0),x+=a.sample_counts[w]),E.cts=e.samples[t].dts+a.sample_offsets[w]):E.cts=E.dts,o?(t==o.sample_numbers[S]-1?(E.is_sync=!0,S++):(E.is_sync=!1,E.degradation_priority=0),c&&c.entries[U].sample_delta+k==t+1&&(E.subsamples=c.entries[U].subsamples,k+=c.entries[U].sample_delta,U++)):E.is_sync=!0,d.process_sdtp(e.mdia.minf.stbl.sdtp,E,E.number),E.degradation_priority=f?f.priority[t]:0,c&&c.entries[U].sample_delta+k==t&&(E.subsamples=c.entries[U].subsamples,k+=c.entries[U].sample_delta),(l.length>0||h.length>0)&&d.setSampleGroupProperties(e,E,t,e.sample_groups_info)}t>0&&(e.samples[t-1].duration=Math.max(e.mdia.mdhd.duration-e.samples[t-1].dts,0),e.samples_duration+=e.samples[t-1].duration)}},d.prototype.updateSampleLists=function(){var e,t,i,r,n,s,a,o,u,l,h,f,p,m,g;if(void 0!==this.moov)while(this.lastMoofIndex<this.moofs.length)if(u=this.moofs[this.lastMoofIndex],this.lastMoofIndex++,"moof"==u.type)for(l=u,e=0;e<l.trafs.length;e++){for(h=l.trafs[e],f=this.getTrackById(h.tfhd.track_id),p=this.getTrexById(h.tfhd.track_id),r=h.tfhd.flags&c.TFHD_FLAG_SAMPLE_DESC?h.tfhd.default_sample_description_index:p?p.default_sample_description_index:1,n=h.tfhd.flags&c.TFHD_FLAG_SAMPLE_DUR?h.tfhd.default_sample_duration:p?p.default_sample_duration:0,s=h.tfhd.flags&c.TFHD_FLAG_SAMPLE_SIZE?h.tfhd.default_sample_size:p?p.default_sample_size:0,a=h.tfhd.flags&c.TFHD_FLAG_SAMPLE_FLAGS?h.tfhd.default_sample_flags:p?p.default_sample_flags:0,h.sample_number=0,h.sbgps.length>0&&d.initSampleGroups(f,h,h.sbgps,f.mdia.minf.stbl.sgpds,h.sgpds),t=0;t<h.truns.length;t++){var _=h.truns[t];for(i=0;i<_.sample_count;i++){m={},m.moof_number=this.lastMoofIndex,m.number_in_traf=h.sample_number,h.sample_number++,m.number=f.samples.length,h.first_sample_index=f.samples.length,f.samples.push(m),m.track_id=f.tkhd.track_id,m.timescale=f.mdia.mdhd.timescale,m.description_index=r-1,m.description=f.mdia.minf.stbl.stsd.entries[m.description_index],m.size=s,_.flags&c.TRUN_FLAGS_SIZE&&(m.size=_.sample_size[i]),f.samples_size+=m.size,m.duration=n,_.flags&c.TRUN_FLAGS_DURATION&&(m.duration=_.sample_duration[i]),f.samples_duration+=m.duration,f.first_traf_merged||i>0?m.dts=f.samples[f.samples.length-2].dts+f.samples[f.samples.length-2].duration:(h.tfdt?m.dts=h.tfdt.baseMediaDecodeTime:m.dts=0,f.first_traf_merged=!0),m.cts=m.dts,_.flags&c.TRUN_FLAGS_CTS_OFFSET&&(m.cts=m.dts+_.sample_composition_time_offset[i]),g=a,_.flags&c.TRUN_FLAGS_FLAGS?g=_.sample_flags[i]:0===i&&_.flags&c.TRUN_FLAGS_FIRST_FLAG&&(g=_.first_sample_flags),m.is_sync=!(g>>16&1),m.is_leading=g>>26&3,m.depends_on=g>>24&3,m.is_depended_on=g>>22&3,m.has_redundancy=g>>20&3,m.degradation_priority=65535&g;var y=!!(h.tfhd.flags&c.TFHD_FLAG_BASE_DATA_OFFSET),v=!!(h.tfhd.flags&c.TFHD_FLAG_DEFAULT_BASE_IS_MOOF),b=!!(_.flags&c.TRUN_FLAGS_DATA_OFFSET),x=0;x=y?h.tfhd.base_data_offset:v||0===t?l.start:o,m.offset=0===t&&0===i?b?x+_.data_offset:x:o,o=m.offset+m.size,(h.sbgps.length>0||h.sgpds.length>0||f.mdia.minf.stbl.sbgps.length>0||f.mdia.minf.stbl.sgpds.length>0)&&d.setSampleGroupProperties(f,m,m.number_in_traf,h.sample_groups_info)}}if(h.subs){f.has_fragment_subsamples=!0;var w=h.first_sample_index;for(t=0;t<h.subs.entries.length;t++)w+=h.subs.entries[t].sample_delta,m=f.samples[w-1],m.subsamples=h.subs.entries[t].subsamples}}},d.prototype.getSample=function(e,t){var i,n=e.samples[t];if(!this.moov)return null;if(n.data){if(n.alreadyRead==n.size)return n}else n.data=new Uint8Array(n.size),n.alreadyRead=0,this.samplesDataSize+=n.size,r.debug("ISOFile","Allocating sample #"+t+" on track #"+e.tkhd.track_id+" of size "+n.size+" (total: "+this.samplesDataSize+")");while(1){var a=this.stream.findPosition(!0,n.offset+n.alreadyRead,!1);if(!(a>-1))return null;i=this.stream.buffers[a];var o=i.byteLength-(n.offset+n.alreadyRead-i.fileStart);if(n.size-n.alreadyRead<=o)return r.debug("ISOFile","Getting sample #"+t+" data (alreadyRead: "+n.alreadyRead+" offset: "+(n.offset+n.alreadyRead-i.fileStart)+" read size: "+(n.size-n.alreadyRead)+" full size: "+n.size+")"),s.memcpy(n.data.buffer,n.alreadyRead,i,n.offset+n.alreadyRead-i.fileStart,n.size-n.alreadyRead),i.usedBytes+=n.size-n.alreadyRead,this.stream.logBufferLevel(),n.alreadyRead=n.size,n;if(0===o)return null;r.debug("ISOFile","Getting sample #"+t+" partial data (alreadyRead: "+n.alreadyRead+" offset: "+(n.offset+n.alreadyRead-i.fileStart)+" read size: "+o+" full size: "+n.size+")"),s.memcpy(n.data.buffer,n.alreadyRead,i,n.offset+n.alreadyRead-i.fileStart,o),n.alreadyRead+=o,i.usedBytes+=o,this.stream.logBufferLevel()}},d.prototype.releaseSample=function(e,t){var i=e.samples[t];return i.data?(this.samplesDataSize-=i.size,i.data=null,i.alreadyRead=0,i.size):0},d.prototype.getAllocatedSampleDataSize=function(){return this.samplesDataSize},d.prototype.getCodecs=function(){var e,t="";for(e=0;e<this.moov.traks.length;e++){var i=this.moov.traks[e];e>0&&(t+=","),t+=i.mdia.minf.stbl.stsd.entries[0].getCodec()}return t},d.prototype.getTrexById=function(e){var t;if(!this.moov||!this.moov.mvex)return null;for(t=0;t<this.moov.mvex.trexs.length;t++){var i=this.moov.mvex.trexs[t];if(i.track_id==e)return i}return null},d.prototype.getTrackById=function(e){if(void 0===this.moov)return null;for(var t=0;t<this.moov.traks.length;t++){var i=this.moov.traks[t];if(i.tkhd.track_id==e)return i}return null},d.prototype.items=[],d.prototype.itemsDataSize=0,d.prototype.flattenItemInfo=function(){var e,t,i,n=this.items,s=this.meta;if(null!==s&&void 0!==s&&void 0!==s.hdlr&&void 0!==s.iinf){for(e=0;e<s.iinf.item_infos.length;e++)i={},i.id=s.iinf.item_infos[e].item_ID,n[i.id]=i,i.ref_to=[],i.name=s.iinf.item_infos[e].item_name,s.iinf.item_infos[e].protection_index>0&&(i.protection=s.ipro.protections[s.iinf.item_infos[e].protection_index-1]),s.iinf.item_infos[e].item_type?i.type=s.iinf.item_infos[e].item_type:i.type="mime",i.content_type=s.iinf.item_infos[e].content_type,i.content_encoding=s.iinf.item_infos[e].content_encoding;if(s.iloc)for(e=0;e<s.iloc.items.length;e++){var a=s.iloc.items[e];switch(i=n[a.item_ID],0!==a.data_reference_index&&(r.warn("Item storage with reference to other files: not supported"),i.source=s.dinf.boxes[a.data_reference_index-1]),a.construction_method){case 0:break;case 1:r.warn("Item storage with construction_method : not supported");break;case 2:r.warn("Item storage with construction_method : not supported");break}for(i.extents=[],i.size=0,t=0;t<a.extents.length;t++)i.extents[t]={},i.extents[t].offset=a.extents[t].extent_offset+a.base_offset,i.extents[t].length=a.extents[t].extent_length,i.extents[t].alreadyRead=0,i.size+=i.extents[t].length}if(s.pitm&&(n[s.pitm.item_id].primary=!0),s.iref)for(e=0;e<s.iref.references.length;e++){var o=s.iref.references[e];for(t=0;t<o.references.length;t++)n[o.from_item_ID].ref_to.push({type:o.type,id:o.references[t]})}if(s.iprp)for(var u=0;u<s.iprp.ipmas.length;u++){var c=s.iprp.ipmas[u];for(e=0;e<c.associations.length;e++){var l=c.associations[e];for(i=n[l.id],void 0===i.properties&&(i.properties={},i.properties.boxes=[]),t=0;t<l.props.length;t++){var h=l.props[t];if(h.property_index>0&&h.property_index-1<s.iprp.ipco.boxes.length){var f=s.iprp.ipco.boxes[h.property_index-1];i.properties[f.type]=f,i.properties.boxes.push(f)}}}}}},d.prototype.getItem=function(e){var t,i;if(!this.meta)return null;if(i=this.items[e],!i.data&&i.size)i.data=new Uint8Array(i.size),i.alreadyRead=0,this.itemsDataSize+=i.size,r.debug("ISOFile","Allocating item #"+e+" of size "+i.size+" (total: "+this.itemsDataSize+")");else if(i.alreadyRead===i.size)return i;for(var n=0;n<i.extents.length;n++){var a=i.extents[n];if(a.alreadyRead!==a.length){var o=this.stream.findPosition(!0,a.offset+a.alreadyRead,!1);if(!(o>-1))return null;t=this.stream.buffers[o];var u=t.byteLength-(a.offset+a.alreadyRead-t.fileStart);if(!(a.length-a.alreadyRead<=u))return r.debug("ISOFile","Getting item #"+e+" extent #"+n+" partial data (alreadyRead: "+a.alreadyRead+" offset: "+(a.offset+a.alreadyRead-t.fileStart)+" read size: "+u+" full extent size: "+a.length+" full item size: "+i.size+")"),s.memcpy(i.data.buffer,i.alreadyRead,t,a.offset+a.alreadyRead-t.fileStart,u),a.alreadyRead+=u,i.alreadyRead+=u,t.usedBytes+=u,this.stream.logBufferLevel(),null;r.debug("ISOFile","Getting item #"+e+" extent #"+n+" data (alreadyRead: "+a.alreadyRead+" offset: "+(a.offset+a.alreadyRead-t.fileStart)+" read size: "+(a.length-a.alreadyRead)+" full extent size: "+a.length+" full item size: "+i.size+")"),s.memcpy(i.data.buffer,i.alreadyRead,t,a.offset+a.alreadyRead-t.fileStart,a.length-a.alreadyRead),t.usedBytes+=a.length-a.alreadyRead,this.stream.logBufferLevel(),i.alreadyRead+=a.length-a.alreadyRead,a.alreadyRead=a.length}}return i.alreadyRead===i.size?i:null},d.prototype.releaseItem=function(e){var t=this.items[e];if(t.data){this.itemsDataSize-=t.size,t.data=null,t.alreadyRead=0;for(var i=0;i<t.extents.length;i++){var r=t.extents[i];r.alreadyRead=0}return t.size}return 0},d.prototype.processItems=function(e){for(var t in this.items){var i=this.items[t];this.getItem(i.id),e&&!i.sent&&(e(i),i.sent=!0,i.data=null)}},d.prototype.hasItem=function(e){for(var t in this.items){var i=this.items[t];if(i.name===e)return i.id}return-1},d.prototype.getMetaHandler=function(){return this.meta?this.meta.hdlr.handler:null},d.prototype.getPrimaryItem=function(){return this.meta&&this.meta.pitm?this.getItem(this.meta.pitm.item_id):null},d.prototype.itemToFragmentedTrackFile=function(e){var t=e||{},i=null;if(i=t.itemId?this.getItem(t.itemId):this.getPrimaryItem(),null==i)return null;var r=new d;r.discardMdatData=!1;var n={type:i.type,description_boxes:i.properties.boxes};i.properties.ispe&&(n.width=i.properties.ispe.image_width,n.height=i.properties.ispe.image_height);var s=r.addTrack(n);return s?(r.addSample(s,i.data),r):null},d.prototype.write=function(e){for(var t=0;t<this.boxes.length;t++)this.boxes[t].write(e)},d.prototype.createFragment=function(e,t,i){var n=this.getTrackById(e),a=this.getSample(n,t);if(null==a)return a=n.samples[t],this.nextSeekPosition?this.nextSeekPosition=Math.min(a.offset+a.alreadyRead,this.nextSeekPosition):this.nextSeekPosition=n.samples[t].offset+a.alreadyRead,null;var o=i||new s;o.endianness=s.BIG_ENDIAN;var u=this.createSingleSampleMoof(a);u.write(o),u.trafs[0].truns[0].data_offset=u.size+8,r.debug("MP4Box","Adjusting data_offset with new value "+u.trafs[0].truns[0].data_offset),o.adjustUint32(u.trafs[0].truns[0].data_offset_position,u.trafs[0].truns[0].data_offset);var l=new c.mdatBox;return l.data=a.data,l.write(o),o},d.writeInitializationSegment=function(e,t,i,n){var a;r.debug("ISOFile","Generating initialization segment");var o=new s;o.endianness=s.BIG_ENDIAN,e.write(o);var u=t.add("mvex");for(i&&u.add("mehd").set("fragment_duration",i),a=0;a<t.traks.length;a++)u.add("trex").set("track_id",t.traks[a].tkhd.track_id).set("default_sample_description_index",1).set("default_sample_duration",n).set("default_sample_size",0).set("default_sample_flags",65536);return t.write(o),o.buffer},d.prototype.save=function(e){var t=new s;t.endianness=s.BIG_ENDIAN,this.write(t),t.save(e)},d.prototype.getBuffer=function(){var e=new s;return e.endianness=s.BIG_ENDIAN,this.write(e),e.buffer},d.prototype.initializeSegmentation=function(){var e,t,i,n;for(null===this.onSegment&&r.warn("MP4Box","No segmentation callback set!"),this.isFragmentationInitialized||(this.isFragmentationInitialized=!0,this.nextMoofNumber=0,this.resetTables()),t=[],e=0;e<this.fragmentedTracks.length;e++){var s=new c.moovBox;s.mvhd=this.moov.mvhd,s.boxes.push(s.mvhd),i=this.getTrackById(this.fragmentedTracks[e].id),s.boxes.push(i),s.traks.push(i),n={},n.id=i.tkhd.track_id,n.user=this.fragmentedTracks[e].user,n.buffer=d.writeInitializationSegment(this.ftyp,s,this.moov.mvex&&this.moov.mvex.mehd?this.moov.mvex.mehd.fragment_duration:void 0,this.moov.traks[e].samples.length>0?this.moov.traks[e].samples[0].duration:0),t.push(n)}return t},c.Box.prototype.printHeader=function(e){this.size+=8,this.size>a&&(this.size+=8),"uuid"===this.type&&(this.size+=16),e.log(e.indent+"size:"+this.size),e.log(e.indent+"type:"+this.type)},c.FullBox.prototype.printHeader=function(e){this.size+=4,c.Box.prototype.printHeader.call(this,e),e.log(e.indent+"version:"+this.version),e.log(e.indent+"flags:"+this.flags)},c.Box.prototype.print=function(e){this.printHeader(e)},c.ContainerBox.prototype.print=function(e){this.printHeader(e);for(var t=0;t<this.boxes.length;t++)if(this.boxes[t]){var i=e.indent;e.indent+=" ",this.boxes[t].print(e),e.indent=i}},d.prototype.print=function(e){e.indent="";for(var t=0;t<this.boxes.length;t++)this.boxes[t]&&this.boxes[t].print(e)},c.mvhdBox.prototype.print=function(e){c.FullBox.prototype.printHeader.call(this,e),e.log(e.indent+"creation_time: "+this.creation_time),e.log(e.indent+"modification_time: "+this.modification_time),e.log(e.indent+"timescale: "+this.timescale),e.log(e.indent+"duration: "+this.duration),e.log(e.indent+"rate: "+this.rate),e.log(e.indent+"volume: "+(this.volume>>8)),e.log(e.indent+"matrix: "+this.matrix.join(", ")),e.log(e.indent+"next_track_id: "+this.next_track_id)},c.tkhdBox.prototype.print=function(e){c.FullBox.prototype.printHeader.call(this,e),e.log(e.indent+"creation_time: "+this.creation_time),e.log(e.indent+"modification_time: "+this.modification_time),e.log(e.indent+"track_id: "+this.track_id),e.log(e.indent+"duration: "+this.duration),e.log(e.indent+"volume: "+(this.volume>>8)),e.log(e.indent+"matrix: "+this.matrix.join(", ")),e.log(e.indent+"layer: "+this.layer),e.log(e.indent+"alternate_group: "+this.alternate_group),e.log(e.indent+"width: "+this.width),e.log(e.indent+"height: "+this.height)};var p={createFile:function(e,t){var i=void 0===e||e,r=new d(t);return r.discardMdatData=!i,r}};t.createFile=p.createFile},ba82:function(e,t,i){"use strict";var r=i("f0b2"),n=i.n(r);n.a},baa5:function(e,t,i){var r=i("23e7"),n=i("e58c");r({target:"Array",proto:!0,forced:n!==[].lastIndexOf},{lastIndexOf:n})},bb2f:function(e,t,i){var r=i("d039");e.exports=!r((function(){return Object.isExtensible(Object.preventExtensions({}))}))},bee2:function(e,t,i){"use strict";function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function n(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=n},bf19:function(e,t,i){"use strict";var r=i("23e7");r({target:"URL",proto:!0,enumerable:!0},{toJSON:function(){return URL.prototype.toString.call(this)}})},ce56:function(e,t,i){"use strict";i.r(t);var r=i("9a3a"),n=i.n(r);for(var s in r)"default"!==s&&function(e){i.d(t,e,(function(){return r[e]}))}(s);t["default"]=n.a},cfc3:function(e,t,i){var r=i("74e8");r("Float32",(function(e){return function(t,i,r){return e(this,t,i,r)}}))},d4ec:function(e,t,i){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.default=r},d967:function(e,t,i){"use strict";function r(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}i("d3b7"),i("4ae1"),i("25f0"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=r},da1d:function(e,t,i){var r=i("24fb");t=r(!1),t.push([e.i,".uni-file-picker[data-v-373ea476]{\nbox-sizing:border-box;overflow:hidden\n}.uni-file-picker__header[data-v-373ea476]{padding-top:5px;padding-bottom:10px;\ndisplay:flex;\njustify-content:space-between}.file-title[data-v-373ea476]{font-size:14px;color:#333}.file-count[data-v-373ea476]{font-size:14px;color:#999}.is-add[data-v-373ea476]{\ndisplay:flex;\nalign-items:center;justify-content:center}.icon-add[data-v-373ea476]{width:50px;height:5px;background-color:#f1f1f1;border-radius:2px}.rotate[data-v-373ea476]{position:absolute;-webkit-transform:rotate(90deg);transform:rotate(90deg)}",""]),e.exports=t},db90:function(e,t,i){"use strict";function r(e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}i("a4d3"),i("e01a"),i("d28b"),i("a630"),i("d3b7"),i("3ca3"),i("ddb0"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=r},dd0f:function(e,t,i){"use strict";i.r(t);var r=i("3ccc"),n=i.n(r);for(var s in r)"default"!==s&&function(e){i.d(t,e,(function(){return r[e]}))}(s);t["default"]=n.a},e13e:function(e,t,i){"use strict";(function(e){i("7db0"),i("c740"),i("4160"),i("baa5"),i("d81d"),i("d3b7"),i("ac1f"),i("5319"),i("159b"),Object.defineProperty(t,"__esModule",{value:!0}),t.chooseAndUploadFile=h,t.uploadCloudFiles=c;var r="chooseAndUploadFile:ok",n="chooseAndUploadFile:fail";function s(e){var t=e.count,i=e.sizeType,r=void 0===i?["original","compressed"]:i,s=e.sourceType,a=void 0===s?["album","camera"]:s,o=e.extension;return new Promise((function(e,i){uni.chooseImage({count:t,sizeType:r,sourceType:a,extension:o,success:function(t){e(u(t,"image"))},fail:function(e){i({errMsg:e.errMsg.replace("chooseImage:fail",n)})}})}))}function a(e){var t=e.camera,i=e.compressed,r=e.maxDuration,s=e.sourceType,a=void 0===s?["album","camera"]:s,o=e.extension;return new Promise((function(e,s){uni.chooseVideo({camera:t,compressed:i,maxDuration:r,sourceType:a,extension:o,success:function(t){var i=t.tempFilePath,r=t.duration,n=t.size,s=t.height,a=t.width;e(u({errMsg:"chooseVideo:ok",tempFilePaths:[i],tempFiles:[{name:t.tempFile&&t.tempFile.name||"",path:i,size:n,type:t.tempFile&&t.tempFile.type||"",width:a,height:s,duration:r,fileType:"video",cloudPath:""}]},"video"))},fail:function(e){s({errMsg:e.errMsg.replace("chooseVideo:fail",n)})}})}))}function o(e){var t=e.count,i=e.extension;return new Promise((function(e,r){var s=uni.chooseFile;if("undefined"!==typeof wx&&"function"===typeof wx.chooseMessageFile&&(s=wx.chooseMessageFile),"function"!==typeof s)return r({errMsg:n+" 请指定 type 类型，该平台仅支持选择 image 或 video。"});s({type:"all",count:t,extension:i,success:function(t){e(u(t))},fail:function(e){r({errMsg:e.errMsg.replace("chooseFile:fail",n)})}})}))}function u(e,t){return e.tempFiles.forEach((function(e,i){e.name||(e.name=e.path.substring(e.path.lastIndexOf("/")+1)),t&&(e.fileType=t),e.cloudPath=Date.now()+"_"+i+e.name.substring(e.name.lastIndexOf("."))})),e.tempFilePaths||(e.tempFilePaths=e.tempFiles.map((function(e){return e.path}))),e}function c(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,r=arguments.length>2?arguments[2]:void 0;t=JSON.parse(JSON.stringify(t));var n=t.length,s=0,a=this;return new Promise((function(o){while(s<i)u();function u(){var i=s++;if(i>=n)!t.find((function(e){return!e.url&&!e.errMsg}))&&o(t);else{var c=t[i],l=a.files.findIndex((function(e){return e.uuid===c.uuid}));c.url="",delete c.errMsg,e.uploadFile({filePath:c.path,cloudPath:c.cloudPath,fileType:c.fileType,onUploadProgress:function(e){e.index=l,r&&r(e)}}).then((function(e){c.url=e.fileID,c.index=l,i<n&&u()})).catch((function(e){c.errMsg=e.errMsg||e.message,c.index=l,i<n&&u()}))}}}))}function l(e,t){var i=t.onChooseFile;t.onUploadProgress;return e.then((function(e){if(i){var t=i(e);if("undefined"!==typeof t)return Promise.resolve(t).then((function(t){return"undefined"===typeof t?e:t}))}return e})).then((function(e){return!1===e?{errMsg:r,tempFilePaths:[],tempFiles:[]}:e}))}function h(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{type:"all"};return"image"===e.type?l(s(e),e):"video"===e.type?l(a(e),e):l(o(e),e)}}).call(this,i("a9ff")["default"])},e452:function(e,t,i){"use strict";i.r(t);var r=i("280a"),n=i("8af0");for(var s in n)"default"!==s&&function(e){i.d(t,e,(function(){return n[e]}))}(s);i("334c");var a,o=i("f0c5"),u=Object(o["a"])(n["default"],r["b"],r["c"],!1,null,"373ea476",null,!1,r["a"],a);t["default"]=u.exports},f0b2:function(e,t,i){var r=i("4c2e");"string"===typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);var n=i("4f06").default;n("33fd4fda",r,!0,{sourceMap:!1,shadowMode:!1})},f183:function(e,t,i){var r=i("d012"),n=i("861d"),s=i("5135"),a=i("9bf2").f,o=i("90e3"),u=i("bb2f"),c=o("meta"),l=0,h=Object.isExtensible||function(){return!0},f=function(e){a(e,c,{value:{objectID:"O"+ ++l,weakData:{}}})},d=function(e,t){if(!n(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!s(e,c)){if(!h(e))return"F";if(!t)return"E";f(e)}return e[c].objectID},p=function(e,t){if(!s(e,c)){if(!h(e))return!0;if(!t)return!1;f(e)}return e[c].weakData},m=function(e){return u&&g.REQUIRED&&h(e)&&!s(e,c)&&f(e),e},g=e.exports={REQUIRED:!1,fastKey:d,getWeakData:p,onFreeze:m};r[c]=!0},f4b3:function(e,t,i){"use strict";var r=i("23e7"),n=i("d039"),s=i("7b0b"),a=i("c04e"),o=n((function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})}));r({target:"Date",proto:!0,forced:o},{toJSON:function(e){var t=s(this),i=a(t);return"number"!=typeof i||isFinite(i)?t.toISOString():null}})},fa95:function(e,t,i){"use strict";function r(e){return-1!==Function.toString.call(e).indexOf("[native code]")}i("c975"),i("d3b7"),i("25f0"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=r},fb2c:function(e,t,i){var r=i("74e8");r("Uint32",(function(e){return function(t,i,r){return e(this,t,i,r)}}))},fd87:function(e,t,i){var r=i("74e8");r("Int8",(function(e){return function(t,i,r){return e(this,t,i,r)}}))},ff9e:function(e,t,i){"use strict";(function(e){var r=i("4ea4");i("99af"),i("c740"),i("4160"),i("baa5"),i("a434"),i("a9e3"),i("b64b"),i("e25e"),i("3ca3"),i("159b"),i("ddb0"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(i("2909")),s=r(i("5530"));i("96cf");var a=r(i("1da1")),o=i("e13e"),u=i("10b0"),c=r(i("579b")),l=r(i("7e50")),h={name:"uniFilePicker",components:{uploadImage:c.default,uploadFile:l.default},emits:["select","success","fail","progress","delete","update:modelValue","input"],props:{value:{type:[Array,Object],default:function(){return[]}},disabled:{type:Boolean,default:!1},disablePreview:{type:Boolean,default:!1},delIcon:{type:Boolean,default:!0},autoUpload:{type:Boolean,default:!0},limit:{type:[Number,String],default:9},mode:{type:String,default:"grid"},fileMediatype:{type:String,default:"image"},fileExtname:{type:[Array,String],default:function(){return[]}},title:{type:String,default:""},listStyles:{type:Object,default:function(){return{border:!0,dividline:!0,borderStyle:{}}}},imageStyles:{type:Object,default:function(){return{width:"auto",height:"auto"}}},readonly:{type:Boolean,default:!1},returnType:{type:String,default:"array"},sizeType:{type:Array,default:function(){return["original","compressed"]}}},data:function(){return{files:[],localValue:[]}},watch:{value:{handler:function(e,t){this.setValue(e,t)},immediate:!0}},computed:{filesList:function(){var e=[];return this.files.forEach((function(t){e.push(t)})),e},showType:function(){return"image"===this.fileMediatype?this.mode:"list"},limitLength:function(){return"object"===this.returnType?1:this.limit?this.limit>=9?9:this.limit:1}},created:function(){e.config&&e.config.provider||(this.noSpace=!0,e.chooseAndUploadFile=o.chooseAndUploadFile),this.form=this.getForm("uniForms"),this.formItem=this.getForm("uniFormsItem"),this.form&&this.formItem&&this.formItem.name&&(this.rename=this.formItem.name,this.form.inputChildrens.push(this))},methods:{clearFiles:function(e){var t=this;0===e||e?this.files.splice(e,1):(this.files=[],this.$nextTick((function(){t.setEmit()}))),this.$nextTick((function(){t.setEmit()}))},upload:function(){var e=[];this.files.forEach((function(t,i){"ready"!==t.status&&"error"!==t.status||e.push(Object.assign({},t))})),this.uploadFiles(e)},setValue:function(e,t){var i=this;return(0,a.default)(regeneratorRuntime.mark((function t(){var r,n,s,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r=function(){var e=(0,a.default)(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(r=/cloud:\/\/([\w.]+\/?)\S*/,n="",n=t.fileID?t.fileID:t.url,!r.test(n)){e.next=8;break}return t.fileID=n,e.next=7,i.getTempFileURL(n);case 7:t.url=e.sent;case 8:return t.url&&(t.path=t.url),e.abrupt("return",t);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),"object"!==i.returnType){t.next=10;break}if(!e){t.next=7;break}return t.next=5,r(e);case 5:t.next=8;break;case 7:e={};case 8:t.next=19;break;case 10:e||(e=[]),n=0;case 12:if(!(n<e.length)){t.next=19;break}return s=e[n],t.next=16,r(s);case 16:n++,t.next=12;break;case 19:i.localValue=e,i.form&&i.formItem&&!i.is_reset&&(i.is_reset=!1,i.formItem.setValue(i.localValue)),o=Object.keys(e).length>0?e:[],i.files=[].concat(o);case 23:case"end":return t.stop()}}),t)})))()},choose:function(){this.disabled||(this.files.length>=Number(this.limitLength)&&"grid"!==this.showType&&"array"===this.returnType?uni.showToast({title:"您最多选择 ".concat(this.limitLength," 个文件"),icon:"none"}):this.chooseFiles())},chooseFiles:function(){var t=this,i=(0,u.get_extname)(this.fileExtname);e.chooseAndUploadFile({type:this.fileMediatype,compressed:!1,sizeType:this.sizeType,extension:i.length>0?i:void 0,count:this.limitLength-this.files.length,onChooseFile:this.chooseFileCallback,onUploadProgress:function(e){t.setProgress(e,e.index)}}).then((function(e){t.setSuccessAndError(e.tempFiles)})).catch((function(e){console.log("选择失败",e)}))},chooseFileCallback:function(e){var t=this;return(0,a.default)(regeneratorRuntime.mark((function i(){var r,n,a,o,c,l,h,f;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:r=(0,u.get_extname)(t.fileExtname),n=1===Number(t.limitLength)&&t.disablePreview&&!t.disabled||"object"===t.returnType,n&&(t.files=[]),a=(0,u.get_files_and_is_max)(e,r),o=a.filePaths,c=a.files,r&&r.length>0||(o=e.tempFilePaths,c=e.tempFiles),l=[],h=0;case 7:if(!(h<c.length)){i.next=21;break}if(!(t.limitLength-t.files.length<=0)){i.next=10;break}return i.abrupt("break",21);case 10:return c[h].uuid=Date.now(),i.next=13,(0,u.get_file_data)(c[h],t.fileMediatype);case 13:f=i.sent,f.progress=0,f.status="ready",t.files.push(f),l.push((0,s.default)((0,s.default)({},f),{},{file:c[h]}));case 18:h++,i.next=7;break;case 21:t.$emit("select",{tempFiles:l,tempFilePaths:o}),e.tempFiles=c,t.autoUpload&&!t.noSpace||(e.tempFiles=[]);case 24:case"end":return i.stop()}}),i)})))()},uploadFiles:function(e){var t=this;e=[].concat(e),o.uploadCloudFiles.call(this,e,5,(function(e){t.setProgress(e,e.index,!0)})).then((function(e){t.setSuccessAndError(e)})).catch((function(e){console.log(e)}))},setSuccessAndError:function(e,t){var i=this;return(0,a.default)(regeneratorRuntime.mark((function t(){var r,n,s,a,o,u,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:r=[],n=[],s=[],a=[],o=regeneratorRuntime.mark((function t(o){var u,c,l;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(u=e[o],c=u.uuid?i.files.findIndex((function(e){return e.uuid===u.uuid})):u.index,-1!==c&&i.files){t.next=4;break}return t.abrupt("return","break");case 4:if("request:fail"!==u.errMsg){t.next=12;break}i.files[c].url=u.path,i.files[c].status="error",i.files[c].errMsg=u.errMsg,n.push(i.files[c]),a.push(i.files[c].url),t.next=26;break;case 12:if(i.files[c].errMsg="",i.files[c].fileID=u.url,l=/cloud:\/\/([\w.]+\/?)\S*/,!l.test(u.url)){t.next=21;break}return t.next=18,i.getTempFileURL(u.url);case 18:i.files[c].url=t.sent,t.next=22;break;case 21:i.files[c].url=u.url;case 22:i.files[c].status="success",i.files[c].progress+=1,r.push(i.files[c]),s.push(i.files[c].fileID);case 26:case"end":return t.stop()}}),t)})),u=0;case 6:if(!(u<e.length)){t.next=14;break}return t.delegateYield(o(u),"t0",8);case 8:if(c=t.t0,"break"!==c){t.next=11;break}return t.abrupt("break",14);case 11:u++,t.next=6;break;case 14:r.length>0&&(i.setEmit(),i.$emit("success",{tempFiles:i.backObject(r),tempFilePaths:s})),n.length>0&&i.$emit("fail",{tempFiles:i.backObject(n),tempFilePaths:a});case 16:case"end":return t.stop()}}),t)})))()},setProgress:function(e,t,i){this.files.length;var r=Math.round(100*e.loaded/e.total),n=t;i||(n=this.files.findIndex((function(t){return t.uuid===e.tempFile.uuid}))),-1!==n&&this.files[n]&&(this.files[n].progress=r-1,this.$emit("progress",{index:n,progress:parseInt(r),tempFile:this.files[n]}))},delFile:function(e){var t=this;this.$emit("delete",{tempFile:this.files[e],tempFilePath:this.files[e].url}),this.files.splice(e,1),this.$nextTick((function(){t.setEmit()}))},getFileExt:function(e){var t=e.lastIndexOf("."),i=e.length;return{name:e.substring(0,t),ext:e.substring(t+1,i)}},setEmit:function(){var e=[];"object"===this.returnType?(e=this.backObject(this.files)[0],this.localValue=e||null):(e=this.backObject(this.files),this.localValue||(this.localValue=[]),this.localValue=(0,n.default)(e)),this.$emit("input",this.localValue)},backObject:function(e){var t=[];return e.forEach((function(e){t.push({extname:e.extname,fileType:e.fileType,image:e.image,name:e.name,path:e.path,size:e.size,fileID:e.fileID,url:e.url})})),t},getTempFileURL:function(t){return(0,a.default)(regeneratorRuntime.mark((function i(){var r;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return t={fileList:[].concat(t)},i.next=3,e.getTempFileURL(t);case 3:return r=i.sent,i.abrupt("return",r.fileList[0].tempFileURL||"");case 5:case"end":return i.stop()}}),i)})))()},getForm:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"uniForms",t=this.$parent,i=t.$options.name;while(i!==e){if(t=t.$parent,!t)return!1;i=t.$options.name}return t}}};t.default=h}).call(this,i("a9ff")["default"])}}]);